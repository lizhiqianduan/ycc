var Ycc=function t(e){this.ctx=null,this.canvasDom=null,this.layerList=[],this.photoManager=null,this.layerManager=null,this.ticker=null,this.debugger=null,this.loader=new t.Loader,this.ajax=new t.Ajax,this.baseUI=null,this.config=e||{debug:{drawContainer:!1}},this.isMobile=t.utils.isMobile(),this.stageW=0,this.stageH=0};function Loading(){this.textUI=new Ycc.UI.SingleLineText({content:"",fontSize:"12px",rect:new Ycc.Math.Rect(0,stageH/2+20,stageW,20),xAlign:"center"}),this.layer=ycc.layerManager.newLayer(),this.layer.addUI(new Ycc.UI.Rect({rect:new Ycc.Math.Rect(0,0,stageW,stageH),color:"rgba(0,0,0,0.1)"})),this.layer.addUI(new Ycc.UI.SingleLineText({content:"正在加载...",rect:new Ycc.Math.Rect(0,stageH/2,stageW,20),xAlign:"center"})),this.layer.addUI(this.textUI),this.hidden=function(){this.layer.show=!1},this.show=function(){this.layer.show=!0},this.updateText=function(t){this.textUI.content=t,ycc.layerManager.reRenderAllLayerToStage()}}function GameScene(t){this.layer=ycc.layerManager.newLayer({enableEventManager:!0,name:"场景图层"}),this.btnLayer=ycc.layerManager.newLayer({enableEventManager:!0,name:"按钮图层"}),this.gameOverLayer=null,this.mario=null,this.endPoint=0,this.coinUI=null,this.musicBtn=null,this.score=0,this.engine=null,this.direction="",this.downIsPressing=!1,this.downTouchEndFlag=!1,this.jumpIsPressing=!1,this.bodies=null,this.marioContactWith=[],this.marioStayingOnWall=!1,this.isGameVictory=!1,this.gameLevel=(location.hash||t||"#1_1").slice(1),this.endBucket=null,this.init()}Ycc.prototype.getStageWidth=function(){return this.canvasDom.width},Ycc.prototype.getStageHeight=function(){return this.canvasDom.height},Ycc.prototype.bindCanvas=function(t){return this.canvasDom=t,this.ctx=t.getContext("2d"),this.layerList=[],this.photoManager=new Ycc.PhotoManager(this),this.layerManager=new Ycc.LayerManager(this),this.ticker=new Ycc.Ticker(this),this.debugger=new Ycc.Debugger(this),this.baseUI=new Ycc.UI(this),this.init(),this},Ycc.prototype.init=function(){this._initStageGestureEvent()},Ycc.prototype._initStageGestureEvent=function(){var s=this,n={},t=new Ycc.Gesture({target:this.ctx.canvas});function e(t){var e=parseInt(t.clientX-s.ctx.canvas.getBoundingClientRect().left),i=parseInt(t.clientY-s.ctx.canvas.getBoundingClientRect().top),r=s.getUIFromPointer(new Ycc.Math.Dot(e,i));o(t.type,e,i),r&&r.belongTo.enableEventManager&&a(t.type,e,i,r)}function o(t,e,i){for(var r=s.layerList.length-1;0<=r;r--){var n=s.layerList[r];n.enableEventManager&&(n.enableEventManager&&n.triggerListener(t,new Ycc.Event({type:t,x:e,y:i})))}}function a(t,e,i,r){r.triggerListener(t,new Ycc.Event({x:e,y:i,type:t,target:r}))}t.addListener("tap",e),t.addListener("longtap",e),t.addListener("doubletap",e),t.addListener("swipeleft",e),t.addListener("swiperight",e),t.addListener("swipeup",e),t.addListener("swipedown",e),t.addListener("dragstart",function(t){var e=parseInt(t.clientX-s.ctx.canvas.getBoundingClientRect().left),i=parseInt(t.clientY-s.ctx.canvas.getBoundingClientRect().top),r=s.getUIFromPointer(new Ycc.Math.Dot(e,i));o(t.type,e,i),r&&(n[t.identifier]=r),r&&r.belongTo.enableEventManager&&a(t.type,e,i,r)}),t.addListener("dragging",function(t){var e=parseInt(t.clientX-s.ctx.canvas.getBoundingClientRect().left),i=parseInt(t.clientY-s.ctx.canvas.getBoundingClientRect().top);o(t.type,e,i);var r=n[t.identifier];r&&r.belongTo.enableEventManager&&a(t.type,e,i,r)}),t.addListener("dragend",function(t){var e=parseInt(t.clientX-s.ctx.canvas.getBoundingClientRect().left),i=parseInt(t.clientY-s.ctx.canvas.getBoundingClientRect().top);o(t.type,e,i);var r=n[t.identifier];r&&(r.belongTo.enableEventManager&&a(t.type,e,i,r),r=null,n[t.identifier]=null)})},Ycc.prototype.clearStage=function(){this.ctx.clearRect(0,0,this.getStageWidth(),this.getStageHeight())},Ycc.prototype.findLayerById=function(t){for(var e=0;e<this.layerList.length;e++){var i=this.layerList[e];if(i.id===t)return i}return null},Ycc.prototype.findUiById=function(t){for(var e=0;e<this.layerList.length;e++)for(var i=this.layerList[e],r=0;r<i.uiList.length;r++){var n=i.uiList[r];if(n.id===t)return n}return null},Ycc.prototype.getUIFromPointer=function(t,e){e=!Ycc.utils.isBoolean(e)||e;for(var i=this.layerList.length-1;0<=i;i--){var r=this.layerList[i];if(!e||r.show){var n=r.getUIFromPointer(t,e);if(n)return n}}return null},function(o){o.utils={},o.utils.extend=function(t,e,i){for(var r in i&&(e=o.utils.deepClone(e)),t)t.hasOwnProperty(r)&&e&&void 0!==e[r]&&(t[r]=e[r]);return t},o.utils.mergeObject=function(t,e){for(var i in e=e||{})e.hasOwnProperty(i)&&void 0!==e[i]&&(t[i]=e[i]);return t},o.utils.isString=function(t){return"string"==typeof t},o.utils.isNum=function(t){return"number"==typeof t},o.utils.isBoolean=function(t){return"boolean"==typeof t},o.utils.isObj=function(t){return"object"==typeof t},o.utils.isFn=function(t){return"function"==typeof t},o.utils.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},o.utils.isMobile=function(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,r=0;r<e.length;r++)if(0<t.indexOf(e[r])){i=!0;break}return i},o.utils.deepClone=function(t){return o.utils.isArray(t)?s(t):n(t);function n(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i],o.utils.isArray(t[i])?e[i]=s(t[i]):o.utils.isObj(t[i])?e[i]=n(t[i]):e[i]=t[i]);return e}function s(t){for(var e=[],i=null,r=0;r<t.length;r++)i=t[r],o.utils.isArray(i)?e.push(s(i)):o.utils.isObj(i)?e.push(n(i)):e.push(i);return e}},o.utils.renderTpl=function(t,i){return t.replace(/__.+?__/g,function(t){console.log("匹配到的文本--\x3e",t);var e=t.slice(2).slice(0,-2).trim();return void 0!==i[e]?i[e]:t})},o.utils.releaseObject=function(t){for(var e in t)t.hasOwnProperty(e)&&delete t[e]},o.utils.releaseArray=function(t){t.length=0}}(Ycc),function(o){o.utils.extend;o.Math=function(){},o.Math.Dot=function(t){this.x=0,this.y=0;var e=arguments.length;1===e?(this.x=t.x,this.y=t.y):2===e&&(this.x=t,this.y=arguments[1])},o.Math.Dot.prototype.isInRect=function(t){return this.x>=t.x&&this.x<=t.x+t.width&&this.y>=t.y&&this.y<=t.y+t.height},o.Math.Rect=function(t){this.yccClass=o.Math.Rect,this.x=0,this.y=0,this.width=0,this.height=0;var e=arguments.length;1===e?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):3===e?(this.x=t.x,this.y=t.y,this.width=arguments[1],this.height=arguments[2]):4===e&&(this.x=t,this.y=arguments[1],this.width=arguments[2],this.height=arguments[3]),this.toPositive()},o.Math.Rect.prototype.toPositive=function(){var t=this.x,e=this.y,i=this.x+this.width,r=this.y+this.height;this.x=t<i?t:i,this.y=e<r?e:r,this.width=Math.abs(this.width),this.height=Math.abs(this.height)},o.Math.Rect.prototype.getVertices=function(){return[new o.Math.Dot(this.x,this.y),new o.Math.Dot(this.x+this.width,this.y),new o.Math.Dot(this.x+this.width,this.y+this.height),new o.Math.Dot(this.x,this.y+this.height)]},o.Math.Rect.prototype.updateByVertices=function(t){if(!o.utils.isArray(t))return console.error("参数必须是数组！");this.x=t[0].x,this.y=t[0].y,this.width=t[1].x-this.x,this.height=t[2].y-this.y},o.Math.Vector=function(){this.x=0,this.y=0,this.z=0,3!==arguments.length&&2!==arguments.length||(this.x=arguments[0]||0,this.y=arguments[1]||0,this.z=arguments[2]||0),1===arguments.length&&(o.utils.isObj(arguments[0])||console.error("constructor need a objec as param!"),this.x=arguments[0].x||0,this.y=arguments[0].y||0,this.z=arguments[0].z||0)},o.Math.Vector.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},o.Math.Vector.prototype.cross=function(t){var e=new o.Math.Vector;return e.x=this.y*t.z-t.y*this.z,e.y=t.x*this.z-this.x*t.z,e.z=this.x*t.y-t.x*this.y,e},o.Math.Vector.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z,2)},o.Math.Matrix=function(t,e,i){this.data=t,this.m=e,this.n=i},o.Math.Matrix.prototype.dot=function(t){if(t.m!==this.n||t.n!==this.m)return console.error("两个矩阵的行数和列数不对应，不能相乘！");for(var e=new o.Math.Matrix([],this.m,this.m),i=1;i<=this.m;i++)for(var r=1;r<=this.m;r++){for(var n=0,s=1;s<=this.n;s++)n+=this.get(i,s)*t.get(s,r);e.set(i,r,n)}return e},o.Math.Matrix.prototype.get=function(t,e){return this.data[(t-1)*this.n+e-1]},o.Math.Matrix.prototype.set=function(t,e,i){this.data[(t-1)*this.n+e-1]=i}}(Ycc),function(n){var t=1,s={};n.Tree=function(){this.$id=t++,this.$parentID=null,this.children=[],this.data=null,s[this.$id]=this},n.Tree.release=function(t){var e=t.getParent();if(e){var i=e.children,r=i.indexOf(t);-1!==r&&(i[r]=null)}delete s[t.$id],t.children.length=0,t.data=null},n.Tree.getNodeMap=function(){return s},n.Tree.prototype.getNodeMap=function(){return s},n.Tree.prototype.getParent=function(){return this.$parentID?s[this.$parentID]:null},n.Tree.prototype.addChildTree=function(t){return t.$parentID?console.error("sub tree's parent has exist! can't add!",t):(t.$parentID=this.$id,this.children.push(t),this)},n.Tree.prototype.removeChildTree=function(t){var e=this.children.indexOf(t);return-1===e||this.children.splice(e,1),this},n.Tree.prototype.getDepth=function(){var t=1;if(0<this.children.length)for(var e=0;e<this.children.length;e++){var i=this.children[e].getDepth();t=t<i+1?i+1:t}return t},n.Tree.prototype.itor=function(t){var a=this;return{each:function(t){if(t.call(a,a))return!0;if(0<a.children.length)for(var e=0;e<a.children.length;e++)if(a.children[e].itor().each(t))return!0;return!1},leftChildFirst:function(t){if(0<a.children.length)for(var e=0;e<a.children.length;e++)if(a.children[e].itor().leftChildFirst(t))return!0;if(t.call(a,a))return!0},rightChildFirst:function(t){if(0<a.children.length)for(var e=a.children.length-1;0<=e;e--)if(a.children[e].itor().rightChildFirst(t))return!0;if(t.call(a,a))return!0},depthDown:function(t){!function t(e,i,r){if(0===e.length)return!0;r=r||0,r++;for(var n=[],s=!1,o=0;o<e.length;o++){if(i.call(a,e[o],r)){s=!0;break}n=n.concat(e[o].children)}return s&&(n=[]),t(n,i,r)}([a],t)}}},n.Tree.prototype.toNodeList=function(){var e=[];return this.itor().depthDown(function(t){e.push(t)}),e},n.Tree.prototype.getNodeListGroupByLayer=function(){var i={};return this.itor().depthDown(function(t,e){i[e]||(i[e]=[]),i[e].push(t)}),i},n.Tree.prototype.getParentList=function(){for(var t=this,e=[];t.$parentID;){var i=s[t.$parentID];e.unshift(i),t=i}return e},n.Tree.prototype.getBrotherList=function(){return this.$parentID?s[this.$parentID].children:[this]},n.Tree.createByJSON=function(t){var e=new n.Tree;if(e.data=t.data,n.utils.isArray(t.children)&&0<t.children.length)for(var i=0;i<t.children.length;i++)e.addChildTree(n.Tree.createByJSON(t.children[i]));return e},n.Tree.createByNodes=function(t){if(!n.utils.isArray(t)||0===t.length)return console.error("need an Array as param!");var i=null,r=[];return t.forEach(function(t){var e=new n.Tree;e.data=t,r.push(e),n.utils.isNum(t.parentID)||t.parentID||(i=e)}),r.forEach(function(e){r.forEach(function(t){t.data.parentID===e.data.id&&e.addChildTree(t)})}),i}}(Ycc),function(h){var e=1,t=1,i=1,l={},r={};h.Graph=function(t){this.type=t||1,this.$id=i++,this.vList=[],this.eList=[]},h.Graph.prototype.getMapV=function(){return l},h.Graph.prototype.getMapE=function(){return r},h.Graph.prototype.bfs=function(t,e,i){if(t=t||[],(i=i||[]).length===this.vList.length)return!0;if(0===t.length){for(var r=null,n=0;n<this.vList.length;n++)if(-1===i.indexOf(this.vList[n].$id)){r=this.vList[n].$id;break}return this.bfs([r],e,i)}for(var s=null,o=0;o<t.length;o++){if(s=l[t[o]],e.call(this,s))return!0;i.push(s.$id)}for(var a=[],h=0;h<t.length;h++){var c=(s=l[t[h]]).getAccessibleIds().filter(function(t){return-1===i.indexOf(t)});a=a.concat(c)}return this.bfs(a,e,i)},h.Graph.prototype.dfs=function(t,e,i){i=i||[];var r=l[t];if(i.push(r.$id),e.call(this,r))return!0;for(var n=r.getAccessibleIds(),s=0;s<n.length;s++){var o=n[s];if(-1===i.indexOf(o)&&this.dfs(o,e,i))return!0}if(i.length===this.vList.length)return!0;for(var a=null,h=0;h<this.vList.length;h++)if(-1===i.indexOf(this.vList[h].$id)){a=this.vList[h].$id;break}return this.dfs(a,e,i)},h.Graph.createDirectedGraph=function(t,e){var i=new h.Graph(1),o=i.vList,a=i.eList;return t.forEach(function(t){o.push(new h.Graph.DirectedV(t))}),e.forEach(function(t){for(var e=null,i=null,r=new h.Graph.DirectedE,n=0;n<o.length&&(!e||!i);n++){var s=o[n];s.data.id===t.fromId&&(e=s).outIDs.push(r.$id),s.data.id===t.toId&&(i=s).inIDs.push(r.$id)}r.init(e.$id,i.$id,t),a.push(r)}),i},h.Graph.DirectedV=function(t){this.$id=e++,this.data=t,this.inIDs=[],this.outIDs=[],l[this.$id]=this},h.Graph.DirectedV.prototype.getAccessibleIds=function(){var e=[];return this.outIDs.forEach(function(t){e.push(r[t].toID)}),e},h.Graph.DirectedE=function(){this.$id=t++,this.data=null,this.fromID=null,this.toID=null,r[this.$id]=this},h.Graph.DirectedE.prototype.init=function(t,e,i){this.fromID=t,this.toID=e,this.data=i},h.Graph.createUnDirectedGraph=function(t,e){var i=new h.Graph(2),s=i.vList,o=i.eList;return t.forEach(function(t){s.push(new h.Graph.UnDirectedV(t))}),e.forEach(function(t){for(var e=[],i=new h.Graph.UnDirectedE,r=0;r<s.length;r++){var n=s[r];if(2===e.length)break;n.data.id!==t.ids[0]&&n.data.id!==t.ids[1]||(e.push(n.$id),n.eIDs.push(i.$id))}i.init(e,t),o.push(i)}),i},h.Graph.UnDirectedV=function(t){this.$id=e++,this.data=t,this.eIDs=[],l[this.$id]=this},h.Graph.UnDirectedV.prototype.getAccessibleIds=function(){for(var t=[],e=0;e<this.eIDs.length;e++){var i=r[this.eIDs[e]];i.vIDs[0]===this.$id&&t.push(i.vIDs[1]),i.vIDs[1]===this.$id&&t.push(i.vIDs[0])}return t},h.Graph.UnDirectedE=function(){this.$id=t++,this.data=null,this.vIDs=[],r[this.$id]=this},h.Graph.UnDirectedE.prototype.init=function(t,e){this.vIDs=t,this.data=e}}(Ycc),function(i){i.Ticker=function(t){this.yccClass=i.Ticker,this.yccInstance=t,this.startTime=performance.now(),this.lastFrameTime=this.startTime,this.deltaTime=0,this.deltaTimeExpect=0,this.deltaTimeRatio=1,this.deltaTimeTotalValue=0,this.frameListenerList=[],this.defaultFrameRate=60,this.defaultDeltaTime=1e3/this.defaultFrameRate,this.frameAllCount=0,this.timerTickCount=0,this._timerId=0,this._isRunning=!1},i.Ticker.prototype.start=function(n){var s=this;if(!s._isRunning){n=n||s.defaultFrameRate,s.deltaTimeExpect=1e3/n;var o=requestAnimationFrame||webkitRequestAnimationFrame||mozRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame;s.frameAllCount=0,o||(o=function(t){return setTimeout(t,1e3/60)}),s.startTime=performance.now(),s._timerId=o(function t(){var e=0===s.timerTickCount?s.startTime:performance.now();s.timerTickCount++;var i=e-s.startTime;var r=s.frameAllCount*s.deltaTimeExpect;(r<i||"undefined"!=typeof wx)&&(s.frameAllCount++,s.broadcastFrameEvent(),s.broadcastToLayer(),s.deltaTime=performance.now()-s.lastFrameTime,s.deltaTimeRatio=s.deltaTime/s.deltaTimeExpect,1<s.frameAllCount&&(s.deltaTimeTotalValue+=s.deltaTime),3<s.deltaTime/s.deltaTimeExpect&&(console.warn("第%d帧：",s.frameAllCount),console.warn("该帧率已低于正常值的1/3！若相邻帧持续警告，请适当降低帧率，或者提升刷新效率！","正常值：",n," 当前值：",1e3/s.deltaTime)),s.lastFrameTime+=s.deltaTime);s._timerId=o(t)}),s._isRunning=!0}},i.Ticker.prototype.stop=function(){var t=cancelAnimationFrame||webkitCancelAnimationFrame||mozCancelAnimationFrame||oCancelAnimationFrame;t||(t=function(t){return clearTimeout(t)}),t(this._timerId),this._isRunning=!1},i.Ticker.prototype.addFrameListener=function(t){this.frameListenerList.push(t)},i.Ticker.prototype.removeFrameListener=function(t){var e=this.frameListenerList.indexOf(t);-1!==e&&this.frameListenerList.splice(e,1)},i.Ticker.prototype.broadcastFrameEvent=function(){for(var t=0;t<this.frameListenerList.length;t++){var e=this.frameListenerList[t];i.utils.isFn(e)&&e()}},i.Ticker.prototype.broadcastToLayer=function(){for(var t=0;t<this.yccInstance.layerList.length;t++){var e=this.yccInstance.layerList[t];e.show&&e.enableFrameEvent&&e.onFrameComing()}}}(Ycc),function(n){n.Debugger=function(t){this.yccClass=n.Debugger,this.yccInstance=t,this.deltaTime=null,this.deltaTimeExpect=null,this.frameAllCount=null,this.deltaTimeAverage=null,this.renderTime=null,this.renderUiCount=null,this.totalJSHeapSize=null,this.usedJSHeapSize=null,this.jsHeapSizeLimit=null,this.fields=[],this.rect=new n.UI.Rect({name:"debuggerRect",rect:new n.Math.Rect(10,10,200,140),color:"rgba(255,255,0,0.5)"}),this.layer=t.layerManager.newLayer({name:"debug图层"}),this.init()},n.Debugger.prototype.init=function(){var t=this;this.yccInstance.ticker.addFrameListener(function(){t.updateInfo()})},n.Debugger.prototype.showDebugPanel=function(){var t=this.layer;-1===t.uiList.indexOf(this.rect)&&t.addUI(this.rect)},n.Debugger.prototype.updateInfo=function(){var t=this.yccInstance.layerList,e=t.indexOf(this.layer);e+1!==t.length&&(t.splice(e,1),t.push(this.layer)),this.rect.rect.height=20*this.fields.length,this.fields.forEach(function(t){t.ui.content=t.name+" "+t.cb()})},n.Debugger.prototype.addField=function(t,e){var i=this.fields.length,r=new n.UI.SingleLineText({content:"usedJSHeapSize "+e(),fontSize:"12px",rect:new n.Math.Rect(0,20*i,100,20),color:"green"});this.fields.push({name:t,cb:e,ui:r}),this.rect.addChild(r)},n.Debugger.prototype.addToLayer=function(t){-1===t.uiList.indexOf(this.rect)&&t.addUI(this.rect)},n.Debugger.prototype.updateField=function(t,e){for(var i=0;i<this.fields.length;i++)if(this.fields[i].name===t)return this.fields[i].cb=null,void(this.fields[i].cb=e)}}(Ycc),function(g){function t(){this.currentTime=0,this.source=null,this.running=!1}g.Loader=function(){this.yccClass=g.Loader,this.ajax=new g.Ajax,this.basePath=""},g.Loader.prototype.loadResParallel=function(r,n,s,o,a){o=o||[],a=a||{};for(var t=0;t<r.length;t++){var e=r[t],i="load";function h(t,e,i){return function(){o.push(t),void 0!==t.name&&(a[t.name]=t.res),g.utils.isFn(s)&&s(t,i,e),r.length===o.length&&n(o,a)}}e.type=e.type||"image","image"===e.type&&(e.res=new Image,e.res.src=e.url),"audio"===e.type&&(i="loadedmetadata",e.res=new Audio,e.res.src=e.url,e.res.preload="load"),e.res.addEventListener(i,h(e,t,!0)),e.res.addEventListener("error",h(e,t,!1))}},g.Loader.prototype.loadResOneByOne=function(e,i,r,n,s){if(n=n||[],s=s||{},e.length!==n.length){var o=this,a=n.length,h=e[a];h.type=h.type||"image";var c,l=0;if("image"===h.type)h.res=new Image,h.res.src=o.basePath+h.url,h.res.addEventListener("load",u),h.res.addEventListener("error",d),l=setTimeout(function(){h.res.removeEventListener("load",u),h.res.removeEventListener("error",u),d({message:"获取资源超时！"})},h.timeout||1e4);else if("audio"===h.type){if(h.res=new t,!h.res.context)return void d({message:"浏览器不支持AudioContext！"});console.log(o.basePath+h.url),o.ajax.get(o.basePath+h.url,(c=h,function(t){c.res.context.decodeAudioData(t,function(t){c.res.buf=t,u()},d)}),d,"arraybuffer")}}else i(n,s);function u(){clearTimeout(l),n.push(h),void 0!==h.name&&(s[h.name]=h.res),g.utils.isFn(r)&&r(h,null,a),o.loadResOneByOne(e,i,r,n,s)}function d(t){clearTimeout(l),n.push(h),void 0!==h.name&&(s[h.name]=h.res),g.utils.isFn(r)&&r(h,t,a),o.loadResOneByOne(e,i,r,n,s)}},g.Loader.prototype.getResByName=function(t,e){for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null},t.prototype.context=("undefined"!=typeof AudioContext||"undefined"!=typeof webkitAudioContext)&&new(AudioContext||webkitAudioContext),t.prototype.play=function(){var t=this.context;if(t){this.running=!0,this.source&&this.source.stop();var e=t.createBufferSource();e.buffer=this.buf,e.connect(t.destination),e.start(this.currentTime),this.source=e}},t.prototype.pause=function(){this.context&&(this.running=!1,this.source.stop(),this.source=null)}}(Ycc),function(t){t.Ajax=function(){this.yccClass=t.Ajax},t.Ajax.prototype.get=function(t){var e,i,r=this,n="",s="json";s=1===arguments.length?(n="",e=t.successCb,i=t.errorCb,"json"):(n=t,e=arguments[1],i=arguments[2],arguments[3]);var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType=s,o.onload=function(){e.call(r,o.response)},o.onerror=function(t){i.call(r,t)},o.send()}}(Ycc),function(e){e.Event=function(t){this.yccClass=e.Event,this.type=t||"",this.x=0,this.y=0,this.originEvent=null,this.stop=!1,this.target=null,e.utils.isObj(t)&&e.utils.extend(this,t)}}(Ycc),function(n){n.Listener=function(){this.yccClass=n.Listener,this.listeners={},this.stopType={},this.disableType={},this.stopAllEvent=!1,this.onclick=null,this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,this.ondragstart=null,this.ondragging=null,this.ondragend=null,this.onmouseover=null,this.onmouseout=null,this.ontouchstart=null,this.ontouchmove=null,this.ontouchend=null,this.ontap=null},n.Listener.release=function(t){var e=null;for(e in t.yccClass=null,t.listeners)t.listeners.hasOwnProperty(e)&&(t.listeners[e].length=0,delete t.listeners[e]);n.utils.releaseObject(t.stopType),n.utils.releaseObject(t.disableType),t.stopAllEvent=!0,t.onclick=null,t.onmousedown=null,t.onmouseup=null,t.onmousemove=null,t.ondragstart=null,t.ondragging=null,t.ondragend=null,t.onmouseover=null,t.onmouseout=null,t.ontouchstart=null,t.ontouchmove=null,t.ontouchend=null,t.ontap=null},n.Listener.prototype.addListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e)},n.Listener.prototype.stop=function(t){this.stopType[t]=!0},n.Listener.prototype.triggerListener=function(t,e){if(!this.stopAllEvent&&!this.disableType[t]){this.stopType[t]||n.utils.isFn(this["on"+t])&&this["on"+t].apply(this,Array.prototype.slice.call(arguments,1));var i=this.listeners&&this.listeners[t];if(i&&n.utils.isArray(i))for(var r=0;r<i.length;r++)this.stopType[t]||i[r].apply(this,Array.prototype.slice.call(arguments,1))}},n.Listener.prototype.removeListener=function(t,e){var i=this.listeners[t];if(i&&n.utils.isArray(i))for(var r=0;r<i.length;r++)if(i[r]===e)return void i.splice(r,1)},n.Listener.prototype.disableEvent=function(t){this.disableType[t]=!0},n.Listener.prototype.resumeEvent=function(t){this.disableType[t]=!1}}(Ycc),function(e){var t,i=(t=0,function(){this.id=t++,this.startTouchEvent=null,this.endTouchEvent=null,this.moveTouchEventList=[],this.startTime=Date.now(),this.endTime=0});e.TouchLifeTracer=function(t){e.Listener.call(this),this.target=t.target,this._lifeList=[],this.currentLifeList=[],this.targetTouches=[],this.touches=[],this.changedTouches=[],this.onlifestart=null,this.onlifechange=null,this.onlifeend=null,this.addLife=function(t){this._lifeList.push(t)},this.findCurrentLifeByTouchID=function(t){for(var e=0;e<this.currentLifeList.length;e++){var i=this.currentLifeList[e];if(i.startTouchEvent.identifier===t)return i}},this.deleteCurrentLifeByTouchID=function(t){for(var e=0;e<this.currentLifeList.length;e++){if(this.currentLifeList[e].startTouchEvent.identifier===t)return this.currentLifeList.splice(e,1),!0}return!1},this.init=function(){var o=this;this.target.addEventListener("touchstart",function(t){t.preventDefault(),o.syncTouches(t);var e=new i;e.startTouchEvent=t.changedTouches[0],o.addLife(e),o.currentLifeList.push(e),o.triggerListener("lifestart",e)}),this.target.addEventListener("touchmove",function(t){t.preventDefault(),o.syncTouches(t);for(var e=t.changedTouches,i=0;i<e.length;i++){var r=e[i],n=o.findCurrentLifeByTouchID(r.identifier),s=o.indexOfTouchFromMoveTouchEventList(n.moveTouchEventList,r);-1===s?n.moveTouchEventList.push(r):n.moveTouchEventList[s]=r,o.triggerListener("lifechange",n)}}),this.target.addEventListener("touchend",function(t){t.preventDefault(),o.syncTouches(t);var e=t.changedTouches[0],i=o.findCurrentLifeByTouchID(e.identifier);i.endTouchEvent=e,i.endTime=Date.now(),o.deleteCurrentLifeByTouchID(e.identifier),o.triggerListener("lifeend",i)})},this.init()},e.utils.mergeObject(e.TouchLifeTracer.prototype,e.Listener.prototype),e.TouchLifeTracer.prototype.syncTouches=function(t){this.touches=[],this.changedTouches=[],this.targetTouches=[];var e=0,i=[];for(i=t.touches,e=0;e<i.length;e++)this.touches.push(i[e]);for(i=t.changedTouches,e=0;e<t.changedTouches.length;e++)this.changedTouches.push(i[e]);for(i=t.targetTouches,e=0;e<t.targetTouches.length;e++)this.targetTouches.push(i[e])},e.TouchLifeTracer.prototype.indexOfTouchFromMoveTouchEventList=function(t,e){for(var i=0;i<t.length;i++)if(e.identifier===t[i].identifier)return i;return-1}}(Ycc),function(y){y.Gesture=function(t){y.Listener.call(this),this.yccClass=y.Gesture,this.option=t,this._longTapTimeout=null,this._init()},y.Gesture.prototype=new y.Listener,y.Gesture.prototype._init=function(){y.utils.isMobile()?(console.log("mobile gesture init..."),this._initForMobile()):(console.log("pc gesture init..."),this._initForPC())},y.Gesture.prototype._initForMobile=function(){var n,s,o=this,a=new y.TouchLifeTracer({target:this.option.target}),h={tap:!1,swipe:!1};a.onlifestart=function(t){if(o.triggerListener("tap",o._createEventData(t.startTouchEvent,"tap")),o.triggerListener("log","tap triggered"),o.triggerListener("dragstart",o._createEventData(t.startTouchEvent,"dragstart")),1<a.currentLifeList.length)return o.triggerListener("log","multi touch start ..."),o.triggerListener("multistart",a.currentLifeList),h.tap=!1,h.swipe=!1,clearTimeout(this._longTapTimeout),n=a.currentLifeList[0],s=a.currentLifeList[1],this;h.tap=!1,h.swipe=!1,this._longTapTimeout=setTimeout(function(){o.triggerListener("longtap",o._createEventData(t.startTouchEvent,"longtap"))},750)},a.onlifechange=function(t){if(t.moveTouchEventList.forEach(function(t){o.triggerListener("dragging",o._createEventData(t,"dragging"))}),1<a.currentLifeList.length){h.tap=!0,h.swipe=!0,o.triggerListener("log","multi touch move ..."),o.triggerListener("multichange",n,s);var e=o.getZoomRateAndRotateAngle(n,s);return y.utils.isNum(e.rate)&&(o.triggerListener("zoom",e.rate),o.triggerListener("log","zoom triggered",e.rate)),y.utils.isNum(e.angle)&&(o.triggerListener("rotate",e.angle),o.triggerListener("log","rotate triggered",e.angle)),this}if(0<t.moveTouchEventList.length){var i=t.startTouchEvent,r=Array.prototype.slice.call(t.moveTouchEventList,-1)[0];(10<Math.abs(r.pageX-i.pageX)||10<Math.abs(r.pageY-i.pageY))&&(h.tap=!0,clearTimeout(this._longTapTimeout))}},a.onlifeend=function(t){if(o.triggerListener("dragend",o._createEventData(t.endTouchEvent,"dragend")),1===a.currentLifeList.length)return o.triggerListener("multiend",n,s);if(0===a.currentLifeList.length){if(!h.tap&&t.endTime-t.startTime<300)return clearTimeout(this._longTapTimeout),n=n&&t.endTime-n.endTime<300&&Math.abs(n.endTouchEvent.pageX-t.endTouchEvent.pageX)<10&&Math.abs(n.endTouchEvent.pageY-t.endTouchEvent.pageY)<10?(o.triggerListener("doubletap",o._createEventData(t.endTouchEvent,"doubletap")),o.triggerListener("log","doubletap triggered"),null):t,this;if(!h.swipe&&t.endTime-t.startTime<300){console.log("swipe");var e=t.startTouchEvent,i=Array.prototype.slice.call(t.moveTouchEventList,-1)[0];if(30<Math.abs(i.pageX-e.pageX)||30<Math.abs(i.pageY-e.pageY)){var r="swipe"+o._getSwipeDirection(e.pageX,e.pageY,i.pageX,i.pageY);o.triggerListener("log",r),o.triggerListener(r,o._createEventData(t.endTouchEvent,r))}return this}}}},y.Gesture.prototype._initForPC=function(){var r=this,n=null,s=null,o=!1,a=null,h=-1,c=0;this.option.target.addEventListener("mousedown",function(t){t.identifier=++c,n=r._createEventData(t),h=setTimeout(function(){console.log("longtap",Date.now(),"..."),r.triggerListener("log","long tap ..."),r.triggerListener("longtap",r._createEventData(n,"longtap"))},750)}),this.option.target.addEventListener("mousemove",function(t){if(n){if(n&&t.clientX===n.clientX&&t.clientY===n.clientY)return;if(s&&t.clientX===n.clientX&&t.clientY===n.clientY)return;clearTimeout(h),o||(r.triggerListener("dragstart",r._createEventData(n,"dragstart")),o=!0),t.identifier=c,r.triggerListener("dragging",r._createEventData(t,"dragging"))}else clearTimeout(h)}),this.option.target.addEventListener("mouseup",function(t){if(t.identifier=c,s=r._createEventData(t),o){if(clearTimeout(h),r.triggerListener("dragend",r._createEventData(t,"dragend")),o&&s.createTime-n.createTime<300&&(30<Math.abs(s.pageX-n.pageX)||30<Math.abs(s.pageY-n.pageY))){var e="swipe"+r._getSwipeDirection(n.pageX,n.pageY,s.pageX,s.pageY);console.log("swipe",e),r.triggerListener("log",e),r.triggerListener(e,r._createEventData(n,e))}return o=!1,n=null}if(!o&&n&&s.createTime-n.createTime<300){clearTimeout(h);var i=r._createEventData(n,"tap");return r.triggerListener("tap",i),r.triggerListener("log","tap triggered"),a&&i.createTime-a.createTime<300&&Math.abs(a.pageX-i.pageX)<10&&Math.abs(a.pageY-i.pageY)<10?(r.triggerListener("doubletap",r._createEventData(i,"doubletap")),r.triggerListener("log","doubletap triggered"),preLife=null,this):(a=i,n=null,this)}})},y.Gesture.prototype._createEventData=function(t,e){var i={type:"",target:null,identifier:-1,clientX:0,clientY:0,pageX:0,pageY:0,screenX:0,screenY:0,force:1,createTime:Date.now()};return(i=y.utils.extend(i,t)).type=e,i},y.Gesture.prototype._getSwipeDirection=function(t,e,i,r){return Math.abs(t-i)>=Math.abs(e-r)?0<t-i?"left":"right":0<e-r?"up":"down"},y.Gesture.prototype.getZoomRateAndRotateAngle=function(t,e){this.triggerListener("log","preLife"),this.triggerListener("log",t),this.triggerListener("log","curLife"),this.triggerListener("log",e);var i=t.startTouchEvent.pageX,r=t.startTouchEvent.pageY,n=e.startTouchEvent.pageX,s=e.startTouchEvent.pageY,o=0<t.moveTouchEventList.length?t.moveTouchEventList[t.moveTouchEventList.length-1]:t.startTouchEvent,a=0<e.moveTouchEventList.length?e.moveTouchEventList[e.moveTouchEventList.length-1]:e.startTouchEvent,h=o.pageX,c=o.pageY,l=a.pageX,u=a.pageY,d=new y.Math.Vector(n-i,s-r),g=new y.Math.Vector(l-h,u-c),p=Math.acos(g.dot(d)/(g.getLength()*d.getLength()))/Math.PI*180;return{rate:g.getLength()/d.getLength(),angle:p*(0<g.cross(d).z?-1:1)}}}(Ycc),function(u){var i=0;u.Layer=function(t,e){u.Listener.call(this),e=e||{},this.yccClass=u.Layer,this.uiList=[],this.uiCountRecursion=0,this.yccInstance=t,this.ctx=null,this.id=i++,this.type="ui",this.textValue="",this.name=e.name?e.name:"图层_"+this.type+"_"+this.id,this.x=0,this.y=0,this.width=t.getStageWidth(),this.height=t.getStageHeight(),this.show=!0,this.enableEventManager=!1,this.enableFrameEvent=!1,this.onFrameComing=function(){},u.utils.extend(this,e),this.init()},u.Layer.prototype=new u.Listener,u.Layer.prototype.constructor=u.Layer,u.Layer.release=function(t){u.Listener.release(t),t.yccClass=null,t.uiList=null,t.yccInstance=null,t.show=!1,t.enableEventManager=!1,t.enableFrameEvent=!1,t.onFrameComing=null},u.Layer.prototype.init=function(){this.ctx=this.yccInstance.ctx,this._setCtxProps()},u.Layer.prototype._initEvent=function(){var o=this,a=null,h=null,c=!1,l=!1;function i(t){if(!t.stop)for(var e=o.uiList.length-1;0<=e;e--){var i=o.uiList[e],r=new u.Math.Dot(t.x,t.y);if(i.rect&&r.isInRect(i.getAbsolutePosition())&&!1===t.stop){t.stop=!0,t.mouseDownYccEvent=a,t.mouseUpYccEvent=h,t.target=i,t.targetDeltaPosition=new u.Math.Dot(t.x-i.getAbsolutePosition().x,t.y-i.getAbsolutePosition().y),i.triggerListener(t.type,t);break}}}this.addListener("click",function(t){c||i(t)}),this.addListener("mousedown",function(t){l=c=!1,i(a=t)}),this.addListener("mouseup",function(t){if(l){var e=new u.Event({type:"dragend",x:t.x,y:t.y,mouseDownYccEvent:a});o.triggerListener("dragend",e),a&&a.target&&(o.target=a.target,o.target.triggerListener("dragend",e))}t.mouseDownYccEvent=a=null,i(h=t)}),this.addListener("mousemove",function(t){if(t.stop)return;if(a&&t.x===a.x&&t.y===a.y)return;if(h&&t.x===h.x&&t.y===h.y)return;if(c=!0,a){if(!l){var e=new u.Event({type:"dragstart",x:a.x,y:a.y,mouseDownYccEvent:a});o.triggerListener(e.type,e),a.target&&(e.target=a.target,e.target.triggerListener(e.type,e))}l=!0;var i=new u.Event({type:"dragging",x:t.x,y:t.y,mouseDownYccEvent:a});return o.triggerListener(i.type,i),a.target&&(i.target=a.target,i.target.triggerListener(i.type,i)),null}for(var r=o.uiList.length-1;0<=r;r--){var n=o.uiList[r],s=new u.Math.Dot(t.x-n.belongTo.x,t.y-n.belongTo.y);if(s.isInRect(n.rect)){t.stop=!0,t.mouseDownYccEvent=a,t.mouseUpYccEvent=h,(t.target=n).triggerListener(t.type,t);break}}})},u.Layer.prototype._setCtxProps=function(t){var e={fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontSize:"16px",fontFamily:"微软雅黑",font:"16px 微软雅黑",textBaseline:"hanging",fillStyle:"red",strokeStyle:"blue"};for(var i in(e=u.utils.extend(e,t)).font=[e.fontStyle,e.fontVariant,e.fontWeight,e.fontSize,e.fontFamily].join(" "),e)e.hasOwnProperty(i)&&(this.ctx[i]=e[i])},u.Layer.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},u.Layer.prototype.removeAllUI=function(){this.uiList.forEach(function(t){u.UI.release(t)}),this.uiList.length=0},u.Layer.prototype.removeSelf=function(){this.removeAllUI(),this.yccInstance.layerManager.deleteLayer(this),u.Layer.release(this)},u.Layer.prototype.renderToStage=function(){this.show&&this.yccInstance.ctx.drawImage(this.ctx.canvas,0,0,this.width,this.height)},u.Layer.prototype.addUI=function(t,e){var i=this;if(t.itor().each(function(t){t.init(i)}),!e)return this.uiList.push(t);var r=this.uiList.indexOf(e);if(-1===r)return this.uiList.push(t);this.uiList.splice(r,0,t)},u.Layer.prototype.removeUI=function(t){if(!t)return!1;var e=this.uiList.indexOf(t);return-1!==e&&(u.UI.release(t),this.uiList[e]=null,this.uiList.splice(e,1),!0)},u.Layer.prototype.render=function(){for(var t=0;t<this.uiList.length;t++)this.uiList[t].show&&this.uiList[t].render()},u.Layer.prototype.reRender=function(){for(var i=this,t=i.uiCountRecursion=0;t<this.uiList.length;t++)this.uiList[t].show&&this.uiList[t].itor().depthDown(function(t,e){i.uiCountRecursion++,t.show&&t.__render()});i.ctx.draw&&i.ctx.draw()},u.Layer.prototype.getUIFromPointer=function(e,i){i=!u.utils.isBoolean(i)||i;for(var r=null,t=this.uiList.length-1;0<=t;t--){var n=this.uiList[t];i&&!n.show||n.itor().rightChildFirst(function(t){return!(i&&!t.show)&&(e.isInRect(t.getAbsolutePosition())?(r=t,!0):void 0)})}return r},u.Layer.prototype.transformToAbsolute=function(t){var e=null;if(u.utils.isArray(t)){e=[];for(var i=0;i<t.length;i++){var r=new u.Math.Dot(0,0),n=t[i];r.x=this.x+n.x,r.y=this.y+n.y,e.push(r)}return e}return(e=new u.Math.Dot(0,0)).x=this.x+t.x,e.y=this.y+t.y,e},u.Layer.prototype.transformToLocal=function(t){var e=null;if(u.utils.isArray(t)){e=[];for(var i=0;i<t.length;i++){var r=new u.Math.Dot(0,0),n=t[i];r.x=n.x-this.x,r.y=n.y-this.y,e.push(r)}return e}return(e=new u.Math.Dot(0,0)).x=t.x-this.x,e.y=t.y-this.y,e}}(Ycc),function(o){o.LayerManager=function(t){this.yccInstance=t,this.renderTime=0,this.renderUiCount=0},o.LayerManager.prototype.init=function(){},o.LayerManager.prototype.newLayer=function(t){var e=new o.Layer(this.yccInstance,t);return this.yccInstance.layerList.push(e),e},o.LayerManager.prototype.deleteLayer=function(t){for(var e=this.yccInstance.layerList,i=0;i<e.length;i++)if(e[i].id===t.id)return this.yccInstance.layerList.splice(i,1),t;return t},o.LayerManager.prototype.deleteAllLayer=function(){for(var t=0;t<this.yccInstance.layerList.length;t++){var e=this.yccInstance.layerList[t];e.removeAllUI(),o.Layer.release(e),e=null}this.yccInstance.layerList=[]},o.LayerManager.prototype.reRenderAllLayerToStage=function(){var t=Date.now();this.renderUiCount=0,this.yccInstance.clearStage();for(var e=0;e<this.yccInstance.layerList.length;e++){var i=this.yccInstance.layerList[e];i.show&&(i.reRender(),this.renderUiCount+=i.uiCountRecursion)}this.renderTime=Date.now()-t},o.LayerManager.prototype.enableEventManagerOnly=function(t){if(!t)return!1;for(var e=0;e<this.yccInstance.layerList.length;e++)this.yccInstance.layerList[e].enableEventManager=!1;return t.enableEventManager=!0,this},o.LayerManager.prototype.enableEventManagerAll=function(t){for(var e=0;e<this.yccInstance.layerList.length;e++)this.yccInstance.layerList[e].enableEventManager=t;return this},o.LayerManager.prototype.renderAllLayerByJsonArray=function(t){if(!o.utils.isArray(t))return console.error("jsonArray is not an Array!",t);for(var e=0;e<t.length;e++){var i=t[e];if(!o.utils.isObj(i))return console.error("item in jsonArray should be an Object!",i);for(var r=this.newLayer(i.option),n=0;n<i.ui.length;n++){var s=i.ui[n];r.addUI(new o.UI[s.type](s.option))}r.render()}}}(Ycc),function(t){var e=function(t){this.imageData=t,this.createTime=new Date,this.id=this.createTime.getTime()};t.PhotoManager=function(t){this.yccInstance=t,this.ctx=t.ctx,this._photos=[]},t.PhotoManager.prototype.takePhoto=function(){return this._photos.push(new e(this.ctx.getImageData(0,0,this.yccInstance.getStageWidth(),this.yccInstance.getStageHeight()))),this},t.PhotoManager.prototype.getHistoryPhotos=function(){return this._photos},t.PhotoManager.prototype.showPhoto=function(t){return this.ctx.putImageData(t.imageData,0,0),t},t.PhotoManager.prototype.showLastPhoto=function(){var t=this._photos.length,e=!1;return 1<=t&&(e=this._photos[t-1],this.showPhoto(e)),e},t.PhotoManager.prototype.delPhotoById=function(t){for(var e=this._photos.slice(0),i=0;i<e.length;i++)if(e[i].id===t)return e.splice(i+1,1),(this._photos=e)[i];return!1}}(Ycc),function(e){if(!e||!e.utils)return console.error("Error: Ycc.ui needs module `Ycc` and `Ycc.utils`!");e.utils.isObj,e.utils.isArray,e.utils.isString,e.utils.isNum,e.utils.extend;e.UI=function(t){this.yccClass=e.UI,this._photos=[],this.ctx=t.ctx,this.ctxWidth=t.getStageWidth(),this.ctxHeight=t.getStageHeight()},e.UI.prototype.text=function(t,e,i){return this.ctx.save(),i?this.ctx.fillText(e,t[0],t[1]):this.ctx.strokeText(e,t[0],t[1]),this.ctx.restore(),this},e.UI.prototype.line=function(t,e){return this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t[0],t[1]),this.ctx.lineTo(e[0],e[1]),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},e.UI.prototype.rect=function(t,e,i){return this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t[0],t[1],e[0]-t[0],e[1]-t[1]),this.ctx.closePath(),i?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},e.UI.prototype.ellipse=function(t,e,i,r,n){this.ctx.save();var s=i<e?e:i,o=e/s,a=i/s;return this.ctx.translate(t[0],t[1]),this.ctx.rotate(parseInt(r)*Math.PI/180),this.ctx.translate(-t[0],-t[1]),this.ctx.scale(o,a),this.ctx.beginPath(),this.ctx.arc(t[0]/o,t[1]/a,s,0,2*Math.PI,!1),this.ctx.closePath(),n?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},e.UI.prototype.circleArc=function(t,e,i,r,n){return this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t[0],t[1],e,i/180*Math.PI,r/180*Math.PI,n),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},e.UI.prototype.sector=function(t,e,i,r,n,s){return this.ctx.save(),this.ctx.beginPath(),this.ctx.lineTo(t[0],t[1]),this.ctx.arc(t[0],t[1],e,i*Math.PI/180,r*Math.PI/180,s),this.ctx.lineTo(t[0],t[1]),this.ctx.closePath(),n?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},e.UI.prototype.foldLine=function(t){if(t.length<2)return console.error("Error: 参数错误！");this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t[0][0],t[0][1]);for(var e=0;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1]);return this.ctx.stroke(),this.ctx.restore(),this},e.UI.prototype.circle=function(t,e,i){return this.ellipse(t,e,e,0,i),this},e.UI.prototype.image=function(t,e){var i=this;return e=e||[0,0],i.ctx.save(),i.ctx.beginPath(),i.ctx.drawImage(t,e[0],e[1]),i.ctx.closePath(),i.ctx.restore(),this},e.UI.prototype._getMaxLenContent=function(t,e){var i=t;if(this.ctx.measureText(t).width<=e)return t;for(var r=0;r<t.length;r++)if(i=t.slice(0,r),e<this.ctx.measureText(i).width)return t.slice(0,r-1)},e.UI.prototype.scale=function(t,e){return this.ctx.scale(t,e),this},e.UI.prototype.clear=function(){return this.ctx.fillStyle="#fff",this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,this.ctxWidth,this.ctxHeight),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this}}(Ycc),function(o){var e=0;o.UI.Base=function(t){o.Listener.call(this),o.Tree.call(this),this.yccClass=o.UI.Base,this.id=e++,this.name="",this.ctx=null,this.rect=new o.Math.Rect,this.anchorX=0,this.anchorY=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.rectBgColor="rgba(0,0,0,0)",this.rectBgAlpha=1,this.show=!0,this.lineWidth=1,this.fillStyle="black",this.strokeStyle="black",this.belongTo=null,this.userData=null,this.baseUI=null,this.beforeInit=null,this.afterInit=null,this.oncomputestart=null,this.oncomputeend=null,this.onrenderstart=null,this.onrenderend=null,this.extend(t)},o.utils.mergeObject(o.UI.Base.prototype,o.Listener.prototype),o.utils.mergeObject(o.UI.Base.prototype,o.Tree.prototype),o.UI.Base.prototype.init=function(t){o.utils.isFn(this.beforeInit)&&this.beforeInit(),this.belongTo=t,this.ctx=t.ctx,this.computeUIProps(),o.utils.isFn(this.afterInit)&&this.afterInit()},o.UI.Base.prototype.computeUIProps=function(){},o.UI.Base.prototype.renderRectBgColor=function(){var t=this.getAbsolutePosition();this.ctx.save(),this.ctx.globalAlpha=this.rectBgAlpha,this.ctx.fillStyle=this.rectBgColor,this.ctx.beginPath(),this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()},o.UI.Base.prototype.removeSelf=function(){this.belongTo.removeUI(this)},o.UI.Base.prototype.addChild=function(t){return this.belongTo&&t.init(this.belongTo),this.addChildTree(t),this},o.UI.Base.prototype.removeChild=function(t){return this.removeChildTree(t),o.UI.release(t),this},o.UI.Base.prototype.scaleAndRotate=function(){this.ctx.scale(this.scaleX,this.scaleY);var t=this.getAbsolutePosition();this.ctx.translate(this.anchorX+t.x,this.anchorY+t.y),this.ctx.rotate(this.rotation*Math.PI/180),this.ctx.translate(-this.anchorX-t.x,-this.anchorY-t.y)},o.UI.release=function(t){t.itor().leftChildFirst(function(t){t.yccClass!==o.UI.Image&&t.yccClass!==o.UI.ImageFrameAnimation||(t.res=null),o.Tree.release(t),o.Listener.release(t),t.yccInstance=null,t.yccClass=null,t.ctx=null,t.belongTo=null,t.userData=null,t.baseUI=null,t.beforeInit=null,t.afterInit=null,t.oncomputestart=null,t.oncomputeend=null,t.onrenderstart=null,t.onrenderend=null})},o.UI.Base.prototype.render=function(t){},o.UI.Base.prototype._renderContainer=function(){var t=this.rect;this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#ff0000",this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()},o.UI.Base.prototype.__render=function(t){this.triggerListener("computestart",new o.Event("computestart")),this.computeUIProps(),this.triggerListener("computeend",new o.Event("computeend")),this.renderRectBgColor(),this.belongTo.yccInstance.config.debug.drawContainer&&this._renderContainer(),this.triggerListener("renderstart",new o.Event("renderstart")),this.render(t),this.triggerListener("renderend",new o.Event("renderend"))},o.UI.Base.prototype.getMaxContentInWidth=function(t,e){var i=t;if(this.ctx.measureText(t).width<=e)return t;for(var r=0;r<t.length;r++)if(i=t.slice(0,r+1),e<this.ctx.measureText(i).width)return t.slice(0,r)},o.UI.Base.prototype.extend=function(t){for(var e in t=t||{},this)void 0!==t[e]&&(this[e]=t[e]);return this},o.UI.Base.prototype.clone=function(){var t=new this.yccClass;return t.extend(this),t},o.UI.Base.prototype.getAbsolutePosition=function(){var t=new o.Math.Rect,e=this.getParent();if(t.width=this.rect.width,t.height=this.rect.height,e){var i=e.getAbsolutePosition();t.x=this.rect.x+i.x,t.y=this.rect.y+i.y}else t.x=this.rect.x+this.belongTo.x,t.y=this.rect.y+this.belongTo.y;return t},o.UI.Base.prototype.transformToAbsolute=function(t){var e=null,i=this.getAbsolutePosition();if(o.utils.isArray(t)){e=[];for(var r=0;r<t.length;r++){var n=new o.Math.Dot(0,0),s=t[r];n.x=i.x+s.x,n.y=i.y+s.y,e.push(n)}return e}return(e=new o.Math.Dot(0,0)).x=i.x+t.x,e.y=i.y+t.y,e},o.UI.Base.prototype.transformToLocal=function(t){var e=null,i=this.getAbsolutePosition();if(o.utils.isArray(t)){e=[];for(var r=0;r<t.length;r++){var n=new o.Math.Dot(0,0),s=t[r];n.x=s.x-i.x,n.y=s.y-i.y,e.push(n)}return e}return(e=new o.Math.Dot(0,0)).x=t.x-i.x,e.y=t.y-i.y,e}}(Ycc),function(e){e.UI.Ellipse=function(t){e.UI.Base.call(this,t),this.yccClass=e.UI.Ellipse,this.point=new e.Math.Dot,this.width=20,this.height=10,this.angle=0,this.color="black",this.fill=!1,this.extend(t)},e.utils.mergeObject(e.UI.Ellipse.prototype,e.UI.Base.prototype),e.UI.Ellipse.prototype.constructor=e.UI.Ellipse,e.UI.Ellipse.prototype.computeUIProps=function(){var t=this.point.x,e=this.point.y,i=this.width/2,r=this.height/2,n=this.angle/180*Math.PI,s=Math.sqrt(Math.cos(n)*Math.cos(n)*r*r+Math.sin(n)*Math.sin(n)*i*i)+e,o=2*e-s,a=Math.sqrt(Math.cos(n)*Math.cos(n)*i*i+Math.sin(n)*Math.sin(n)*r*r)+t,h=2*t-a;this.rect.x=h,this.rect.y=o,this.rect.width=a-h,this.rect.height=s-o},e.UI.Ellipse.prototype.render=function(){var t=this.width,e=this.angle,i=this.height,r=this.getParent(),n=r?r.transformToAbsolute(this.point):this.point;this.ctx.save();var s=i<t?t:i,o=t/s,a=i/s;this.ctx.translate(n.x,n.y),this.ctx.rotate(parseInt(e)*Math.PI/180),this.ctx.translate(-n.x,-n.y),this.ctx.scale(o,a),this.ctx.beginPath(),this.ctx.arc(n.x/o,n.y/a,s/2,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fillStyle=this.ctx.strokeStyle=this.color,this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.restore()}}(Ycc),function(r){r.UI.Circle=function(t){r.UI.Base.call(this,t),this.yccClass=r.UI.Circle,this.point=null,this.r=10,this.color="black",this.fill=!0,this.extend(t)},r.utils.mergeObject(r.UI.Circle.prototype,r.UI.Base.prototype),r.UI.Circle.prototype.computeUIProps=function(){var t=this.point.x,e=this.point.y,i=this.r;this.rect=new r.Math.Rect(t-i,e-i,2*i,2*i)},r.UI.Circle.prototype.render=function(){var t=this.getParent(),e=t?t.transformToAbsolute(this.point):this.point;this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.arc(e.x,e.y,this.r,0,2*Math.PI),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.restore()}}(Ycc),function(g){g.UI.Image=function(t){g.UI.Base.call(this,t),this.yccClass=g.UI.Image,this.fillMode="none",this.res=null,this.mirror=0,this.scale9GridRect=null,this.scaleRepeatRect=null,this.extend(t)},g.utils.mergeObject(g.UI.Image.prototype,g.UI.Base.prototype),g.UI.Image.prototype.constructor=g.UI.Image,g.UI.Image.prototype.computeUIProps=function(){"auto"===this.fillMode&&(this.rect.width=this.res.width,this.rect.height=this.res.height)},g.UI.Image.prototype._processMirror=function(t){1===this.mirror&&(this.ctx.scale(-1,1),this.ctx.translate(2*-t.x-t.width,0)),2===this.mirror&&(this.ctx.scale(1,-1),this.ctx.translate(0,2*-t.y-t.height)),3===this.mirror&&(this.ctx.scale(-1,-1),this.ctx.translate(2*-t.x-t.width,2*-t.y-t.height))},g.UI.Image.prototype.render=function(){this.ctx.save(),this.scaleAndRotate();var t,e,i,r,n,s,o=this.getAbsolutePosition(),a=this.res;if(this._processMirror(o),"none"===this.fillMode)this.ctx.drawImage(this.res,0,0,o.width,o.height,o.x,o.y,o.width,o.height);else if("scale"===this.fillMode)this.ctx.drawImage(this.res,0,0,a.width,a.height,o.x,o.y,o.width,o.height);else if("auto"===this.fillMode)this.ctx.drawImage(this.res,0,0,a.width,a.height,o.x,o.y,o.width,o.height);else if("repeat"===this.fillMode)for(i=parseInt(o.width/a.width)+1,r=parseInt(o.height/a.height)+1,t=0;t<i;t++)for(e=0;e<r;e++)n=a.width,s=a.height,t===i-1&&(n=o.width-t*a.width),e===r-1&&(s=o.height-e*a.height),this.ctx.drawImage(this.res,0,0,n,s,o.x+a.width*t,o.y+a.height*e,n,s);else if("scaleRepeat"===this.fillMode)for(i=parseInt(o.width/this.scaleRepeatRect.width)+1,r=parseInt(o.height/this.scaleRepeatRect.height)+1,t=0;t<i;t++)for(e=0;e<r;e++)n=this.scaleRepeatRect.width,s=this.scaleRepeatRect.height,t===i-1&&(n=o.width-t*this.scaleRepeatRect.width),e===r-1&&(s=o.height-e*this.scaleRepeatRect.height),this.ctx.drawImage(this.res,0,0,a.width,a.height,o.x+this.scaleRepeatRect.width*t,o.y+this.scaleRepeatRect.height*e,n,s);else if("scale9Grid"===this.fillMode){var h,c,l=this.scale9GridRect,u=[];u[0]={},u[0].src=new g.Math.Rect(0,0,l.x,l.y),u[0].dest=new g.Math.Rect(o.x,o.y,l.x,l.y),u[2]={},u[2].src=new g.Math.Rect(l.x+l.width,0,a.width-l.x-l.width,l.y),u[2].dest=new g.Math.Rect(o.width-u[2].src.width+o.x,o.y,u[2].src.width,u[2].src.height),u[6]={},u[6].src=new g.Math.Rect(0,l.y+l.height,l.x,a.height-l.y-l.height),u[6].dest=new g.Math.Rect(o.x,o.y+o.height-u[6].src.height,u[6].src.width,u[6].src.height),u[8]={},u[8].src=new g.Math.Rect(l.x+l.width,l.y+l.height,a.width-l.x-l.width,a.height-l.y-l.height),u[8].dest=new g.Math.Rect(o.width-u[8].src.width+o.x,o.y+o.height-u[8].src.height,u[8].src.width,u[8].src.height),u[1]={},u[1].src=new g.Math.Rect(l.x,0,l.width,l.y),u[1].dest=new g.Math.Rect(u[0].dest.x+u[0].dest.width,o.y,o.width-u[0].dest.width-u[2].dest.width,l.y),u[3]={},u[3].src=new g.Math.Rect(u[0].src.x,l.y,u[0].src.width,l.height),u[3].dest=new g.Math.Rect(u[0].dest.x,u[0].dest.y+u[0].dest.height,u[0].dest.width,o.height-u[0].dest.height-u[6].dest.height),u[5]={},u[5].src=new g.Math.Rect(u[2].src.x,l.y,u[2].src.width,l.height),u[5].dest=new g.Math.Rect(u[2].dest.x,u[3].dest.y,u[2].dest.width,u[3].dest.height),u[7]={},u[7].src=new g.Math.Rect(u[1].src.x,u[6].src.y,l.width,u[6].src.height),u[7].dest=new g.Math.Rect(u[1].dest.x,u[6].dest.y,u[1].dest.width,u[6].dest.height),u[4]={},u[4].src=new g.Math.Rect(l.x,l.y,l.width,l.height),u[4].dest=new g.Math.Rect(u[1].dest.x,u[5].dest.y,u[1].dest.width,u[5].dest.height);for(var d=0;d<u.length;d++)u[d]&&(h=u[d].src,c=u[d].dest,this.ctx.drawImage(this.res,h.x,h.y,h.width,h.height,c.x,c.y,c.width,c.height))}this.ctx.restore()}}(Ycc),function(e){e.UI.ImageFrameAnimation=function(t){e.UI.Base.call(this,t),this.yccClass=e.UI.ImageFrameAnimation,this.res=null,this.frameSpace=1,this.firstFrameRect=null,this.startFrameCount=0,this.frameRectCount=1,this.autoplay=!1,this.isRunning=!1,this.mirror=0,this.extend(t),this.isRunning=this.autoplay},e.utils.mergeObject(e.UI.ImageFrameAnimation.prototype,e.UI.Base.prototype),e.UI.ImageFrameAnimation.prototype.constructor=e.UI.ImageFrameAnimation,e.UI.ImageFrameAnimation.prototype.computeUIProps=function(){},e.UI.ImageFrameAnimation.prototype._processMirror=function(t){1===this.mirror&&(this.ctx.scale(-1,1),this.ctx.translate(2*-t.x-t.width,0)),2===this.mirror&&(this.ctx.scale(1,-1),this.ctx.translate(0,2*-t.y-t.height)),3===this.mirror&&(this.ctx.scale(-1,-1),this.ctx.translate(2*-t.x-t.width,2*-t.y-t.height))},e.UI.ImageFrameAnimation.prototype.render=function(){var t=this.getAbsolutePosition(),e=parseInt((this.belongTo.yccInstance.ticker.frameAllCount-this.startFrameCount)/this.frameSpace)%this.frameRectCount+1;(!this.isRunning||e>=this.frameRectCount)&&(e=0),this.ctx.save(),this.scaleAndRotate(),this._processMirror(t),this.ctx.drawImage(this.res,this.firstFrameRect.x+this.firstFrameRect.width*e,this.firstFrameRect.y,this.firstFrameRect.width,this.firstFrameRect.height,t.x,t.y,t.width,t.height),this.ctx.restore()},e.UI.ImageFrameAnimation.prototype.start=function(){this.startFrameCount=this.belongTo.yccInstance.ticker.frameAllCount,this.isRunning=!0},e.UI.ImageFrameAnimation.prototype.stop=function(){this.isRunning=!1}}(Ycc),function(e){e.UI.Line=function(t){e.UI.Base.call(this,t),this.yccClass=e.UI.Line,this.start=new e.Math.Dot(0,0),this.end=new e.Math.Dot(0,0),this.width=1,this.color="black",this.extend(t)},e.utils.mergeObject(e.UI.Line.prototype,e.UI.Base.prototype),e.UI.Line.prototype.constructor=e.UI.Line,e.UI.Line.prototype.computeUIProps=function(){this.rect.x=this.start.x<this.end.x?this.start.x:this.end.x,this.rect.y=this.start.y<this.end.y?this.start.y:this.end.y,this.rect.width=Math.abs(this.start.x-this.end.x),this.rect.height=Math.abs(this.start.y-this.end.y)},e.UI.Line.prototype.render=function(){var t=this.getParent(),e=t?t.transformToAbsolute(this.start):this.start,i=t?t.transformToAbsolute(this.end):this.end;this.ctx.save(),this.ctx.strokeStyle=this.color,this.ctx.strokeWidth=this.width,this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}}(Ycc),function(e){e.UI.BrokenLine=function(t){e.UI.Base.call(this,t),this.yccClass=e.UI.BrokenLine,this.pointList=[],this.width=1,this.color="black",this.extend(t)},e.utils.mergeObject(e.UI.BrokenLine.prototype,e.UI.Base.prototype),e.UI.BrokenLine.prototype.computeUIProps=function(){if(0===this.pointList.length)return this.rect.x=0,this.rect.y=0,this.rect.width=0,this.rect.height=0,null;for(var t=this.pointList[0].x,e=this.pointList[0].y,i=this.pointList[0].x,r=this.pointList[0].y,n=0;n<this.pointList.length;n++){var s=this.pointList[n];s.x<t?t=s.x:s.x>i&&(i=s.x),s.y<e?e=s.y:s.y>r&&(r=s.y)}this.rect.x=t,this.rect.y=e,this.rect.width=i-t,this.rect.height=r-e},e.UI.BrokenLine.prototype.render=function(){if(this.pointList.length<2)return null;var t=this.getParent();this.ctx.save(),this.ctx.strokeStyle=this.color,this.ctx.strokeWidth=this.width,this.ctx.beginPath();var e=t?t.transformToAbsolute(this.pointList):this.pointList;this.ctx.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)this.ctx.lineTo(e[i].x,e[i].y);this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}}(Ycc),function(e){e.UI.MultiLineText=function(t){e.UI.Base.call(this,t),this.yccClass=e.UI.MultiLineText,this.displayLines=[],this.content="",this.fontSize="16px",this.lineHeight=24,this.fill=!0,this.color="black",this.wordBreak="break-all",this.overflow="auto",this.extend(t)},e.utils.mergeObject(e.UI.MultiLineText.prototype,e.UI.Base.prototype),e.UI.MultiLineText.prototype.constructor=e.UI.MultiLineText,e.UI.MultiLineText.prototype.computeUIProps=function(){var u=this,d=this,n=this.content.split(/(?:\r\n|\r|\n)/);this.displayLines=function(){switch(d.wordBreak){case"no-break":case"break-all":return t();case"break-word":return function(){for(var t=[],e=0;e<n.length;e++){var i=n[e],r=l(i);t=t.concat(r)}return t;function l(t){var e=[],i=u.ctx.measureText(t).width;if(i<=d.rect.width)return e.push(t),e;for(var r=0,n=0;n<t.length;n++){var s=t.slice(0,n+1),o=u.ctx.measureText(s).width,a=t[n];if(" "===a&&(r=n),o>d.rect.width){var h="",c="";return e=" "===a||0===r?(h=t.slice(0,n),e.push(h),c=t.slice(n),e.concat(l(c))):(h=t.slice(0,r),e.push(h),c=t.slice(r),e.concat(l(c)))}}}}();default:return t()}function t(){for(var t=[],e=0;e<n.length;e++){var i=n[e],r=h(i);t=t.concat(r)}return t;function h(t){var e=[],i=u.ctx.measureText(t).width;if(i<=d.rect.width)return e.push(t),e;for(var r=0;r<t.length;r++){var n=t.slice(0,r+1),s=u.ctx.measureText(n).width;if(s>d.rect.width){var o=t.slice(0,r-1);e.push(o);var a=t.slice(r-1);return e=e.concat(h(a))}}}}}(),"auto"===d.overflow&&(d.rect.height=d.lineHeight*this.displayLines.length)},e.UI.MultiLineText.prototype.render=function(t){var e=this;if(e.ctx=t||e.ctx,e.ctx){var i=this,r=this.getAbsolutePosition();this.ctx.save(),this.ctx.fillStyle=i.color,this.ctx.strokeStyle=i.color;for(var n=0;n<e.displayLines.length;n++){var s=r.x,o=r.y+n*i.lineHeight;if(o+i.lineHeight>r.y+r.height)break;this.belongTo.yccInstance.baseUI.text([s,o],e.displayLines[n],i.fill)}this.ctx.restore()}else console.error("[Ycc error]:","ctx is null !")}}(Ycc),function(e){e.UI.Rect=function(t){e.UI.Base.call(this,t),this.yccClass=e.UI.Rect,this.fill=!0,this.color="black",this.extend(t)},e.utils.mergeObject(e.UI.Rect.prototype,e.UI.Base.prototype),e.UI.Rect.prototype.render=function(){var t=this.getAbsolutePosition();this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.restore()}}(Ycc),function(u){u.UI.CropRect=function(t){u.UI.Base.call(this,t),this.yccClass=u.UI.CropRect,this.ctrlSize=6,this.enableDragOut=!1,this.fill=!0,this.ctrlRect1=new u.Math.Rect,this.ctrlRect2=new u.Math.Rect,this.ctrlRect3=new u.Math.Rect,this.ctrlRect4=new u.Math.Rect,this.btns=[],this.btnHeight=38,this.btnVerticalPadding=10,this.showName=!0,this.extend(t),this._initUI()},u.utils.mergeObject(u.UI.CropRect.prototype,u.UI.Base.prototype),u.UI.CropRect.prototype.showBtns=function(t){if(0<this.btns.length){for(var e=0;e<this.btns.length;e++)u.utils.isObj(this.btns[e])&&(this.btns[e].show=t);this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}},u.UI.CropRect.prototype.setCtrlBtns=function(t){var i=this;0!==t.length&&t.forEach(function(t){t=u.utils.extend({content:"",rectBgColor:"#666",color:"#fff",onclick:function(){}},t);var e=new u.UI.SingleLineText(t);e.addListener("mouseover",function(){this.color="#ccc",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),e.addListener("mouseout",function(){this.color="#fff",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),i.btns.push(e),i.belongTo.addUI(e)})},u.UI.CropRect.prototype.computeUIProps=function(){this.belongTo._setCtxProps(this);var t=this.rect,e=0,i=0,r=this.rect.x,n=this.rect.y+this.rect.height,s=this.belongTo.yccInstance.getStageWidth(),o=this.belongTo.yccInstance.getStageHeight();if(this.ctrlRect1=new u.Math.Rect(t.x,t.y,this.ctrlSize,this.ctrlSize),this.ctrlRect2=new u.Math.Rect(t.x+t.width-this.ctrlSize,t.y,this.ctrlSize,this.ctrlSize),this.ctrlRect3=new u.Math.Rect(t.x,t.y+t.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),this.ctrlRect4=new u.Math.Rect(t.x+t.width-this.ctrlSize,t.y+t.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),0!==this.btns.length){for(var a=0;a<this.btns.length;a++){var h=this.btns[a];h.overflow="auto",h.xAlign="center",h.rect.width=parseInt(this.ctx.measureText(h.content).width+2*this.btnVerticalPadding),h.rect.height=this.btnHeight,e+=h.rect.width+1}s<r+e&&(r=s-e),n+this.btnHeight>o&&(n=this.rect.y<this.btnHeight?0:this.rect.y-this.btnHeight-2);for(var c=0;c<this.btns.length;c++){var l=this.btns[c];l.rect.x=r+i,l.rect.y=n+2,i+=l.rect.width+1}}},u.UI.CropRect.prototype._initUI=function(){var r=this,c=null,l=null;this.userData=this.userData?this.userData:{},this.addListener("dragstart",function(t){this.userData.ctrlStart=0,this.userData.dragStartPosition=new u.Math.Rect(this.rect),this.userData.dragStartMousePosition=new u.Math.Dot(t);var e=new u.Math.Dot(t);c=e,l=new u.Math.Rect(r.rect);for(var i=1;i<=4;i++)if(e.isInRect(this["ctrlRect"+i]))return this.userData.ctrlStart=i,null}),this.addListener("dragging",function(t){var e,i,r,n,s=this.userData.dragStartPosition,o=this.userData.dragStartMousePosition;if(this.userData.ctrlStart<=4&&1<=this.userData.ctrlStart?(1===this.userData.ctrlStart&&(e=t.x-(o.x-s.x),i=t.y-(o.y-s.y),r=s.width-(t.x-s.x),n=s.height-(t.y-s.y),e<=s.x+s.width-2*this.ctrlSize&&(this.rect.x=e),i<=s.y+s.height-2*this.ctrlSize&&(this.rect.y=i)),2===this.userData.ctrlStart&&(e=s.x,i=t.y-(o.y-s.y),r=t.x-s.x+(s.width+s.x-o.x),n=s.height-(t.y-s.y),this.rect.x=e,i<=s.y+s.height-2*this.ctrlSize&&(this.rect.y=i)),3===this.userData.ctrlStart&&(e=t.x-(o.x-s.x),i=s.y,r=s.width-(t.x-s.x),n=t.y-s.y+(s.height+s.y-o.y),e<=s.x+s.width-2*this.ctrlSize&&(this.rect.x=e),this.rect.y=i),4===this.userData.ctrlStart&&(this.rect.x=s.x,this.rect.y=s.y,this.rect.width=t.x-s.x+(s.x+s.width-o.x),this.rect.height=t.y-s.y+(s.y+s.height-o.y)),r>=2*this.ctrlSize&&(this.rect.width=r),n>=2*this.ctrlSize&&(this.rect.height=n)):(this.rect.x=l.x+t.x-c.x,this.rect.y=l.y+t.y-c.y),this.rect.width<=2*this.ctrlSize&&(this.rect.width=2*this.ctrlSize),this.rect.height<=2*this.ctrlSize&&(this.rect.height=2*this.ctrlSize),!this.enableDragOut){var a=this.belongTo.yccInstance.getStageWidth(),h=this.belongTo.yccInstance.getStageHeight();this.rect.x<=0&&(this.rect.x=0),this.rect.y<=0&&(this.rect.y=0),this.rect.x+this.rect.width>=a&&(this.rect.x=a-this.rect.width),this.rect.y+this.rect.height>=h&&(this.rect.y=h-this.rect.height)}this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),this.addListener("dragend",function(t){r.showBtns(!0)})},u.UI.CropRect.prototype.render=function(){var t=this.rect;this.ctx.save(),this.ctx.fillStyle=this.fillStyle,this.ctx.strokeStyle=this.strokeStyle,this.ctx.beginPath(),this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.beginPath(),this.ctx.rect(this.ctrlRect1.x,this.ctrlRect1.y,this.ctrlRect1.width,this.ctrlRect1.height),this.ctx.rect(this.ctrlRect2.x,this.ctrlRect2.y,this.ctrlRect2.width,this.ctrlRect2.height),this.ctx.rect(this.ctrlRect3.x,this.ctrlRect3.y,this.ctrlRect3.width,this.ctrlRect3.height),this.ctx.rect(this.ctrlRect4.x,this.ctrlRect4.y,this.ctrlRect4.width,this.ctrlRect4.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="blue",this.ctx.font="normal normal bold 14px Arial",this.ctx.fillText(this.name,t.x+10,t.y+10),this.ctx.closePath(),this.ctx.restore()},u.UI.CropRect.prototype.removeSelf=function(){this.belongTo.removeUI(this),this.btns.forEach(function(t){t.removeSelf()})}}(Ycc),function(e){e.UI.SingleLineText=function(t){e.UI.Base.call(this,t),this.yccClass=e.UI.SingleLineText,this.displayContent="",this.content="",this.fontSize="16px",this.fill=!0,this.color="black",this.xAlign="left",this.yAlign="center",this.overflow="auto",this.extend(t)},e.utils.mergeObject(e.UI.SingleLineText.prototype,e.UI.Base.prototype),e.UI.SingleLineText.prototype.constructor=e.UI.SingleLineText,e.UI.SingleLineText.prototype.computeUIProps=function(){var t=this;t.belongTo._setCtxProps(t);var e=this.ctx.measureText(this.content).width;this.displayContent=this.content,e>this.rect.width&&("hidden"===this.overflow?t.displayContent=t.getMaxContentInWidth(this.content,this.rect.width):"auto"===this.overflow&&(this.rect.width=e)),"hidden"===this.overflow?e>this.rect.width&&(t.displayContent=t.getMaxContentInWidth(this.content,this.rect.width)):"auto"===this.overflow&&(e>this.rect.width&&(this.rect.width=e),parseInt(this.fontSize)>this.rect.height&&(this.rect.height=parseInt(this.fontSize)))},e.UI.SingleLineText.prototype.render=function(t){var e=this;if(e.belongTo._setCtxProps(e),e.ctx=t||e.ctx,e.ctx){var i,r,n=parseInt(e.fontSize),s=this.getAbsolutePosition();i=s.x;var o=this.ctx.measureText(this.displayContent).width;if("center"===this.xAlign&&(i+=(s.width-o)/2),"right"===this.xAlign&&(i+=s.width-o),r=s.y,n>s.height)return console.warn("[Ycc warning] : ","行高不够，或者文字太大！",this);"center"===this.yAlign&&(r=r+s.height/2-n/2),this.ctx.save(),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.fillText(e.displayContent,i,r),this.ctx.restore()}else console.error("[Ycc error]:","ctx is null !")}}(Ycc),"undefined"!=typeof wx&&((module.exports=Ycc).utils.isMobile=function(){return console.log("wx isMobile"),!0},"undefined"!=typeof performance&&(performance.now=function(){return Date.now()})),GameScene.prototype.init=function(){this["level_"+this.gameLevel]&&this["level_"+this.gameLevel](),this.collisionListenerInit(),bgmAutoplay&&(audios.bgm.currentTime=0,audios.bgm.play())},GameScene.prototype.bindMatterBodyWithUI=function(t,e){(e._matterBody=t)._yccUI=e},GameScene.prototype.getMatterBodyFromUI=function(t){return t._matterBody},GameScene.prototype.getUIFromMatterBody=function(t){return t._yccUI},GameScene.prototype.levelCommonSetting=function(t,e,i){t=t||"bg01",e=e||2,i=i||9999,this.createBackground(t,i,stageH,e),this.createGameOverLayer(),this.createDirectionBtn(),this.createSkillBtn(),this.createCoinUI(),this.newDeadLine(i,-100),this.newBounds(8)},GameScene.prototype.levelCommonEnd=function(t){t=t||1800,this.newFlag(t,200,400),this.newGround(t,200,1e3),this.endBucket=this.newBucket(t+stageW-90,190,4,90,90),this.createMario()},GameScene.prototype.levelCommonOnVictory=function(){var t=this.endBucket;-1<this.marioContactWith.indexOf(t._matterBody)&&(Matter.World.remove(engine.world,t._matterBody),this.gameOverLayer.show=!0);var e=t.belongTo.uiList,i=e.indexOf(t);e.splice(i,1),e.push(t)},GameScene.prototype.debug=function(){var t=Matter.Composite.allBodies(engine.world),e=ycc.ctx;e.save(),e.beginPath();for(var i=0;i<t.length;i+=1){var r=t[i].vertices;e.moveTo(r[0].x+this.layer.x,r[0].y);for(var n=1;n<r.length;n+=1)e.lineTo(r[n].x+this.layer.x,r[n].y);e.lineTo(r[0].x+this.layer.x,r[0].y)}e.lineWidth=2,e.strokeStyle="#999",e.stroke(),e.restore()},GameScene.prototype.collisionListenerInit=function(){var o=this;function a(t,e){return e?e===t.bodyA?t.bodyB:e===t.bodyB?t.bodyA:void 0:null}function h(t){var e=o.getMatterBodyFromUI(o.mario);return t.bodyA.label===e.label?t.bodyA:t.bodyB.label===e.label?t.bodyB:null}Matter.Events.on(engine,"collisionStart",function(t){for(var e=0;e<t.pairs.length;e++){var i=t.pairs[e],r=h(i),n=a(i,r);if(r&&n)-1===o.marioContactWith.indexOf(n)&&o.marioContactWith.push(n)}}),Matter.Events.on(engine,"collisionEnd",function(t){for(var e=0;e<t.pairs.length;e++){var i=t.pairs[e],r=h(i),n=a(i,r);if(r&&n){var s=o.marioContactWith.indexOf(n);-1!==s&&o.marioContactWith.splice(s,1)}}}),Matter.Events.on(engine,"collisionActive",function(t){for(var e=0;e<t.pairs.length;e++){var i=t.pairs[e],r=h(i),n=a(i,r);if(r&&n)-1===o.marioContactWith.indexOf(n)&&o.marioContactWith.push(n)}})},GameScene.prototype.isFighting=function(){var t=0<this.mario._fightFrameCount&&ycc.ticker.frameAllCount-this.mario._fightFrameCount<6;return t||(this.mario._fightFrameCount=0),t},GameScene.prototype.marioStayingOnWallCompute=function(){for(var t=0;t<this.marioContactWith.length;t++){var e=this.marioContactWith[t];if(-1!==["wall","ground","bucket","flag","girl","mushroom","wallBox"].indexOf(e.label)){var i=this.mario.rect,r=this.getUIFromMatterBody(e).rect;if(this.marioStayingOnWall=parseInt(i.y+i.height)<=e.vertices[0].y&&i.x+i.width>=e.vertices[0].x&&i.x<e.vertices[0].x+r.width,this.marioStayingOnWall)return}}this.marioStayingOnWall=!1},GameScene.prototype.updateUIPosition=function(){var t=Matter.Composite.allBodies(engine.world);audios.bgm.running?(this.musicBtn.children[0].show=!1,this.musicBtn.rotation+=1):(this.musicBtn.children[0].show=!0,this.musicBtn.rotation=0);for(var e=0;e<t.length;e++){var i=t[e],r=this.getUIFromMatterBody(i);"mushroom"===i.label&&(r.rect.x=i.vertices[0].x,r.rect.y=i.vertices[0].y,i.restitution=0===i.velocity.y?1:0,Matter.Body.setVelocity(i,{x:0<=i.velocity.x?1:-1,y:i.velocity.y}),Matter.Body.setAngle(i,0)),"missile"===i.label&&(Matter.Body.setPosition(i,{x:i.position.x-2*ycc.ticker.deltaTimeRatio,y:i.position.y}),r.rect.x=i.vertices[0].x-5,r.rect.y=i.vertices[0].y)}},GameScene.prototype.jumpIsPressingCompute=function(){this.jumpIsPressing&&this.marioStayingOnWall&&(Matter.Body.setVelocity(this.getMatterBodyFromUI(this.mario),{x:0,y:-10}),audios.jump.currentTime=0,audios.jump.play()),this.jumpIsPressing=!1},GameScene.prototype.updateMarioBodyVerticesByMarioRect=function(){var t=new Ycc.Math.Rect(this.mario.rect);t.x+=6,t.width-=16,Matter.Body.setVertices(this.getMatterBodyFromUI(this.mario),t.getVertices()),t=null},GameScene.prototype.marioImageResCompute=function(){var t=this.getMatterBodyFromUI(this.mario),e=t.position;!this.marioStayingOnWall||this.isFighting()||this.downIsPressing?this.marioStayingOnWall?this.downIsPressing?(console.log("下蹲"),this.mario.res=images.marioDown,this.mario.frameRectCount=1,e.y+=(this.mario.rect.height-2*this.mario.res.naturalHeight)/2,this.mario.rect.height=2*this.mario.res.naturalHeight,this.updateMarioBodyVerticesByMarioRect(),this.mario.firstFrameRect.height=this.mario.res.naturalHeight,Matter.Body.setPosition(t,e)):this.marioStayingOnWall&&this.isFighting()&&(this.mario.res=images.marioFight,this.mario.frameRectCount=1):(this.mario.res=this.downIsPressing?images.marioDown:images.marioJump,this.mario.frameRectCount=1,this.isGameVictory&&(this.mario.res=images.marioTouchFlag),this.downTouchEndFlag&&(this.mario.rect.height=2*this.mario.res.naturalHeight,this.updateMarioBodyVerticesByMarioRect(),this.downTouchEndFlag=!1,this.mario.firstFrameRect.height=this.mario.res.naturalHeight)):(this.mario.res=images.mario,this.mario.frameRectCount=3,this.downTouchEndFlag&&(this.mario.rect.height=2*this.mario.res.naturalHeight,this.updateMarioBodyVerticesByMarioRect(),this.downTouchEndFlag=!1),this.mario.firstFrameRect.height=this.mario.res.naturalHeight)},GameScene.prototype.marioContactWithCompute=function(){for(var t=this,e=t.getMatterBodyFromUI(this.mario),i=0;i<this.marioContactWith.length;i++){var r=this.marioContactWith[i];if("flag"===r.label&&(this.isGameVictory=!0,this.marioStayingOnWall&&(audios.bgm.pause(),audios.victory.currentTime=0,audios.victory.play(),Matter.World.remove(engine.world,r))),"coin"===r.label&&(audios.touchCoin.currentTime=0,audios.touchCoin.play(),t.layer.removeUI(t.getUIFromMatterBody(r)),Matter.World.remove(engine.world,r),t.score++,t.coinUI.content="× "+t.score),"mushroom"===r.label&&(1===this.marioContactWith.length&&this.marioStayingOnWall?(audios.touchMushroom.currentTime=0,audios.touchMushroom.play(),t.layer.removeUI(t.getUIFromMatterBody(r)),Matter.World.remove(engine.world,r),Matter.Body.setVelocity(e,{x:0,y:-4})):2===this.marioContactWith.length&&"mushroom"===this.marioContactWith[0].label&&"mushroom"===this.marioContactWith[1].label&&this.marioStayingOnWall?(audios.touchMushroom.currentTime=0,audios.touchMushroom.play(),t.layer.removeUI(t.getUIFromMatterBody(this.marioContactWith[0])),Matter.World.remove(engine.world,this.marioContactWith[0]),t.layer.removeUI(t.getUIFromMatterBody(this.marioContactWith[1])),Matter.World.remove(engine.world,this.marioContactWith[1]),Matter.Body.setVelocity(e,{x:0,y:-4})):(Matter.World.remove(engine.world,r),t.marioDeadProcess())),"wallBox"===r.label&&!this.marioStayingOnWall){var n=this.mario.rect,s=this.getUIFromMatterBody(r).rect;parseInt(n.y)>=r.vertices[0].y+s.height&&n.x+n.width-16>r.vertices[0].x&&n.x<=r.vertices[0].x+s.width-17&&this.marioHitWall(r)}"missile"===r.label&&Matter.World.remove(engine.world,r),"deadLine"!==r.label&&"missile"!==r.label||t.marioDeadProcess()}},GameScene.prototype.marioDeadProcess=function(){audios.bgm.pause(),Matter.World.remove(engine.world,this.mario._matterBody),this.update=null,this.btnLayer.enableEventManager=!1,this.direction="",this.mario.stop(),audios.dead2.play(),this.gameOverLayer.show=!0},GameScene.prototype.gameVictoryCompute=function(){if(this.isGameVictory){var t=this.getMatterBodyFromUI(this.mario);if(Matter.Body.setVelocity(t,{x:0,y:t.velocity.y}),this.direction="left",this.marioStayingOnWall){var e=t.position;!this.mario.isRunning&&this.mario.start(),Matter.Body.setPosition(t,{x:e.x+3*ycc.ticker.deltaTimeRatio,y:e.y})}var i="level_"+this.gameLevel+"_onVictory";this[i]?this[i]():this.levelCommonOnVictory()}},GameScene.prototype.directionCompute=function(){var t=this.getMatterBodyFromUI(this.mario),e=t.position;this.isGameVictory||this.marioStayingOnWall&&this.downIsPressing||("left"===this.direction&&Matter.Body.setPosition(t,{x:e.x-3*ycc.ticker.deltaTimeRatio,y:e.y}),"right"===this.direction&&Matter.Body.setPosition(t,{x:e.x+3*ycc.ticker.deltaTimeRatio,y:e.y}))},GameScene.prototype.marioHitWall=function(t){var p=this,e=this.getUIFromMatterBody(t),i=e.getAbsolutePosition(),r=this.mario.getAbsolutePosition(),n=r.x+r.width/2;if(console.log("mario middle x--\x3e ",n),n<=i.x)return console.log("撞第一块"),void a(e,0,1);if(n>=i.x+i.width)return console.log("撞最后一块"),void a(e,e.children.length-1,1);for(var s=0;s<e.children.length;s++){var o=e.children[s].getAbsolutePosition();if(n<o.width+o.x&&n>o.x)return void a(e,s,1);if(n===o.x)return console.log("撞相邻两块"),void a(e,s,2)}function a(t,e,i){var r=t.rect,n=t.children,s=n.length;if(0===n[e].__specialType&&0===n[e+i-1].__specialType){if(audios.touchWall.currentTime=0,audios.touchWall.play(),s<=i)console.log("一块都不剩");else if(0<e&&e+i<s)console.log("分成两块"),p.newWall(n[0].getAbsolutePosition().x-p.layer.x,stageH-(r.y+r.height),1,e,g(0,e)),p.newWall(n[e+i].getAbsolutePosition().x-p.layer.x,stageH-(r.y+r.height),1,s-e-i,g(e+i,s-1));else{console.log("还剩一块");var o=0,a=null;1===i&&(0===e?(a=g(o=1,s-1),__log=JSON.stringify(a)):a=g(o=0,e)),2===i&&(a=1===e?(o=i,g(e,s-1)):g(o=0,e));var h=n[o].getAbsolutePosition().x-p.layer.x;p.newWall(h,stageH-(r.y+r.height),1,s-i,a)}Matter.World.remove(engine.world,p.getMatterBodyFromUI(t)),p.layer.removeUI(t)}else{var c=1===n[e].__specialType&&n[e]||1===n[e+i-1].__specialType&&n[e+i-1];if(c){c.__coinNumber--,p.score++,p.coinUI.content="× "+p.score,audios.touchCoin.currentTime=0,audios.touchCoin.play();var l=c.getAbsolutePosition();if(p.newCoinAnimation(l.x+l.width/2-p.layer.x,stageH-l.y,2,6),0===c.__coinNumber){c.__specialType=2;var u=n[0].getAbsolutePosition().x-p.layer.x,d=g(0,s-1);p.newWall(u,stageH-(r.y+r.height),1,s,d),Matter.World.remove(engine.world,p.getMatterBodyFromUI(t)),p.layer.removeUI(t),u=0,d=null}}}function g(t,e){for(var i=[],r=t;r<=e;r++)0!==n[r].__specialType&&i.push([0,r-t,n[r].__specialType,n[r].__coinNumber]);return i}}},GameScene.prototype.removeUI=function(t){var e=t._matterBody;e&&(t._matterBody._yccUI=null,t._matterBody=null,Matter.World.remove(engine.world,e)),this.layer.removeUI(t)},GameScene.prototype.update=function(){var t=this.getMatterBodyFromUI(this.mario);Matter.Body.setAngle(t,0),Matter.Body.setAngularVelocity(t,0),this.marioStayingOnWallCompute(),this.jumpIsPressingCompute(),this.marioImageResCompute(),this.marioContactWithCompute(),this.directionCompute(),this.mario.rect.x=t.vertices[0].x-8,this.mario.rect.y=t.vertices[0].y,this.updateUIPosition(),this.gameVictoryCompute(),0<this.mario.rect.x-stageW/2&&this.mario.rect.x<this.endPoint&&(this.layer.x=-(this.mario.rect.x-stageW/2))},function(t){t.prototype.newGround=function(t,e,i){var r=new Ycc.UI.Image({rect:new Ycc.Math.Rect(t,stageH-e,i,e),res:images.wall,fillMode:"repeat",name:"ground"});this.layer.addUI(r);var n=r.rect,s=r;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(n.x+n.width/2,n.y+n.height/2,n.width,n.height,{isStatic:!0,label:"ground",friction:0,frictionStatic:0,frictionAir:0,restitution:0}),s),Matter.World.add(engine.world,this.getMatterBodyFromUI(s)),s=n=null,r},t.prototype.newWall=function(t,e,i,r,n){for(var s=e,o=0;o<i;o++){var a=new Ycc.UI.Rect({rect:new Ycc.Math.Rect(t,stageH-s-40*(o+1),40*r,40),color:"rgba(0,0,0,0)",name:"wallBox"});this.layer.addUI(a);var h=a.rect,c=a;this.bindMatterBodyWithUI(Matter.Bodies.rectangle(h.x+h.width/2,h.y+h.height/2,h.width,h.height,{isStatic:!0,friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"wallBox",collisionFilter:{group:-1}}),c),Matter.World.add(engine.world,this.getMatterBodyFromUI(c)),c=h=null;for(var l=0;l<r;l++){var u=y(o,l),d=u&&u[2]||0,g=new Ycc.UI.Image({rect:new Ycc.Math.Rect(40*l,0,40,40),res:p(d),fillMode:"scaleRepeat",scaleRepeatRect:new Ycc.Math.Rect(0,0,40,40),name:"wall"});g.__specialType=d,g.__coinNumber=1===d&&u[3]||0,a.addChild(g)}}function p(t){return 0===t?images.wall:1===t?images.wallSpecial01:2===t?images.wallSpecial02:void 0}function y(t,e){if(!n||0===n.length)return null;for(var i=0;i<n.length;i++)if(n[i][0]===t&&n[i][1]===e)return n[i];return null}},t.prototype.newCoin=function(t,e,i,r){for(var n=0;n<i;n++)for(var s=0;s<r;s++){var o=new Ycc.UI.Image({rect:new Ycc.Math.Rect(t+31*s,stageH-e-44*n,21,34),res:images.coin100,fillMode:"scale",name:"coin"});this.layer.addUI(o);var a=o.rect,h=o;this.bindMatterBodyWithUI(Matter.Bodies.rectangle(a.x+a.width/2,a.y+a.height/2,a.width,a.height,{isStatic:!0,isSensor:!0,friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"coin"}),h),Matter.World.add(engine.world,this.getMatterBodyFromUI(h)),h=a=null}},t.prototype.newCoinAnimation=function(t,e,i,r){var n=this,s=20;i=i||2,r=r||4;var o=t-s/2,a=new Ycc.UI.Image({rect:new Ycc.Math.Rect(o,stageH-e-34,s,34),res:images.coin100,fillMode:"scale",name:"coinAnimation"}),h=a.rect,c=a,l=Matter.Bodies.rectangle(h.x+h.width/2,h.y+h.height/2,h.width,h.height,{friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"coinAnimation",collisionFilter:{group:-1}});function u(){var t=this;t.mirrorCount=t.mirrorCount||0,t.zoomOut=!!t.zoomOut,Matter.Body.setAngle(l,0),t.rect.y=l.vertices[0].y,0===t.rect.width&&(t.zoomOut=!0,t.mirrorCount++),t.rect.width===s&&(t.zoomOut=!1),t.mirrorCount%2==0?t.mirror=0:t.mirror=1,t.zoomOut?(t.rect.x-=i/2,t.rect.width+=i):(t.rect.x+=i/2,t.rect.width-=i)}this.bindMatterBodyWithUI(l,c),Matter.World.add(engine.world,l),Matter.Body.setVelocity(l,{x:0,y:-r}),c=h=null,console.log(l),a.addListener("computestart",u),a.addListener("renderend",function t(){0===parseInt(l.velocity.y)&&(a.removeListener("computestart",u),a.removeListener("renderend",t),n.removeUI(this))}),this.layer.addUI(a)},t.prototype.newGirl=function(t,e){var i=new Ycc.UI.Image({rect:new Ycc.Math.Rect(t,stageH-e-64,36,64),res:images.girl,fillMode:"scale",name:"girl"});this.layer.addUI(i);var r=i.rect,n=i,s=r.width,o=r.height;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(r.x+r.width/2,r.y+r.height/2,s,o,{isStatic:!0,label:"girl",friction:0,frictionStatic:0,frictionAir:0,restitution:0}),n),Matter.World.add(engine.world,this.getMatterBodyFromUI(n)),n=r=null,i},t.prototype.newMissile=function(t,e){var i="missile",r=new Ycc.UI.Image({rect:new Ycc.Math.Rect(t,stageH-e-20,30,20),res:images.missile,fillMode:"scale",name:i});this.layer.addUI(r);var n=r.rect,s=r,o=n.width,a=n.height;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(n.x+n.width/2+5,n.y+n.height/2,o,a,{isStatic:!0,label:i,friction:0,frictionStatic:0,frictionAir:0,restitution:0}),s),Matter.World.add(engine.world,this.getMatterBodyFromUI(s)),s=n=null,r},t.prototype.newMushroom=function(t,e){var i="mushroom",r=new Ycc.UI.Image({rect:new Ycc.Math.Rect(t,stageH-e-38,36,38),res:images.mushroom,fillMode:"scale",name:i});this.layer.addUI(r);var n=r.rect,s=r,o=n.width,a=n.height;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(n.x+n.width/2,n.y+n.height/2,o,a,{label:i,friction:0,frictionStatic:0,frictionAir:0,restitution:0}),s),Matter.World.add(engine.world,this.getMatterBodyFromUI(s)),Matter.Body.setVelocity(this.getMatterBodyFromUI(s),{x:-1,y:0}),s=n=null,r},t.prototype.newBucket=function(t,e,i,r,n){var s=e;r=r||80,n=n||90;var o=new Ycc.UI.Image({rect:new Ycc.Math.Rect(t,stageH-s-n,r,n),res:images.bucket,fillMode:"scale",name:"bucket",anchorX:r/2,anchorY:n/2,rotation:[0,0,90,180,270][i||1]});this.layer.addUI(o);var a=o.rect,h=o,c=a.width,l=a.height;return 90!==o.rotation&&270!==o.rotation||(a.x+=(n-r)/2,a.y+=(n-r)/2,c=a.height,l=a.width),this.bindMatterBodyWithUI(Matter.Bodies.rectangle(a.x+a.width/2,a.y+a.height/2,c,l,{isStatic:!0,label:"bucket",friction:0,frictionStatic:0,frictionAir:0,restitution:0}),h),Matter.World.add(engine.world,this.getMatterBodyFromUI(h)),h=a=null,o},t.prototype.newFlag=function(t,e,i){this.endPoint=t+stageW/2,this.newBounds(t+stageW);var r=i||images.flag.naturalHeight,n=images.flag.naturalWidth,s=new Ycc.UI.Image({rect:new Ycc.Math.Rect(t,stageH-e-r,n,r),res:images.flag,fillMode:"scale9Grid",scale9GridRect:new Ycc.Math.Rect(16,78,8,14),name:"flag"});this.layer.addUI(s);var o=s.rect,a=s;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(o.x+16,o.y+o.height/2,1,9999,{isStatic:!0,label:"flag",friction:0,frictionStatic:0,frictionAir:0,restitution:0}),a),Matter.World.add(engine.world,this.getMatterBodyFromUI(a)),a=o=null,s},t.prototype.newBounds=function(t){Matter.World.add(engine.world,Matter.Bodies.rectangle(t,0,1,2*stageH,{isStatic:!0,friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"bound"}))},t.prototype.newDeadLine=function(t,e){Matter.World.add(engine.world,Matter.Bodies.rectangle(t/2,stageH-e,t,1,{isStatic:!0,isSensor:!0,friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"deadLine"}))},t.prototype.createMario=function(){this.mario=new Ycc.UI.ImageFrameAnimation({rect:new Ycc.Math.Rect(10,0,36,2*images.mario.naturalHeight),res:images.mario,firstFrameRect:new Ycc.Math.Rect(0,0,18,images.mario.naturalHeight),frameRectCount:3,frameSpace:8}),this.mario._fightFrameCount=0,this.layer.addUI(this.mario);var t=this.mario.rect,e=this.mario;this.bindMatterBodyWithUI(Matter.Bodies.rectangle(t.x+t.width/2+8,t.y+t.height/2,t.width-16,t.height,{friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"Mario"}),e),this.updateMarioBodyVerticesByMarioRect(),Matter.World.add(engine.world,this.getMatterBodyFromUI(e)),e=t=null},t.prototype.createBackground=function(t,e,i,r){var n=images[t],s=null;s=1===(r=r||1)?new Ycc.Math.Rect(0,0,n.naturalWidth,n.naturalHeight):new Ycc.Math.Rect(0,0,n.naturalWidth/n.naturalHeight*stageH,stageH);var o=new Ycc.UI.Image({rect:new Ycc.Math.Rect(0,0,e,i),res:n,fillMode:"scaleRepeat",scaleRepeatRect:s,name:"bg"});this.layer.addUI(o)},t.prototype.createCoinUI=function(){var t=new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW-100,10,10,15),res:images.coin100,fillMode:"scale",name:"coinUI"}),e=new Ycc.UI.SingleLineText({content:"× 0",rect:new Ycc.Math.Rect(15,0,40,20),color:"yellow"});t.addChild(e),this.btnLayer.addUI(t),this.coinUI=e},t.prototype.createDirectionBtn=function(){var e=this;e.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(20,stageH-130,50,50),fillMode:"scale",anchorX:25,anchorY:25,res:images.btn,rotation:180,ondragstart:function(t){e.isGameVictory||(e.mario.mirror=1,e.mario.start(),e.direction="left")},ondragend:function(t){e.isGameVictory||(e.mario.stop(),e.direction="")}})),e.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(90,stageH-130,50,50),fillMode:"scale",anchorX:25,anchorY:25,res:images.btn,rotation:0,ondragstart:function(t){e.isGameVictory||(e.mario.mirror=0,e.mario.start(),e.direction="right")},ondragend:function(t){e.isGameVictory||(e.mario.stop(),e.direction="")}})),e.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(55,stageH-60,50,50),fillMode:"scale",anchorX:25,anchorY:25,res:images.btn,rotation:90,ondragstart:function(t){e.isGameVictory||(e.marioStayingOnWall?e.downIsPressing=!0:console.log("人物当前状态不能下蹲!"))},ondragend:function(t){e.isGameVictory||(e.downIsPressing=!1,e.downTouchEndFlag=!0)}}));var i=!0;window.onkeydown=function(t){if(!e.isGameVictory){if(38===t.keyCode&&i&&(i=!1,e.jumpIsPressing=!0),37===t.keyCode&&(e.mario.mirror=1,!e.mario.isRunning&&e.mario.start(),e.direction="left"),39===t.keyCode&&(e.mario.mirror=0,!e.mario.isRunning&&e.mario.start(),e.direction="right"),40===t.keyCode){if(!e.marioStayingOnWall)return void console.log("人物当前状态不能下蹲!");e.downIsPressing=!0}if(88===t.keyCode){if(e.isFighting())return;e.mario._fightFrameCount=ycc.ticker.frameAllCount}67===t.keyCode&&i&&(i=!1,e.jumpIsPressing=!0)}},window.onkeyup=function(t){38===t.keyCode&&(i=!0,e.jumpIsPressing=!1),37===t.keyCode&&(e.mario.stop(),e.direction=""),39===t.keyCode&&(e.mario.stop(),e.direction=""),40===t.keyCode&&(e.downIsPressing=!1,e.downTouchEndFlag=!0),67===t.keyCode&&(i=!0,e.jumpIsPressing=!1)}},t.prototype.createSkillBtn=function(){var e=this;e.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW-50-20,stageH-70,50,50),fillMode:"scale",res:images.jump,ontap:function(t){e.isGameVictory||e.jumpIsPressing||(e.jumpIsPressing=!0)}})),e.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW-100-15-20,stageH-70,50,50),fillMode:"scale",res:images.fight,ontap:function(t){e.isGameVictory||e.isFighting()||(e.mario._fightFrameCount=ycc.ticker.frameAllCount)}})),this.createMusicBtn()},t.prototype.createMusicBtn=function(){var t=new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW-40,10,30,30),anchorX:15,anchorY:15,fillMode:"scale",res:images.music,name:"musicBtn",ontap:function(t){audios.bgm.running?audios.bgm.pause():audios.bgm.play()}});t.addChild(new Ycc.UI.Line({start:new Ycc.Math.Dot(5,5),end:new Ycc.Math.Dot(25,25),width:5,color:"#ccc",ontap:function(t){audios.bgm.running?audios.bgm.pause():audios.bgm.play()}})),this.musicBtn=t,this.btnLayer.addUI(t)},t.prototype.createGameOverLayer=function(){var e=this;this.gameOverLayer=ycc.layerManager.newLayer({enableEventManager:!0,name:"游戏结束图层",show:!1});var t,i,r=new Ycc.UI.Rect({rect:new Ycc.Math.Rect(0,0,stageW,stageH),color:"rgba(0,0,0,0.6)"});function n(){Matter.Composite.allBodies(engine.world).forEach(function(t){t._yccUI&&(t._yccUI._matterBody=null,t._yccUI=null),Matter.World.remove(engine.world,t)}),Matter.Engine.clear(engine),e.btnLayer.removeSelf(),e.layer.removeSelf(),e.gameOverLayer.removeSelf(),e.update=null,currentScene=null}t=new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW/2-110,stageH/2+50,100,40),res:images.button,fillMode:"scale",oncomputestart:function(){e.isGameVictory?this.rect.x=stageW/2-110:this.rect.x=stageW/2-50}}),i=new Ycc.UI.SingleLineText({rect:new Ycc.Math.Rect(0,0,100,40),fontSize:"16px",content:"重新开始",xAlign:"center",yAlign:"center",ontap:function(){console.log("restart"),n(),projectInit("#"+e.gameLevel)}}),t.addChild(i),r.addChild(t),t=new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW/2,stageH/2+50,100,40),res:images.button,show:!1,fillMode:"scale"}),i=new Ycc.UI.SingleLineText({rect:new Ycc.Math.Rect(0,0,100,40),fontSize:"16px",content:"下一关",xAlign:"center",yAlign:"center",ontap:function(){console.log("nextLevel"),n();var t=levelList.indexOf(e.gameLevel);if(-1===t)return;if(t===levelList.length-1)return alert("恭喜你！玩通关了！点击返回第一关！"),"undefined"!=typeof wx?projectInit("#"+levelList[0]):(window.location.href=window.location.pathname+"#"+levelList[0],void window.location.reload());if("undefined"!=typeof wx)return projectInit("#"+levelList[t+1]);window.location.href=window.location.pathname+"#"+levelList[t+1],window.location.reload()},oncomputestart:function(){e.isGameVictory?(this.getParent().show=!0,this.show=!0,this.content="下一关"):(this.getParent().show=!1,this.show=!1)}}),t.addChild(i),r.addChild(t),this.gameOverLayer.addUI(r)}}(GameScene),GameScene.prototype.level_1_1=function(){this.levelCommonSetting(),function(){this.newGround(0,150,450),this.newMushroom(220,180),this.newMushroom(260,180),this.newMushroom(300,180),this.newBucket(100,150),this.newCoin(100,300,1,4),this.newBucket(350,150),this.newCoin(380,300,1,1),this.newCoin(450,350,1,1),this.newGround(550,150,100),this.newCoin(550,350,1,2),this.newWall(700,250,1,3),this.newCoin(700,450,1,5),this.newWall(850,400,1,3),this.newCoin(850,450,1,2),this.newWall(1050,50,1,3),this.newCoin(1050,250,1,5),this.newWall(1200,0,2,1),this.newWall(1240,0,3,1),this.newWall(1280,0,4,1),this.newWall(1320,0,5,1),this.newWall(1360,0,6,1),this.newWall(1400,0,7,1),this.newWall(1460,0,8,1),this.newWall(1560,0,10,1),this.newMissile(300,300),this.newMissile(1300,400),this.newMissile(2300,500)}.call(this),this.levelCommonEnd(1650)},GameScene.prototype.level_1_2=function(){this.levelCommonSetting(),function(){this.newGround(0,150,500),this.newGround(600,150,500),this.newGround(1200,150,100),this.newGround(1400,150,100),this.newGround(1600,150,50),this.newGround(1700,150,50),this.newGround(1800,150,50),this.newWall(1900,200,1,4),this.newWall(2200,300,1,2),this.newWall(2400,400,1,3),this.newWall(2600,200,1,3),this.newWall(2700,100,1,3),this.newWall(2800,300,1,7),this.newGround(3e3,150,500),this.newGround(3600,150,500),this.newWall(4100,200,1,8),this.newWall(4400,300,1,3),this.newWall(4600,400,1,2),this.newGround(4800,150,500),this.newMushroom(220,180),this.newMushroom(260,180),this.newMushroom(300,180),this.newMushroom(1220,180),this.newMushroom(1260,180),this.newMushroom(2220,180),this.newMushroom(2260,180),this.newMushroom(3220,180),this.newMushroom(3260,180),this.newMushroom(4220,180),this.newMushroom(4260,180),this.newCoin(100,300,1,3),this.newCoin(380,300,4,1),this.newCoin(450,350,2,1),this.newCoin(1200,500,1,3),this.newCoin(1800,400,1,3),this.newCoin(2100,300,4,3),this.newCoin(3100,300,1,3),this.newCoin(4100,300,1,3),this.newMissile(900,400),this.newMissile(1300,300),this.newMissile(1900,600),this.newMissile(3300,500)}.call(this),this.levelCommonEnd(4800)},GameScene.prototype.level_1_3=function(){this.levelCommonSetting(),function(){var t=0,e=150,i=200;this.newWall(0,200,1,10,[[0,2,1]]),this.newWall(150,350,2,5,[[1,2,1,3]]),this.newMushroom(350,500),t=500,e=150,i=400,this.newGround(t,e,i),this.newBucket(t,e),this.newBucket(t+i-80,e,1,80),this.newWall(t+100,e+200,1,4,[[0,1,1,1],[0,2,1,1]]),this.newCoin(t+150,e+250,1,3),this.newMushroom(t+100,e),this.newMushroom(t+150,e),this.newMushroom(t+200,e),t=1e3,e=150,i=700,this.newWall(t,e,1,5),this.newWall(t+250,e+100,1,5),this.newWall(t+500,e+200,1,5),this.newMushroom(t+200,e+200),this.newCoin(t,e+100,1,3),this.newCoin(t+250,e+100+100,1,3),this.newCoin(t+500,e+200+100,1,3)}.call(this),this.levelCommonEnd(1800)},GameScene.prototype.level_1_4=function(){this.levelCommonSetting(),function(){this.newGround(0,150,300),this.newWall(126,260,1,3,[[0,1,1,3]]),this.newWall(370,260,1,3,[]),this.newCoin(382,400,1,3),this.newWall(556,360,1,3,[]),this.newGround(676,150,300),this.newCoin(770,300,1,3),this.newBucket(864,150,1,80,90),this.newGround(1008,150,300),this.newBucket(1008,150,1,80,90),this.newBucket(1198,150,1,80,90),this.newMushroom(1112,150),this.newWall(1334,260,1,3,[]),this.newWall(1500,160,1,3,[]),this.newCoin(1500,260,1,5),this.newWall(1690,260,1,3,[]),this.newCoin(1692,400,1,3),this.newGround(1850,150,600),this.newBucket(1858,150,1,80,90),this.newBucket(2360,150,1,80,90),this.newMushroom(2080,150),this.newMushroom(2136,150),this.newMushroom(2216,150),this.newMushroom(1986,150),this.newMushroom(1986,310),this.newGround(2498,150,30),this.newGround(2586,150,30),this.newGround(2686,150,30),this.newGround(2788,150,100),this.newWall(2934,260,1,3,[]),this.newWall(3092,360,1,3,[]),this.newWall(3298,460,1,3,[]),this.newWall(3492,560,1,3,[]),this.newGround(3484,150,300),this.newWall(3484,260,1,3,[]),this.newBucket(3562,150,1,80,90),this.newMushroom(3690,150),this.newMushroom(3762,150),this.newWall(3792,260,1,3,[[0,1,1,10]]),this.newWall(2020,260,1,6,[[0,1,1,5]]),this.newGround(3926,150,300),this.newCoin(4128,200,1,3),this.newGround(4346,150,300),this.newWall(4646,260,1,3,[]),this.newWall(4770,0,5,1,[]),this.newWall(4810,0,6,1,[]),this.newWall(4850,0,7,1,[]),this.newWall(4890,0,8,1,[]),this.newWall(4930,0,9,1,[]),this.newWall(4970,0,10,2,[])}.call(this),this.levelCommonEnd(5100)},Ycc.utils.isMobile()||alert("此示例在移动端查看效果更好！");var ycc=null,stageW=0,stageH=0,images=null,audios=null,bgmAutoplay=!0,currentScene=null,loading=null,engine=null,t1=0,t2=0,t3=0,t4=0,__log="自定义",levelList=["1_1","1_2","1_3","1_4"];function createYcc(){"undefined"==typeof canvas&&(window.canvas=document.createElement("canvas"),canvas.width=window.innerWidth,canvas.height=window.innerHeight,document.body.appendChild(canvas)),ycc=(new Ycc).bindCanvas(canvas),stageW=ycc.getStageWidth(),stageH=ycc.getStageHeight(),ycc.debugger.addField("帧间隔",function(){return ycc.ticker.deltaTime}),ycc.debugger.addField("总帧数",function(){return ycc.ticker.frameAllCount}),ycc.debugger.addField("总UI数",function(){return currentScene&&currentScene.layer.uiCountRecursion}),ycc.debugger.addField("画面位置",function(){return currentScene&&currentScene.layer.x}),ycc.debugger.addField("渲染时间",function(){return t2-t1}),ycc.debugger.addField("update时间",function(){return t3-t2}),ycc.debugger.addField("debug时间",function(){return t4-t3}),ycc.debugger.addField("自定义",function(){return __log}),ycc.ticker.addFrameListener(function(){t1=Date.now(),ycc.layerManager.reRenderAllLayerToStage(),t2=Date.now(),currentScene&&currentScene.update&&currentScene.update(),t3=Date.now(),t4=Date.now()})}function loadRes(r){ycc.loader.basePath="https://www.lizhiqianduan.com/products/ycc/examples/game-super-mario/",ycc.loader.loadResOneByOne([{name:"btn",url:"./images/btn.jpg"},{name:"button",url:"./images/button.png"},{name:"fight",url:"./images/fight.png"},{name:"music",url:"./images/music.png"},{name:"jump",url:"./images/jump.png"},{name:"mario",url:"./images/mario-walk.png"},{name:"girl",url:"./images/girl.png"},{name:"mushroom",url:"./images/mushroom.png"},{name:"wall",url:"./images/wall.png"},{name:"wallSpecial01",url:"./images/wall-special-01.jpg"},{name:"wallSpecial02",url:"./images/wall-special-02.png"},{name:"marioFight",url:"./images/mario-fight.png"},{name:"marioJump",url:"./images/mario-jump.png"},{name:"marioDown",url:"./images/mario-down.png"},{name:"coin100",url:"./images/coin100.jpg"},{name:"bucket",url:"./images/bucket.png"},{name:"flag",url:"./images/flag.png"},{name:"marioTouchFlag",url:"./images/mario-touch-flag.png"},{name:"missile",url:"./images/missile.png"},{name:"bg01",url:"./images/bg01.jpg"},{name:"bg02",url:"./images/bg02.jpg"},{name:"bg03",url:"./images/bg03.jpg"},{name:"bg04",url:"./images/bg04.jpg"},{name:"bg05",url:"./images/bg05.jpg"}],function(t,i){ycc.loader.loadResOneByOne([{name:"bgm",type:"audio",url:"./audios/bgm.mp3"},{name:"jump",type:"audio",url:"./audios/jump.mp3"},{name:"victory",type:"audio",url:"./audios/victory.mp3"},{name:"touchWall",type:"audio",url:"./audios/touchWall.mp3"},{name:"touchCoin",type:"audio",url:"./audios/touchCoin.mp3"},{name:"touchMushroom",type:"audio",url:"./audios/touchMushroom.mp3"},{name:"dead1",type:"audio",url:"./audios/dead1.mp3"},{name:"dead2",type:"audio",url:"./audios/dead2.mp3"}],function(t,e){r(i,e)},function(t,e){loading.updateText(t.name)})},function(t,e){t.res.naturalWidth||(t.res.naturalWidth=t.res.width,t.res.naturalHeight=t.res.height),loading.updateText(t.name)})}function projectInit(t){ycc.ticker.start(60),engine=Matter.Engine.create(),Matter.Engine.run(engine),currentScene=new GameScene(t),ycc.layerManager.reRenderAllLayerToStage()}createYcc(),loading=new Loading,loadRes(function(t,e){loading.hidden(),images=t,audios=e,projectInit()});