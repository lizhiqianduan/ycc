function Loading(){this.textUI=new Ycc.UI.SingleLineText({content:"",fontSize:"12px",rect:new Ycc.Math.Rect(0,stageH/2+20,stageW,20),xAlign:"center",color:"red"}),this.layer=ycc.layerManager.newLayer(),this.layer.addUI(new Ycc.UI.Rect({rect:new Ycc.Math.Rect(0,0,stageW,stageH),color:"gray"})),this.layer.addUI(new Ycc.UI.SingleLineText({content:"正在加载...",rect:new Ycc.Math.Rect(0,stageH/2,stageW,20),xAlign:"center",color:"red"})),this.layer.addUI(this.textUI),this.hidden=function(){this.layer.show=!1},this.show=function(){this.layer.show=!0},this.updateText=function(a){this.textUI.content=a,ycc.layerManager.reRenderAllLayerToStage()}}function GameScene(a){this.layer=ycc.layerManager.newLayer({enableEventManager:!0,name:"场景图层"}),this.btnLayer=ycc.layerManager.newLayer({enableEventManager:!0,name:"按钮图层"}),this.gameOverLayer=null,this.mario=null,this.endPoint=0,this.coinUI=null,this.musicBtn=null,this.score=0,this.engine=null,this.direction="",this.downIsPressing=!1,this.downTouchEndFlag=!1,this.jumpIsPressing=!1,this.bodies=null,this.marioContactWith=[],this.marioStayingOnWall=!1,this.isGameVictory=!1,this.gameLevel=(location.hash||a||"#1_1").slice(1),this.endBucket=null,this.init()}function createYcc(){ycc=new Ycc,"undefined"==typeof canvas&&(window.canvas=document.createElement("canvas"),canvas.width=window.innerWidth,canvas.height=window.innerHeight,document.body.appendChild(canvas)),canvas.style.width=canvas.width+"px",canvas.width*=ycc.dpi,canvas.height*=ycc.dpi,ycc.bindCanvas(canvas),stageW=ycc.getStageWidth()/ycc.dpi,stageH=ycc.getStageHeight()/ycc.dpi,ycc.ticker.addFrameListener(function(){t1=Date.now(),t2=Date.now(),currentScene&&currentScene.update&&currentScene.update(),t3=Date.now(),t4=Date.now()})}function loadRes(a){"undefined"!=typeof wx&&(ycc.loader.basePath="https://www.lizhiqianduan.com/products/ycc/examples/game-super-mario/"),ycc.loader.loadResOneByOne([{name:"btn",url:"./images/btn.jpg"},{name:"button",url:"./images/button.png"},{name:"fight",url:"./images/fight.png"},{name:"music",url:"./images/music.png"},{name:"jump",url:"./images/jump.png"},{name:"mario",url:"./images/mario-walk.png"},{name:"girl",url:"./images/girl.png"},{name:"mushroom",url:"./images/mushroom.png"},{name:"wall",url:"./images/wall.png"},{name:"wallSpecial01",url:"./images/wall-special-01.jpg"},{name:"wallSpecial02",url:"./images/wall-special-02.png"},{name:"marioFight",url:"./images/mario-fight.png"},{name:"marioJump",url:"./images/mario-jump.png"},{name:"marioDown",url:"./images/mario-down.png"},{name:"coin100",url:"./images/coin100.jpg"},{name:"bucket",url:"./images/bucket.png"},{name:"flag",url:"./images/flag.png"},{name:"marioTouchFlag",url:"./images/mario-touch-flag.png"},{name:"missile",url:"./images/missile.png"},{name:"bg01",url:"./images/bg01.jpg"},{name:"bg02",url:"./images/bg02.jpg"},{name:"bg03",url:"./images/bg03.jpg"},{name:"bg04",url:"./images/bg04.jpg"},{name:"bg05",url:"./images/bg05.jpg"}],function(b,c){ycc.loader.loadResOneByOne([{name:"bgm",type:"audio",url:"./audios/bgm.mp3"},{name:"jump",type:"audio",url:"./audios/jump.mp3"},{name:"victory",type:"audio",url:"./audios/victory.mp3"},{name:"touchWall",type:"audio",url:"./audios/touchWall.mp3"},{name:"touchCoin",type:"audio",url:"./audios/touchCoin.mp3"},{name:"touchMushroom",type:"audio",url:"./audios/touchMushroom.mp3"},{name:"dead1",type:"audio",url:"./audios/dead1.mp3"},{name:"dead2",type:"audio",url:"./audios/dead2.mp3"}],function(b,d){a(c,d)},function(a,b){loading.updateText(a.name)})},function(a,b){a.res.naturalWidth||(a.res.naturalWidth=a.res.width,a.res.naturalHeight=a.res.height),loading.updateText(a.name)})}function projectInit(a){ycc.ticker.start(60),engine=Matter.Engine.create(),Matter.Engine.run(engine),currentScene=new GameScene(a),ycc.layerManager.reRenderAllLayerToStage()}if(GameScene.prototype.init=function(){this["level_"+this.gameLevel]&&this["level_"+this.gameLevel](),this.collisionListenerInit(),bgmAutoplay&&(audios.bgm.currentTime=0,audios.bgm.play())},GameScene.prototype.bindMatterBodyWithUI=function(a,b){b._matterBody=a,a._yccUI=b},GameScene.prototype.getMatterBodyFromUI=function(a){return a._matterBody},GameScene.prototype.getUIFromMatterBody=function(a){return a._yccUI},GameScene.prototype.levelCommonSetting=function(a,b,c){a=a||"bg01",b=b||2,c=c||9999,this.createBackground(a,c,stageH,b),this.createGameOverLayer(),this.createDirectionBtn(),this.createSkillBtn(),this.createCoinUI(),this.newDeadLine(c,-100),this.newBounds(8)},GameScene.prototype.levelCommonEnd=function(a){a=a||1800,this.newFlag(a,200,400),this.newGround(a,200,1e3),this.endBucket=this.newBucket(a+stageW-90,190,4,90,90),this.createMario()},GameScene.prototype.levelCommonOnVictory=function(){var a=this.endBucket;this.marioContactWith.indexOf(a._matterBody)>-1&&(Matter.World.remove(engine.world,a._matterBody),this.gameOverLayer.show=!0);var b=a.belongTo.uiList,c=b.indexOf(a);b.splice(c,1),b.push(a)},GameScene.prototype.debug=function(){var a=Matter.Composite.allBodies(engine.world),b=ycc.ctx;b.save(),b.beginPath();for(var c=0;c<a.length;c+=1){var d=a[c].vertices;b.moveTo(d[0].x*ycc.dpi+this.layer.x*ycc.dpi,d[0].y*ycc.dpi);for(var e=1;e<d.length;e+=1)b.lineTo(d[e].x*ycc.dpi+this.layer.x*ycc.dpi,d[e].y*ycc.dpi);b.lineTo(d[0].x*ycc.dpi+this.layer.x*ycc.dpi,d[0].y*ycc.dpi)}b.lineWidth=2,b.strokeStyle="#999",b.stroke(),b.restore()},GameScene.prototype.collisionListenerInit=function(){function a(a,b){return b?b===a.bodyA?a.bodyB:b===a.bodyB?a.bodyA:void 0:null}function b(a){var b=c.getMatterBodyFromUI(c.mario);return a.bodyA.label===b.label?a.bodyA:a.bodyB.label===b.label?a.bodyB:null}var c=this;Matter.Events.on(engine,"collisionStart",function(d){for(var e=0;e<d.pairs.length;e++){var f=d.pairs[e],g=b(f),h=a(f,g);if(g&&h){var i=c.marioContactWith.indexOf(h);i===-1&&c.marioContactWith.push(h)}}}),Matter.Events.on(engine,"collisionEnd",function(d){for(var e=0;e<d.pairs.length;e++){var f=d.pairs[e],g=b(f),h=a(f,g);if(g&&h){var i=c.marioContactWith.indexOf(h);i!==-1&&c.marioContactWith.splice(i,1)}}}),Matter.Events.on(engine,"collisionActive",function(d){for(var e=0;e<d.pairs.length;e++){var f=d.pairs[e],g=b(f),h=a(f,g);if(g&&h){var i=c.marioContactWith.indexOf(h);i===-1&&c.marioContactWith.push(h)}}})},GameScene.prototype.isFighting=function(){var a=this.mario._fightFrameCount>0&&ycc.ticker.frameAllCount-this.mario._fightFrameCount<6;return a||(this.mario._fightFrameCount=0),a},GameScene.prototype.marioStayingOnWallCompute=function(){for(var a=0;a<this.marioContactWith.length;a++){var b=this.marioContactWith[a];if(["wall","ground","bucket","flag","girl","mushroom","wallBox"].indexOf(b.label)!==-1){var c=this.mario.rect,d=this.getUIFromMatterBody(b).rect;if(this.marioStayingOnWall=parseInt(c.y+c.height)<=b.vertices[0].y&&c.x+c.width>=b.vertices[0].x&&c.x<b.vertices[0].x+d.width,this.marioStayingOnWall)return}}this.marioStayingOnWall=!1},GameScene.prototype.updateUIPosition=function(){var a=this,b=Matter.Composite.allBodies(engine.world);audios.bgm.running?(this.musicBtn.children[0].show=!1,this.musicBtn.rotation+=1):(this.musicBtn.children[0].show=!0,this.musicBtn.rotation=0);for(var c=0;c<b.length;c++){var d=b[c],e=a.getUIFromMatterBody(d);"mushroom"===d.label&&(e.rect.x=d.vertices[0].x,e.rect.y=d.vertices[0].y,d.restitution=0===d.velocity.y?1:0,Matter.Body.setVelocity(d,{x:d.velocity.x>=0?1:-1,y:d.velocity.y}),Matter.Body.setAngle(d,0)),"missile"===d.label&&(Matter.Body.setPosition(d,{x:d.position.x-2*ycc.ticker.deltaTimeRatio,y:d.position.y}),e.rect.x=d.vertices[0].x-5,e.rect.y=d.vertices[0].y)}},GameScene.prototype.jumpIsPressingCompute=function(){this.jumpIsPressing&&this.marioStayingOnWall?(Matter.Body.setVelocity(this.getMatterBodyFromUI(this.mario),{x:0,y:-10}),audios.jump.currentTime=0,audios.jump.play(),this.jumpIsPressing=!1):this.jumpIsPressing=!1},GameScene.prototype.updateMarioBodyVerticesByMarioRect=function(){var a=new Ycc.Math.Rect(this.mario.rect);a.x+=6,a.width-=16,Matter.Body.setVertices(this.getMatterBodyFromUI(this.mario),a.getVertices().slice(0,4)),a=null},GameScene.prototype.marioImageResCompute=function(){var a=this.getMatterBodyFromUI(this.mario),b=a.position;!this.marioStayingOnWall||this.isFighting()||this.downIsPressing?this.marioStayingOnWall?this.downIsPressing?(console.log("下蹲"),this.mario.res=images.marioDown,this.mario.frameRectCount=1,b.y+=(this.mario.rect.height-2*this.mario.res.naturalHeight)/2,this.mario.rect.height=2*this.mario.res.naturalHeight,this.updateMarioBodyVerticesByMarioRect(),this.mario.firstFrameRect.height=this.mario.res.naturalHeight,Matter.Body.setPosition(a,b)):this.marioStayingOnWall&&this.isFighting()&&(this.mario.res=images.marioFight,this.mario.frameRectCount=1):(this.mario.res=this.downIsPressing?images.marioDown:images.marioJump,this.mario.frameRectCount=1,this.isGameVictory&&(this.mario.res=images.marioTouchFlag),this.downTouchEndFlag&&(this.mario.rect.height=2*this.mario.res.naturalHeight,this.updateMarioBodyVerticesByMarioRect(),this.downTouchEndFlag=!1,this.mario.firstFrameRect.height=this.mario.res.naturalHeight)):(this.mario.res=images.mario,this.mario.frameRectCount=3,this.downTouchEndFlag&&(this.mario.rect.height=2*this.mario.res.naturalHeight,this.updateMarioBodyVerticesByMarioRect(),this.downTouchEndFlag=!1),this.mario.firstFrameRect.height=this.mario.res.naturalHeight)},GameScene.prototype.marioContactWithCompute=function(){for(var a=this,b=a.getMatterBodyFromUI(this.mario),c=0;c<this.marioContactWith.length;c++){var d=this.marioContactWith[c];if("flag"===d.label&&(this.isGameVictory=!0,this.marioStayingOnWall&&(audios.bgm.pause(),audios.victory.currentTime=0,audios.victory.play(),Matter.World.remove(engine.world,d))),"coin"===d.label&&(audios.touchCoin.currentTime=0,audios.touchCoin.play(),a.layer.removeUI(a.getUIFromMatterBody(d)),Matter.World.remove(engine.world,d),a.score++,a.coinUI.content="× "+a.score),"mushroom"===d.label&&(1===this.marioContactWith.length&&this.marioStayingOnWall?(audios.touchMushroom.currentTime=0,audios.touchMushroom.play(),a.layer.removeUI(a.getUIFromMatterBody(d)),Matter.World.remove(engine.world,d),Matter.Body.setVelocity(b,{x:0,y:-4})):2===this.marioContactWith.length&&"mushroom"===this.marioContactWith[0].label&&"mushroom"===this.marioContactWith[1].label&&this.marioStayingOnWall?(audios.touchMushroom.currentTime=0,audios.touchMushroom.play(),a.layer.removeUI(a.getUIFromMatterBody(this.marioContactWith[0])),Matter.World.remove(engine.world,this.marioContactWith[0]),a.layer.removeUI(a.getUIFromMatterBody(this.marioContactWith[1])),Matter.World.remove(engine.world,this.marioContactWith[1]),Matter.Body.setVelocity(b,{x:0,y:-4})):(Matter.World.remove(engine.world,d),a.marioDeadProcess())),"wallBox"===d.label&&!this.marioStayingOnWall){var e=this.mario.rect,f=this.getUIFromMatterBody(d).rect,g=parseInt(e.y)>=d.vertices[0].y+f.height&&e.x+e.width-16>d.vertices[0].x&&e.x<=d.vertices[0].x+f.width-17;g&&this.marioHitWall(d)}"missile"===d.label&&Matter.World.remove(engine.world,d),"deadLine"!==d.label&&"missile"!==d.label||a.marioDeadProcess()}},GameScene.prototype.marioDeadProcess=function(){audios.bgm.pause(),Matter.World.remove(engine.world,this.mario._matterBody),this.update=null,this.btnLayer.enableEventManager=!1,this.direction="",this.mario.stop(),audios.dead2.play(),this.gameOverLayer.show=!0,console.log("死亡"),this.gameOverLayer.reRender()},GameScene.prototype.gameVictoryCompute=function(){if(this.isGameVictory){var a=this.getMatterBodyFromUI(this.mario);if(Matter.Body.setVelocity(a,{x:0,y:a.velocity.y}),this.direction="left",this.marioStayingOnWall){var b=a.position;!this.mario.isRunning&&this.mario.start(),Matter.Body.setPosition(a,{x:b.x+3*ycc.ticker.deltaTimeRatio,y:b.y})}var c="level_"+this.gameLevel+"_onVictory";this[c]?this[c]():this.levelCommonOnVictory()}},GameScene.prototype.directionCompute=function(){var a=this.getMatterBodyFromUI(this.mario),b=a.position;this.isGameVictory||this.marioStayingOnWall&&this.downIsPressing||("left"===this.direction&&Matter.Body.setPosition(a,{x:b.x-3*ycc.ticker.deltaTimeRatio,y:b.y}),"right"===this.direction&&Matter.Body.setPosition(a,{x:b.x+3*ycc.ticker.deltaTimeRatio,y:b.y}))},GameScene.prototype.marioHitWall=function(a){function b(a,b,d){function e(a,b){for(var c=[],d=a;d<=b;d++)0!==g[d].__specialType&&c.push([0,d-a,g[d].__specialType,g[d].__coinNumber]);return c}var f=a.rect,g=a.children,h=g.length;if(0===g[b].__specialType&&0===g[b+d-1].__specialType){if(audios.touchWall.currentTime=0,audios.touchWall.play(),h<=d)console.log("一块都不剩");else if(b>0&&b+d<h)console.log("分成两块"),c.newWall(g[0].getAbsolutePosition().x-c.layer.x,stageH-(f.y+f.height),1,b,e(0,b)),c.newWall(g[b+d].getAbsolutePosition().x-c.layer.x,stageH-(f.y+f.height),1,h-b-d,e(b+d,h-1));else{console.log("还剩一块");var i=0,j=null;1===d&&(0===b?(i=1,j=e(1,h-1),__log=JSON.stringify(j)):(i=0,j=e(0,b))),2===d&&(1===b?(i=d,j=e(b,h-1)):(i=0,j=e(0,b)));var k=g[i].getAbsolutePosition().x-c.layer.x;c.newWall(k,stageH-(f.y+f.height),1,h-d,j)}Matter.World.remove(engine.world,c.getMatterBodyFromUI(a)),c.layer.removeUI(a)}else{var l=1===g[b].__specialType&&g[b]||1===g[b+d-1].__specialType&&g[b+d-1];if(l){l.__coinNumber--,c.score++,c.coinUI.content="× "+c.score,audios.touchCoin.currentTime=0,audios.touchCoin.play();var m=l.getAbsolutePosition();if(c.newCoinAnimation(m.x+m.width/2-c.layer.x,stageH-m.y,2,6),0===l.__coinNumber){l.__specialType=2;var n=g[0].getAbsolutePosition().x-c.layer.x,o=e(0,h-1);c.newWall(n,stageH-(f.y+f.height),1,h,o),Matter.World.remove(engine.world,c.getMatterBodyFromUI(a)),c.layer.removeUI(a),n=0,o=null}}}}var c=this,d=this.getUIFromMatterBody(a),e=d.getAbsolutePositionRect(),f=this.mario.getAbsolutePositionRect(),g=f.x+f.width/2;if(console.log("mario middle x--> ",g),g<=e.x)return console.log("撞第一块"),void b(d,0,1);if(g>=e.x+e.width)return console.log("撞最后一块"),void b(d,d.children.length-1,1);for(var h=0;h<d.children.length;h++){var i=d.children[h].getAbsolutePositionRect();if(g<i.width+i.x&&g>i.x)return console.log("撞中间某一块"),void b(d,h,1);if(g===i.x)return console.log("撞相邻两块"),void b(d,h,2)}},GameScene.prototype.removeUI=function(a){var b=a._matterBody;b&&(a._matterBody._yccUI=null,a._matterBody=null,Matter.World.remove(engine.world,b)),this.layer.removeUI(a)},GameScene.prototype.update=function(){var a=this.getMatterBodyFromUI(this.mario);Matter.Body.setAngle(a,0),Matter.Body.setAngularVelocity(a,0),this.marioStayingOnWallCompute(),this.jumpIsPressingCompute(),this.marioImageResCompute(),this.marioContactWithCompute(),this.directionCompute(),this.mario.rect.x=a.vertices[0].x-8,this.mario.rect.y=a.vertices[0].y,this.updateUIPosition(),this.gameVictoryCompute(),this.mario.rect.x-stageW/2>0&&this.mario.rect.x<this.endPoint&&(this.layer.x=-(this.mario.rect.x-stageW/2)),this.layer.reRender(),this.btnLayer.reRender(),this.gameOverLayer.reRender()},function(a){a.prototype.newGround=function(a,b,c){var d=new Ycc.UI.Image({rect:new Ycc.Math.Rect(a,stageH-b,c,b),res:images.wall,fillMode:"repeat",name:"ground"});this.layer.addUI(d);var e=d.rect,f=d;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(e.x+e.width/2,e.y+e.height/2,e.width,e.height,{isStatic:!0,label:"ground",friction:0,frictionStatic:0,frictionAir:0,restitution:0}),f),Matter.World.add(engine.world,this.getMatterBodyFromUI(f)),e=null,f=null,d},a.prototype.newWall=function(a,b,c,d,e){function f(a){return 0===a?images.wall:1===a?images.wallSpecial01:2===a?images.wallSpecial02:void 0}function g(a,b){if(!e||0===e.length)return null;for(var c=0;c<e.length;c++)if(e[c][0]===a&&e[c][1]===b)return e[c];return null}for(var h=40,i=40,j=b,k=0;k<c;k++){var l=new Ycc.UI.Rect({rect:new Ycc.Math.Rect(a,stageH-j-i*(k+1),h*d,i),color:"rgba(0,0,0,0)",name:"wallBox"});this.layer.addUI(l);var m=l.rect,n=l;this.bindMatterBodyWithUI(Matter.Bodies.rectangle(m.x+m.width/2,m.y+m.height/2,m.width,m.height,{isStatic:!0,friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"wallBox",collisionFilter:{group:-1}}),n),Matter.World.add(engine.world,this.getMatterBodyFromUI(n)),m=null,n=null;for(var o=0;o<d;o++){var p=g(k,o),q=p&&p[2]||0,r=new Ycc.UI.Image({rect:new Ycc.Math.Rect(o*h,0,h,i),res:f(q),fillMode:"scaleRepeat",scaleRepeatRect:new Ycc.Math.Rect(0,0,h,i),name:"wall"});r.__specialType=q,r.__coinNumber=1===q&&p[3]||0,l.addChild(r)}}},a.prototype.newCoin=function(a,b,c,d){for(var e=21,f=34,g=10,h=10,i=0;i<c;i++)for(var j=0;j<d;j++){var k=new Ycc.UI.Image({rect:new Ycc.Math.Rect(a+(e+g)*j,stageH-b-(f+h)*i,e,f),res:images.coin100,fillMode:"scale",name:"coin"});this.layer.addUI(k);var l=k.rect,m=k;this.bindMatterBodyWithUI(Matter.Bodies.rectangle(l.x+l.width/2,l.y+l.height/2,l.width,l.height,{isStatic:!0,isSensor:!0,friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"coin"}),m),Matter.World.add(engine.world,this.getMatterBodyFromUI(m)),l=null,m=null}},a.prototype.newCoinAnimation=function(a,b,c,d){function e(){0===parseInt(n.velocity.y)&&(k.removeListener("computestart",f),k.removeListener("renderend",e),g.removeUI(this))}function f(){var a=this;a.mirrorCount=a.mirrorCount||0,a.zoomOut=!!a.zoomOut,Matter.Body.setAngle(n,0),a.rect.y=n.vertices[0].y,0===a.rect.width&&(a.zoomOut=!0,a.mirrorCount++),a.rect.width===h&&(a.zoomOut=!1),a.mirrorCount%2===0?a.mirror=0:a.mirror=1,a.zoomOut?(a.rect.x-=c/2,a.rect.width+=c):(a.rect.x+=c/2,a.rect.width-=c)}var g=this,h=20,i=34;c=c||2,d=d||4;var j=a-h/2,k=new Ycc.UI.Image({rect:new Ycc.Math.Rect(j,stageH-b-i,h,i),res:images.coin100,fillMode:"scale",name:"coinAnimation"}),l=k.rect,m=k,n=Matter.Bodies.rectangle(l.x+l.width/2,l.y+l.height/2,l.width,l.height,{friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"coinAnimation",collisionFilter:{group:-1}});this.bindMatterBodyWithUI(n,m),Matter.World.add(engine.world,n),Matter.Body.setVelocity(n,{x:0,y:-d}),l=null,m=null,console.log(n),k.addListener("computestart",f),k.addListener("renderend",e),this.layer.addUI(k)},a.prototype.newGirl=function(a,b){var c="girl",d=36,e=64,f=new Ycc.UI.Image({rect:new Ycc.Math.Rect(a,stageH-b-e,d,e),res:images.girl,fillMode:"scale",name:c});this.layer.addUI(f);var g=f.rect,h=f,i=g.width,j=g.height;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(g.x+g.width/2,g.y+g.height/2,i,j,{isStatic:!0,label:c,friction:0,frictionStatic:0,frictionAir:0,restitution:0}),h),Matter.World.add(engine.world,this.getMatterBodyFromUI(h)),g=null,h=null,f},a.prototype.newMissile=function(a,b){var c="missile",d=30,e=20,f=new Ycc.UI.Image({rect:new Ycc.Math.Rect(a,stageH-b-e,d,e),res:images.missile,fillMode:"scale",name:c});this.layer.addUI(f);var g=f.rect,h=f,i=g.width,j=g.height;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(g.x+g.width/2+5,g.y+g.height/2,i,j,{isStatic:!0,label:c,friction:0,frictionStatic:0,frictionAir:0,restitution:0}),h),Matter.World.add(engine.world,this.getMatterBodyFromUI(h)),g=null,h=null,f},a.prototype.newMushroom=function(a,b){var c="mushroom",d=36,e=38,f=1,g=new Ycc.UI.Image({rect:new Ycc.Math.Rect(a,stageH-b-e,d,e),res:images.mushroom,fillMode:"scale",name:c});this.layer.addUI(g);var h=g.rect,i=g,j=h.width,k=h.height;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(h.x+h.width/2,h.y+h.height/2,j,k,{label:c,friction:0,frictionStatic:0,frictionAir:0,restitution:0}),i),Matter.World.add(engine.world,this.getMatterBodyFromUI(i)),Matter.Body.setVelocity(this.getMatterBodyFromUI(i),{x:-f,y:0}),h=null,i=null,g},a.prototype.newBucket=function(a,b,c,d,e){var f=b;d=d||80,e=e||90;var g=new Ycc.UI.Image({rect:new Ycc.Math.Rect(a,stageH-f-e,d,e),res:images.bucket,fillMode:"scale",name:"bucket",anchorX:a+d/2,anchorY:stageH-f-e+e/2,rotation:[0,0,90,180,270][c||1]});this.layer.addUI(g);var h=g.rect,i=g,j=h.width,k=h.height;return 90!==g.rotation&&270!==g.rotation||(h.x+=(e-d)/2,h.y+=(e-d)/2,j=h.height,k=h.width),this.bindMatterBodyWithUI(Matter.Bodies.rectangle(h.x+h.width/2,h.y+h.height/2,j,k,{isStatic:!0,label:"bucket",friction:0,frictionStatic:0,frictionAir:0,restitution:0}),i),Matter.World.add(engine.world,this.getMatterBodyFromUI(i)),h=null,i=null,g},a.prototype.newFlag=function(a,b,c){this.endPoint=a+stageW/2,this.newBounds(a+stageW);var d=c||images.flag.naturalHeight,e=images.flag.naturalWidth,f=new Ycc.UI.Image({rect:new Ycc.Math.Rect(a,stageH-b-d,e,d),res:images.flag,fillMode:"scale9Grid",scale9GridRect:new Ycc.Math.Rect(16,78,8,14),name:"flag"});this.layer.addUI(f);var g=f.rect,h=f;return this.bindMatterBodyWithUI(Matter.Bodies.rectangle(g.x+16,g.y+g.height/2,1,9999,{isStatic:!0,label:"flag",friction:0,frictionStatic:0,frictionAir:0,restitution:0}),h),Matter.World.add(engine.world,this.getMatterBodyFromUI(h)),g=null,h=null,f},a.prototype.newBounds=function(a){Matter.World.add(engine.world,Matter.Bodies.rectangle(a,0,1,2*stageH,{isStatic:!0,friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"bound"}))},a.prototype.newDeadLine=function(a,b){Matter.World.add(engine.world,Matter.Bodies.rectangle(a/2,stageH-b,a,1,{isStatic:!0,isSensor:!0,friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"deadLine"}))},a.prototype.createMario=function(){this.mario=new Ycc.UI.ImageFrameAnimation({rect:new Ycc.Math.Rect(10,0,36,2*images.mario.naturalHeight),res:images.mario,firstFrameRect:new Ycc.Math.Rect(0,0,18,images.mario.naturalHeight),frameRectCount:3,frameSpace:8}),this.mario._fightFrameCount=0,this.layer.addUI(this.mario);var a=this.mario.rect,b=this.mario;this.bindMatterBodyWithUI(Matter.Bodies.rectangle(a.x+a.width/2+8,a.y+a.height/2,a.width-16,a.height,{friction:0,frictionStatic:0,frictionAir:0,restitution:0,label:"Mario"}),b),this.updateMarioBodyVerticesByMarioRect(),Matter.World.add(engine.world,this.getMatterBodyFromUI(b)),a=null,b=null},a.prototype.createBackground=function(a,b,c,d){var e=images[a];d=d||1;var f=null;f=1===d?new Ycc.Math.Rect(0,0,e.naturalWidth,e.naturalHeight):new Ycc.Math.Rect(0,0,e.naturalWidth/e.naturalHeight*stageH,stageH);var g=new Ycc.UI.Image({rect:new Ycc.Math.Rect(0,0,b,c),res:e,fillMode:"scaleRepeat",scaleRepeatRect:f,name:"bg"});this.layer.addUI(g)},a.prototype.createCoinUI=function(){var a=new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW-100,10,10,15),res:images.coin100,fillMode:"scale",name:"coinUI"}),b=new Ycc.UI.SingleLineText({content:"× 0",rect:new Ycc.Math.Rect(15,0,40,20),color:"yellow"});a.addChild(b),this.btnLayer.addUI(a),this.coinUI=b},a.prototype.createDirectionBtn=function(){var a=this,b=50,c=20,d=20,e=10;a.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(d,stageH-(2*b+c+e),b,b),fillMode:"scale",anchorX:d+b/2,anchorY:stageH-(2*b+c+e)+b/2,res:images.btn,rotation:180,ondragstart:function(b){a.isGameVictory||(a.mario.mirror=1,a.mario.start(),a.direction="left")},ondragend:function(b){a.isGameVictory||(a.mario.stop(),a.direction="")}})),a.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(d+b+c,stageH-(2*b+c+e),b,b),fillMode:"scale",anchorX:b/2,anchorY:b/2,res:images.btn,rotation:0,ondragstart:function(b){a.isGameVictory||(a.mario.mirror=0,a.mario.start(),a.direction="right")},ondragend:function(b){a.isGameVictory||(a.mario.stop(),a.direction="")}})),a.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(d+b/2+c/2,stageH-(b+e),b,b),fillMode:"scale",anchorX:d+b/2+c/2+b/2,anchorY:stageH-(b+e)+b/2,res:images.btn,rotation:90,ondragstart:function(b){if(!a.isGameVictory)return a.marioStayingOnWall?void(a.downIsPressing=!0):void console.log("人物当前状态不能下蹲!")},ondragend:function(b){a.isGameVictory||(a.downIsPressing=!1,a.downTouchEndFlag=!0)}}));var f=!0;window.onkeydown=function(b){if(!a.isGameVictory){if(38===b.keyCode&&f&&(f=!1,a.jumpIsPressing=!0),37===b.keyCode&&(a.mario.mirror=1,!a.mario.isRunning&&a.mario.start(),a.direction="left"),39===b.keyCode&&(a.mario.mirror=0,!a.mario.isRunning&&a.mario.start(),a.direction="right"),40===b.keyCode){if(!a.marioStayingOnWall)return void console.log("人物当前状态不能下蹲!");a.downIsPressing=!0}if(88===b.keyCode){if(a.isFighting())return;a.mario._fightFrameCount=ycc.ticker.frameAllCount}67===b.keyCode&&f&&(f=!1,a.jumpIsPressing=!0)}},window.onkeyup=function(b){38===b.keyCode&&(f=!0,a.jumpIsPressing=!1),37===b.keyCode&&(a.mario.stop(),a.direction=""),39===b.keyCode&&(a.mario.stop(),a.direction=""),40===b.keyCode&&(a.downIsPressing=!1,a.downTouchEndFlag=!0),67===b.keyCode&&(f=!0,a.jumpIsPressing=!1)}},a.prototype.createSkillBtn=function(){var a=this,b=50,c=15,d=20,e=20;a.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW-b-d,stageH-(b+e),b,b),fillMode:"scale",res:images.jump,ontap:function(b){a.isGameVictory||a.jumpIsPressing||(a.jumpIsPressing=!0)}})),a.btnLayer.addUI(new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW-2*b-c-d,stageH-(b+e),b,b),fillMode:"scale",res:images.fight,ontap:function(b){a.isGameVictory||a.isFighting()||(a.mario._fightFrameCount=ycc.ticker.frameAllCount)}})),this.createMusicBtn()},a.prototype.createMusicBtn=function(){var a=this,b=new Ycc.UI.Image({rect:new Ycc.Math.Rect(stageW-40,10,30,30),anchorX:stageW-40+15,anchorY:25,fillMode:"scale",res:images.music,name:"musicBtn",ontap:function(a){audios.bgm.running?audios.bgm.pause():audios.bgm.play()}});b.addChild(new Ycc.UI.Line({start:new Ycc.Math.Dot(5,5),end:new Ycc.Math.Dot(25,25),width:3,color:"#ccc",ontap:function(a){audios.bgm.running?audios.bgm.pause():audios.bgm.play()}})),this.musicBtn=b,a.btnLayer.addUI(b)},a.prototype.createGameOverLayer=function(){function a(){console.log("nextLevel"),c();var a=levelList.indexOf(d.gameLevel);if(a!==-1){if(a===levelList.length-1)return"undefined"!=typeof wx?projectInit("#"+levelList[0]):(window.location.href=window.location.pathname+"#"+levelList[0],void window.location.reload());if("undefined"!=typeof wx)return projectInit("#"+levelList[a+1]);window.location.href=window.location.pathname+"#"+levelList[a+1],window.location.reload()}}function b(){console.log("restart"),c(),projectInit("#"+d.gameLevel)}function c(){Matter.Composite.allBodies(engine.world).forEach(function(a){a._yccUI&&(a._yccUI._matterBody=null,a._yccUI=null),Matter.World.remove(engine.world,a)}),Matter.Engine.clear(engine),d.btnLayer.removeSelf(),d.layer.removeSelf(),d.gameOverLayer.removeSelf(),d.update=null,currentScene=null}var d=this;this.gameOverLayer=ycc.layerManager.newLayer({enableEventManager:!0,name:"游戏结束图层",show:!1});var e,f,g,h;g=new Ycc.UI.Rect({rect:new Ycc.Math.Rect(0,0,stageW,stageH),color:"rgba(0,0,0,0.6)"}),h=new Ycc.UI.SingleLineText({rect:new Ycc.Math.Rect(0,stageH/2,stageW,5),xAlign:"center",color:"red",oncomputestart:function(){this.content="您的得分："+d.score;var a=levelList.indexOf(d.gameLevel);a===levelList.length-1&&d.isGameVictory&&(this.content="您的得分："+d.score+" 恭喜通关！")}}),e=new Ycc.UI.ComponentButton({rect:new Ycc.Math.Rect(stageW/2-110,stageH/2+50,100,40),backgroundImageRes:images.button,text:"重新开始",oncomputestart:function(){d.isGameVictory?(this.rect.x=stageW/2-110,f&&(f.show=!0)):(this.rect.x=stageW/2-50,f&&(f.show=!1))},ontap:b}),f=new Ycc.UI.ComponentButton({rect:new Ycc.Math.Rect(stageW/2,stageH/2+50,100,40),backgroundImageRes:images.button,text:"下一关",show:!1,ontap:a}),g.addChild(h),g.addChild(e),g.addChild(f),this.gameOverLayer.addUI(g)}}(GameScene),function(a){function b(){this.newGround(0,150,450),this.newMushroom(220,180),this.newMushroom(260,180),this.newMushroom(300,180),this.newBucket(100,150),this.newCoin(100,300,1,4),this.newBucket(350,150),this.newCoin(380,300,1,1),this.newCoin(450,350,1,1),this.newGround(550,150,100),this.newCoin(550,350,1,2),this.newWall(700,250,1,3),this.newCoin(700,450,1,5),this.newWall(850,400,1,3),this.newCoin(850,450,1,2),this.newWall(1050,50,1,3),this.newCoin(1050,250,1,5),this.newWall(1200,0,2,1),this.newWall(1240,0,3,1),this.newWall(1280,0,4,1),this.newWall(1320,0,5,1),this.newWall(1360,0,6,1),this.newWall(1400,0,7,1),this.newWall(1460,0,8,1),this.newWall(1560,0,10,1),this.newMissile(300,300),this.newMissile(1300,400),this.newMissile(2300,500)}a.prototype.level_1_1=function(){this.levelCommonSetting(),b.call(this),this.levelCommonEnd(1650)}}(GameScene),function(a){function b(){this.newGround(0,150,500),this.newGround(600,150,500),this.newGround(1200,150,100),this.newGround(1400,150,100),this.newGround(1600,150,50),this.newGround(1700,150,50),this.newGround(1800,150,50),this.newWall(1900,200,1,4),this.newWall(2200,300,1,2),this.newWall(2400,400,1,3),this.newWall(2600,200,1,3),this.newWall(2700,100,1,3),this.newWall(2800,300,1,7),this.newGround(3e3,150,500),this.newGround(3600,150,500),this.newWall(4100,200,1,8),this.newWall(4400,300,1,3),this.newWall(4600,400,1,2),this.newGround(4800,150,500),this.newMushroom(220,180),this.newMushroom(260,180),this.newMushroom(300,180),this.newMushroom(1220,180),this.newMushroom(1260,180),this.newMushroom(2220,180),this.newMushroom(2260,180),this.newMushroom(3220,180),this.newMushroom(3260,180),this.newMushroom(4220,180),this.newMushroom(4260,180),this.newCoin(100,300,1,3),this.newCoin(380,300,4,1),this.newCoin(450,350,2,1),this.newCoin(1200,500,1,3),this.newCoin(1800,400,1,3),this.newCoin(2100,300,4,3),this.newCoin(3100,300,1,3),this.newCoin(4100,300,1,3),this.newMissile(900,400),this.newMissile(1300,300),this.newMissile(1900,600),this.newMissile(3300,500)}a.prototype.level_1_2=function(){this.levelCommonSetting(),b.call(this),this.levelCommonEnd(4800)}}(GameScene),function(a){function b(){var a=0,b=150,c=200;this.newWall(0,200,1,10,[[0,2,1]]),this.newWall(150,350,2,5,[[1,2,1,3]]),this.newMushroom(350,500),a=500,b=150,c=400,this.newGround(a,b,c),this.newBucket(a,b),this.newBucket(a+c-80,b,1,80),this.newWall(a+100,b+200,1,4,[[0,1,1,1],[0,2,1,1]]),this.newCoin(a+150,b+250,1,3),this.newMushroom(a+100,b),this.newMushroom(a+150,b),this.newMushroom(a+200,b),a=1e3,b=150,c=700,this.newWall(a,b,1,5),this.newWall(a+250,b+100,1,5),this.newWall(a+500,b+200,1,5),this.newMushroom(a+200,b+200),this.newCoin(a,b+100,1,3),this.newCoin(a+250,b+100+100,1,3),this.newCoin(a+500,b+200+100,1,3)}a.prototype.level_1_3=function(){this.levelCommonSetting(),b.call(this),this.levelCommonEnd(1800)}}(GameScene),function(a){function b(){this.newGround(0,150,300),this.newWall(126,260,1,3,[[0,1,1,3]]),this.newWall(370,260,1,3,[]),this.newCoin(382,400,1,3),this.newWall(556,360,1,3,[]),this.newGround(676,150,300),this.newCoin(770,300,1,3),this.newBucket(864,150,1,80,90),this.newGround(1008,150,300),this.newBucket(1008,150,1,80,90),this.newBucket(1198,150,1,80,90),this.newMushroom(1112,150),this.newWall(1334,260,1,3,[]),this.newWall(1500,160,1,3,[]),this.newCoin(1500,260,1,5),this.newWall(1690,260,1,3,[]),this.newCoin(1692,400,1,3),this.newGround(1850,150,600),this.newBucket(1858,150,1,80,90),this.newBucket(2360,150,1,80,90),this.newMushroom(2080,150),this.newMushroom(2136,150),this.newMushroom(2216,150),this.newMushroom(1986,150),this.newMushroom(1986,310),this.newGround(2498,150,30),this.newGround(2586,150,30),this.newGround(2686,150,30),this.newGround(2788,150,100),this.newWall(2934,260,1,3,[]),this.newWall(3092,360,1,3,[]),this.newWall(3298,460,1,3,[]),this.newWall(3492,560,1,3,[]),this.newGround(3484,150,300),this.newWall(3484,260,1,3,[]),this.newBucket(3562,150,1,80,90),this.newMushroom(3690,150),this.newMushroom(3762,150),this.newWall(3792,260,1,3,[[0,1,1,10]]),this.newWall(2020,260,1,6,[[0,1,1,5]]),this.newGround(3926,150,300),this.newCoin(4128,200,1,3),this.newGround(4346,150,300),this.newWall(4646,260,1,3,[]),this.newWall(4770,0,5,1,[]),this.newWall(4810,0,6,1,[]),this.newWall(4850,0,7,1,[]),this.newWall(4890,0,8,1,[]),this.newWall(4930,0,9,1,[]),this.newWall(4970,0,10,2,[])}a.prototype.level_1_4=function(){this.levelCommonSetting(),b.call(this),this.levelCommonEnd(5100)}}(GameScene),!window.Ycc.utils.isMobile())throw document.body.innerHTML='<img src="./images/qr.png"/>',new Error("PC端请扫码进入！");var ycc=null,stageW=0,stageH=0,images=null,audios=null,bgmAutoplay=!0,currentScene=null,loading=null,engine=null,t1=0,t2=0,t3=0,t4=0,__log="自定义",levelList=["1_1","1_2","1_3","1_4"];createYcc(),loading=new Loading,loadRes(function(a,b){loading.hidden(),images=a,audios=b,projectInit()});