!function(a){a.UI.CropRect=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.CropRect,this.ctrlSize=6,this.enableDragOut=!1,this.fill=!0,this.ctrlRect1=new a.Math.Rect,this.ctrlRect2=new a.Math.Rect,this.ctrlRect3=new a.Math.Rect,this.ctrlRect4=new a.Math.Rect,this.btns=[],this.btnHeight=38,this.btnVerticalPadding=10,this.showName=!0,this.extend(b),this._initUI()},a.UI.CropRect.prototype=new a.UI.Base,a.UI.CropRect.prototype.showBtns=function(b){if(this.btns.length>0){for(var c=0;c<this.btns.length;c++)a.utils.isObj(this.btns[c])&&(this.btns[c].show=b);this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}},a.UI.CropRect.prototype.setCtrlBtns=function(b){var c=this;0!==b.length&&b.forEach(function(b){b=a.utils.extend({content:"",rectBgColor:"#666",color:"#fff",onclick:function(){}},b);var d=new a.UI.SingleLineText(b);d.addListener("mouseover",function(){this.color="#ccc",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),d.addListener("mouseout",function(){this.color="#fff",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),c.btns.push(d),c.belongTo.addUI(d)})},a.UI.CropRect.prototype.computeUIProps=function(){this.belongTo._setCtxProps(this);var b=this.rect,c=0,d=0,e=this.rect.x,f=this.rect.y+this.rect.height,g=this.belongTo.yccInstance.getStageWidth(),h=this.belongTo.yccInstance.getStageHeight();if(this.ctrlRect1=new a.Math.Rect(b.x,b.y,this.ctrlSize,this.ctrlSize),this.ctrlRect2=new a.Math.Rect(b.x+b.width-this.ctrlSize,b.y,this.ctrlSize,this.ctrlSize),this.ctrlRect3=new a.Math.Rect(b.x,b.y+b.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),this.ctrlRect4=new a.Math.Rect(b.x+b.width-this.ctrlSize,b.y+b.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),0!==this.btns.length){for(var i=0;i<this.btns.length;i++){var j=this.btns[i];j.overflow="auto",j.xAlign="center",j.rect.width=parseInt(this.ctx.measureText(j.content).width+2*this.btnVerticalPadding),j.rect.height=this.btnHeight,c+=j.rect.width+1}e+c>g&&(e=g-c),f+this.btnHeight>h&&(f=this.rect.y<this.btnHeight?0:this.rect.y-this.btnHeight-2);for(var k=0;k<this.btns.length;k++){var l=this.btns[k];l.rect.x=e+d,l.rect.y=f+2,d+=l.rect.width+1}}},a.UI.CropRect.prototype._initUI=function(){var b=this,c=null,d=null;this.userData=this.userData?this.userData:{},this.addListener("dragstart",function(e){this.userData.ctrlStart=0,this.userData.dragStartPosition=new a.Math.Rect(this.rect),this.userData.dragStartMousePosition=new a.Math.Dot(e);var f=new a.Math.Dot(e);c=f,d=new a.Math.Rect(b.rect);for(var g=1;g<=4;g++)if(f.isInRect(this["ctrlRect"+g]))return this.userData.ctrlStart=g,null}),this.addListener("dragging",function(a){var b,e,f,g,h=this.userData.dragStartPosition,i=this.userData.dragStartMousePosition;if(this.userData.ctrlStart<=4&&this.userData.ctrlStart>=1?(1===this.userData.ctrlStart&&(b=a.x-(i.x-h.x),e=a.y-(i.y-h.y),f=h.width-(a.x-h.x),g=h.height-(a.y-h.y),b<=h.x+h.width-2*this.ctrlSize&&(this.rect.x=b),e<=h.y+h.height-2*this.ctrlSize&&(this.rect.y=e)),2===this.userData.ctrlStart&&(b=h.x,e=a.y-(i.y-h.y),f=a.x-h.x+(h.width+h.x-i.x),g=h.height-(a.y-h.y),this.rect.x=b,e<=h.y+h.height-2*this.ctrlSize&&(this.rect.y=e)),3===this.userData.ctrlStart&&(b=a.x-(i.x-h.x),e=h.y,f=h.width-(a.x-h.x),g=a.y-h.y+(h.height+h.y-i.y),b<=h.x+h.width-2*this.ctrlSize&&(this.rect.x=b),this.rect.y=e),4===this.userData.ctrlStart&&(this.rect.x=h.x,this.rect.y=h.y,this.rect.width=a.x-h.x+(h.x+h.width-i.x),this.rect.height=a.y-h.y+(h.y+h.height-i.y)),f>=2*this.ctrlSize&&(this.rect.width=f),g>=2*this.ctrlSize&&(this.rect.height=g)):(this.rect.x=d.x+a.x-c.x,this.rect.y=d.y+a.y-c.y),this.rect.width<=2*this.ctrlSize&&(this.rect.width=2*this.ctrlSize),this.rect.height<=2*this.ctrlSize&&(this.rect.height=2*this.ctrlSize),!this.enableDragOut){var j=this.belongTo.yccInstance.getStageWidth(),k=this.belongTo.yccInstance.getStageHeight();this.rect.x<=0&&(this.rect.x=0),this.rect.y<=0&&(this.rect.y=0),this.rect.x+this.rect.width>=j&&(this.rect.x=j-this.rect.width),this.rect.y+this.rect.height>=k&&(this.rect.y=k-this.rect.height)}this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),this.addListener("dragend",function(a){b.showBtns(!0)})},a.UI.CropRect.prototype.render=function(){var a=this.rect;this.ctx.save(),this.ctx.fillStyle=this.fillStyle,this.ctx.strokeStyle=this.strokeStyle,this.ctx.beginPath(),this.ctx.rect(a.x,a.y,a.width,a.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.beginPath(),this.ctx.rect(this.ctrlRect1.x,this.ctrlRect1.y,this.ctrlRect1.width,this.ctrlRect1.height),this.ctx.rect(this.ctrlRect2.x,this.ctrlRect2.y,this.ctrlRect2.width,this.ctrlRect2.height),this.ctx.rect(this.ctrlRect3.x,this.ctrlRect3.y,this.ctrlRect3.width,this.ctrlRect3.height),this.ctx.rect(this.ctrlRect4.x,this.ctrlRect4.y,this.ctrlRect4.width,this.ctrlRect4.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="blue",this.ctx.font="normal normal bold 14px Arial",this.ctx.fillText(this.name,a.x+10,a.y+10),this.ctx.closePath(),this.ctx.restore()},a.UI.CropRect.prototype.removeSelf=function(){this.belongTo.removeUI(this),this.btns.forEach(function(a){a.removeSelf()})}}(window.Ycc);
//# sourceMappingURL=Ycc.UI.CropRect.class.min.js.map