!function(a){a.Ycc=function b(a){this.canvasDom=null,this.ctx=null,this.layerList=[],this.photoManager=null,this.layerManager=null,this.ticker=null,this["debugger"]=null,this.loader=new b.Loader,this.ajax=new b.Ajax,this.baseUI=null,this.config=a||{debug:{drawContainer:!1}},this.isMobile=b.utils.isMobile()},a.Ycc.prototype.getStageWidth=function(){return this.ctx.canvas.width},a.Ycc.prototype.getStageHeight=function(){return this.ctx.canvas.height},a.Ycc.prototype.bindCanvas=function(a){return a._ycc=this,this.canvasDom=a,this.ctx=this.canvasDom.getContext("2d"),this.layerList=[],this.photoManager=new Ycc.PhotoManager(this),this.layerManager=new Ycc.LayerManager(this),this.ticker=new Ycc.Ticker(this),this["debugger"]=new Ycc.Debugger(this),this.baseUI=new Ycc.UI(this.ctx.canvas),this.init(),this},a.Ycc.prototype.init=function(){this._initStageGestureEvent()},a.Ycc.prototype._initStageGestureEvent=function(){function a(a){var b=parseInt(a.clientX-g.ctx.canvas.getBoundingClientRect().left),c=parseInt(a.clientY-g.ctx.canvas.getBoundingClientRect().top),d=g.getUIFromPointer(new Ycc.Math.Dot(b,c));e(a.type,b,c),d&&(h[a.identifier]=d),d&&d.belongTo.enableEventManager&&f(a.type,b,c,d)}function b(a){var b=parseInt(a.clientX-g.ctx.canvas.getBoundingClientRect().left),c=parseInt(a.clientY-g.ctx.canvas.getBoundingClientRect().top);e(a.type,b,c);var d=h[a.identifier];d&&d.belongTo.enableEventManager&&f(a.type,b,c,d)}function c(a){var b=parseInt(a.clientX-g.ctx.canvas.getBoundingClientRect().left),c=parseInt(a.clientY-g.ctx.canvas.getBoundingClientRect().top);e(a.type,b,c);var d=h[a.identifier];d&&d.belongTo.enableEventManager&&f(a.type,b,c,d),d=null}function d(a){var b=parseInt(a.clientX-g.ctx.canvas.getBoundingClientRect().left),c=parseInt(a.clientY-g.ctx.canvas.getBoundingClientRect().top),d=g.getUIFromPointer(new Ycc.Math.Dot(b,c));e(a.type,b,c),d&&d.belongTo.enableEventManager&&f(a.type,b,c,d)}function e(a,b,c){for(var d=g.layerList.length-1;d>=0;d--){var e=g.layerList[d];e.enableEventManager&&e.enableEventManager&&e.triggerListener(a,new Ycc.Event({type:a,x:b,y:c}))}}function f(a,b,c,d){d.triggerListener(a,new Ycc.Event({x:b,y:c,type:a,target:d}))}var g=this,h={},i=new Ycc.Gesture({target:this.ctx.canvas});i.addListener("tap",d),i.addListener("longtap",d),i.addListener("doubletap",d),i.addListener("swipeleft",d),i.addListener("swiperight",d),i.addListener("swipeup",d),i.addListener("swipedown",d),i.addListener("dragstart",a),i.addListener("dragging",b),i.addListener("dragend",c)},a.Ycc.prototype.clearStage=function(){this.ctx.clearRect(0,0,this.getStageWidth(),this.getStageHeight())},a.Ycc.prototype.findLayerById=function(a){for(var b=0;b<this.layerList.length;b++){var c=this.layerList[b];if(c.id===a)return c}return null},a.Ycc.prototype.findUiById=function(a){for(var b=0;b<this.layerList.length;b++)for(var c=this.layerList[b],d=0;d<c.uiList.length;d++){var e=c.uiList[d];if(e.id===a)return e}return null},a.Ycc.prototype.getUIFromPointer=function(a,b){var c=this;b=!Ycc.utils.isBoolean(b)||b;for(var d=c.layerList.length-1;d>=0;d--){var e=c.layerList[d];if(!b||e.show){var f=e.getUIFromPointer(a,b);if(f)return f}}return null}}(window),function(a){a.utils={},a.utils.extend=function(b,c,d){d&&(c=a.utils.deepClone(c));for(var e in b)b.hasOwnProperty(e)&&c&&"undefined"!=typeof c[e]&&(b[e]=c[e]);return b},a.utils.mergeObject=function(a,b){b=b||{};for(var c in b)b.hasOwnProperty(c)&&"undefined"!=typeof b[c]&&(a[c]=b[c]);return a},a.utils.isString=function(a){return"string"==typeof a},a.utils.isNum=function(a){return"number"==typeof a},a.utils.isBoolean=function(a){return"boolean"==typeof a},a.utils.isObj=function(a){return"object"==typeof a},a.utils.isFn=function(a){return"function"==typeof a},a.utils.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a.utils.isMobile=function(){for(var a=navigator.userAgent,b=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],c=!1,d=0;d<b.length;d++)if(a.indexOf(b[d])>0){c=!0;break}return c},a.utils.deepClone=function(b){function c(b){var e={};for(var f in b)b.hasOwnProperty(f)&&(e[f]=b[f],a.utils.isArray(b[f])?e[f]=d(b[f]):a.utils.isObj(b[f])?e[f]=c(b[f]):e[f]=b[f]);return e}function d(b){for(var e=[],f=null,g=0;g<b.length;g++)f=b[g],a.utils.isArray(f)?e.push(d(f)):a.utils.isObj(f)?e.push(c(f)):e.push(f);return e}return a.utils.isArray(b)?d(b):c(b)},a.utils.renderTpl=function(a,b){return a.replace(/__.+?__/g,function(a){console.log("匹配到的文本-->",a);var c=a.slice(2).slice(0,-2).trim();return void 0!==b[c]?b[c]:a})},a.utils.releaseObject=function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b]},a.utils.releaseArray=function(a){a.length=0}}(Ycc),function(a){a.utils.extend;a.Math=function(){},a.Math.Dot=function(a){this.x=0,this.y=0;var b=arguments.length;1===b?(this.x=a.x,this.y=a.y):2===b&&(this.x=arguments[0],this.y=arguments[1])},a.Math.Dot.prototype.isInRect=function(a){return this.x>=a.x&&this.x<=a.x+a.width&&this.y>=a.y&&this.y<=a.y+a.height},a.Math.Rect=function(b){this.yccClass=a.Math.Rect,this.x=0,this.y=0,this.width=0,this.height=0;var c=arguments.length;1===c?(this.x=b.x,this.y=b.y,this.width=b.width,this.height=b.height):3===c?(this.x=arguments[0].x,this.y=arguments[0].y,this.width=arguments[1],this.height=arguments[2]):4===c&&(this.x=arguments[0],this.y=arguments[1],this.width=arguments[2],this.height=arguments[3]),this.toPositive()},a.Math.Rect.prototype.toPositive=function(){var a=this.x,b=this.y,c=this.x+this.width,d=this.y+this.height;this.x=a<c?a:c,this.y=b<d?b:d,this.width=Math.abs(this.width),this.height=Math.abs(this.height)},a.Math.Rect.prototype.getVertices=function(){return[new a.Math.Dot(this.x,this.y),new a.Math.Dot(this.x+this.width,this.y),new a.Math.Dot(this.x+this.width,this.y+this.height),new a.Math.Dot(this.x,this.y+this.height)]},a.Math.Rect.prototype.updateByVertices=function(b){return a.utils.isArray(b)?(this.x=b[0].x,this.y=b[0].y,this.width=b[1].x-this.x,void(this.height=b[2].y-this.y)):console.error("参数必须是数组！")},a.Math.Vector=function(){this.x=0,this.y=0,this.z=0,3!==arguments.length&&2!==arguments.length||(this.x=arguments[0]||0,this.y=arguments[1]||0,this.z=arguments[2]||0),1===arguments.length&&(a.utils.isObj(arguments[0])||console.error("constructor need a objec as param!"),this.x=arguments[0].x||0,this.y=arguments[0].y||0,this.z=arguments[0].z||0)},a.Math.Vector.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},a.Math.Vector.prototype.cross=function(b){var c=new a.Math.Vector;return c.x=this.y*b.z-b.y*this.z,c.y=b.x*this.z-this.x*b.z,c.z=this.x*b.y-b.x*this.y,c},a.Math.Vector.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z,2)},a.Math.Matrix=function(a,b,c){this.data=a,this.m=b,this.n=c},a.Math.Matrix.prototype.dot=function(b){if(b.m!==this.n||b.n!==this.m)return console.error("两个矩阵的行数和列数不对应，不能相乘！");for(var c=new a.Math.Matrix([],this.m,this.m),d=1;d<=this.m;d++)for(var e=1;e<=this.m;e++){for(var f=0,g=1;g<=this.n;g++)f+=this.get(d,g)*b.get(g,e);c.set(d,e,f)}return c},a.Math.Matrix.prototype.get=function(a,b){return this.data[(a-1)*this.n+b-1]},a.Math.Matrix.prototype.set=function(a,b,c){this.data[(a-1)*this.n+b-1]=c}}(window.Ycc),function(a){var b=1,c={};a.Tree=function(){this.$id=b++,this.$parentID=null,this.children=[],this.data=null,c[this.$id]=this},a.Tree.release=function(a){var b=a.getParent();if(b){var d=b.children,e=d.indexOf(a);e!==-1&&(d[e]=null)}delete c[a.$id],a.children.length=0,a.data=null},a.Tree.getNodeMap=function(){return c},a.Tree.prototype.getNodeMap=function(){return c},a.Tree.prototype.getParent=function(){return this.$parentID?c[this.$parentID]:null},a.Tree.prototype.addChildTree=function(a){return a.$parentID?console.error("sub tree's parent has exist! can't add!",a):(a.$parentID=this.$id,this.children.push(a),this)},a.Tree.prototype.removeChildTree=function(a){var b=this.children.indexOf(a);return b===-1?this:(this.children.splice(b,1),this)},a.Tree.prototype.getDepth=function(){var a=this,b=1;if(a.children.length>0)for(var c=0;c<a.children.length;c++){var d=a.children[c].getDepth();b=d+1>b?d+1:b}return b},a.Tree.prototype.itor=function(a){function b(a){if(a.call(g,g))return!0;if(g.children.length>0)for(var b=0;b<g.children.length;b++)if(g.children[b].itor().each(a))return!0;return!1}function c(a){if(g.children.length>0)for(var b=0;b<g.children.length;b++)if(g.children[b].itor().leftChildFirst(a))return!0;if(a.call(g,g))return!0}function d(a){if(g.children.length>0)for(var b=g.children.length-1;b>=0;b--)if(g.children[b].itor().rightChildFirst(a))return!0;if(a.call(g,g))return!0}function e(a){f([g],a)}function f(a,b,c){if(0===a.length)return!0;c=c||0,c++;for(var d=[],e=!1,h=0;h<a.length;h++){if(b.call(g,a[h],c)){e=!0;break}d=d.concat(a[h].children)}return e&&(d=[]),f(d,b,c)}var g=this;return{each:b,leftChildFirst:c,rightChildFirst:d,depthDown:e}},a.Tree.prototype.toNodeList=function(){var a=[];return this.itor().depthDown(function(b){a.push(b)}),a},a.Tree.prototype.getNodeListGroupByLayer=function(){var a={};return this.itor().depthDown(function(b,c){a[c]||(a[c]=[]),a[c].push(b)}),a},a.Tree.prototype.getParentList=function(){for(var a=this,b=[];a.$parentID;){var d=c[a.$parentID];b.unshift(d),a=d}return b},a.Tree.prototype.getBrotherList=function(){var a=[];return a=this.$parentID?c[this.$parentID].children:[this]},a.Tree.createByJSON=function(b){var c=new a.Tree;if(c.data=b.data,a.utils.isArray(b.children)&&b.children.length>0)for(var d=0;d<b.children.length;d++)c.addChildTree(a.Tree.createByJSON(b.children[d]));return c},a.Tree.createByNodes=function(b){if(!a.utils.isArray(b)||0===b.length)return console.error("need an Array as param!");var c=null,d=[];return b.forEach(function(b){var e=new a.Tree;e.data=b,d.push(e),a.utils.isNum(b.parentID)||b.parentID||(c=e)}),d.forEach(function(a){d.forEach(function(b){b.data.parentID===a.data.id&&a.addChildTree(b)})}),c}}(window.Ycc),function(a){var b=1,c=1,d=1,e={},f={};a.Graph=function(a){this.type=a||1,this.$id=d++,this.vList=[],this.eList=[]},a.Graph.prototype.getMapV=function(){return e},a.Graph.prototype.getMapE=function(){return f},a.Graph.prototype.bfs=function(a,b,c){if(a=a||[],c=c||[],c.length===this.vList.length)return!0;if(0===a.length){for(var d=null,f=0;f<this.vList.length;f++)if(c.indexOf(this.vList[f].$id)===-1){d=this.vList[f].$id;break}return this.bfs([d],b,c)}for(var g=null,h=0;h<a.length;h++){if(g=e[a[h]],b.call(this,g))return!0;c.push(g.$id)}for(var i=[],j=0;j<a.length;j++){g=e[a[j]];var k=g.getAccessibleIds().filter(function(a){return c.indexOf(a)===-1});i=i.concat(k)}return this.bfs(i,b,c)},a.Graph.prototype.dfs=function(a,b,c){c=c||[];var d=e[a];if(c.push(d.$id),b.call(this,d))return!0;for(var f=d.getAccessibleIds(),g=0;g<f.length;g++){var h=f[g];if(c.indexOf(h)===-1&&this.dfs(h,b,c))return!0}if(c.length===this.vList.length)return!0;for(var i=null,j=0;j<this.vList.length;j++)if(c.indexOf(this.vList[j].$id)===-1){i=this.vList[j].$id;break}return this.dfs(i,b,c)},a.Graph.createDirectedGraph=function(b,c){var d=new a.Graph(1),e=d.vList,f=d.eList;return b.forEach(function(b){e.push(new a.Graph.DirectedV(b))}),c.forEach(function(b){for(var c=null,d=null,g=new a.Graph.DirectedE,h=0;h<e.length&&(!c||!d);h++){var i=e[h];i.data.id===b.fromId&&(c=i,i.outIDs.push(g.$id)),i.data.id===b.toId&&(d=i,i.inIDs.push(g.$id))}g.init(c.$id,d.$id,b),f.push(g)}),d},a.Graph.DirectedV=function(a){this.$id=b++,this.data=a,this.inIDs=[],this.outIDs=[],e[this.$id]=this},a.Graph.DirectedV.prototype.getAccessibleIds=function(){var a=[];return this.outIDs.forEach(function(b){a.push(f[b].toID)}),a},a.Graph.DirectedE=function(){this.$id=c++,this.data=null,this.fromID=null,this.toID=null,f[this.$id]=this},a.Graph.DirectedE.prototype.init=function(a,b,c){this.fromID=a,this.toID=b,this.data=c},a.Graph.createUnDirectedGraph=function(b,c){var d=new a.Graph(2),e=d.vList,f=d.eList;return b.forEach(function(b){e.push(new a.Graph.UnDirectedV(b))}),c.forEach(function(b){for(var c=[],d=new a.Graph.UnDirectedE,g=0;g<e.length;g++){var h=e[g];if(2===c.length)break;h.data.id!==b.ids[0]&&h.data.id!==b.ids[1]||(c.push(h.$id),h.eIDs.push(d.$id))}d.init(c,b),f.push(d)}),d},a.Graph.UnDirectedV=function(a){this.$id=b++,this.data=a,this.eIDs=[],e[this.$id]=this},a.Graph.UnDirectedV.prototype.getAccessibleIds=function(){for(var a=[],b=0;b<this.eIDs.length;b++){var c=f[this.eIDs[b]];c.vIDs[0]===this.$id&&a.push(c.vIDs[1]),c.vIDs[1]===this.$id&&a.push(c.vIDs[0])}return a},a.Graph.UnDirectedE=function(){this.$id=c++,this.data=null,this.vIDs=[],f[this.$id]=this},a.Graph.UnDirectedE.prototype.init=function(a,b){this.vIDs=a,this.data=b}}(window.Ycc),function(a){a.Ticker=function(b){this.yccClass=a.Ticker,this.yccInstance=b,this.startTime=Date.now(),this.lastFrameTime=0,this.deltaTime=0,this.deltaTimeExpect=0,this.deltaTimeTotalValue=0,this.frameListenerList=[],this.defaultFrameRate=60,this.realTimeFrameRate=this.defaultFrameRate,this.frameAllCount=0,this.timerTickCount=0,this._timerId=0,this._isRunning=!1},a.Ticker.prototype.start=function(a){function b(){var e=0===c.timerTickCount?c.startTime:Date.now();c.timerTickCount++;var f=e-c.startTime,g=c.frameAllCount*c.deltaTimeExpect;f>g&&(c.frameAllCount++,c.realTimeFrameRate=1e3*c.frameAllCount/(e-c.startTime),c.broadcastFrameEvent(),c.broadcastToLayer(),c.deltaTime=Date.now()-c.lastFrameTime,c.frameAllCount>1&&(c.deltaTimeTotalValue+=c.deltaTime),c.deltaTime/c.deltaTimeExpect>3&&(console.warn("第%d帧：",c.frameAllCount),console.warn("该帧率已低于正常值的1/3！若相邻帧持续警告，请适当降低帧率，或者提升刷新效率！","正常值：",a," 当前值：",1e3/c.deltaTime)),c.lastFrameTime+=c.deltaTime),c._timerId=d.call(window,b)}var c=this;if(!c._isRunning){a=a?a:c.defaultFrameRate,c.deltaTimeExpect=1e3/a;var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;c.frameAllCount=0,d||(d=function(a){return window.setTimeout(a,1e3/60)}),c.startTime=Date.now(),c._timerId=d.call(window,b),c._isRunning=!0}},a.Ticker.prototype.stop=function(){var a=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame;a||(a=function(a){return window.clearTimeout(a)}),a(this._timerId),this._isRunning=!1},a.Ticker.prototype.addFrameListener=function(a){this.frameListenerList.push(a)},a.Ticker.prototype.broadcastFrameEvent=function(){for(var b=0;b<this.frameListenerList.length;b++){var c=this.frameListenerList[b];a.utils.isFn(c)&&c()}},a.Ticker.prototype.broadcastToLayer=function(){for(var a=0;a<this.yccInstance.layerList.length;a++){var b=this.yccInstance.layerList[a];b.show&&b.enableFrameEvent&&b.onFrameComing()}}}(window.Ycc),function(a){a.Debugger=function(b){this.yccClass=a.Debugger,this.yccInstance=b,this.deltaTime=null,this.deltaTimeExpect=null,this.frameAllCount=null,this.deltaTimeAverage=null,this.renderTime=null,this.renderUiCount=null,this.totalJSHeapSize=null,this.usedJSHeapSize=null,this.jsHeapSizeLimit=null,this.fields=[],this.rect=new a.UI.Rect({name:"debuggerRect",rect:new a.Math.Rect(10,10,200,140),color:"rgba(255,255,0,0.5)"}),this.layer=b.layerManager.newLayer({name:"debug图层"}),this.init()},a.Debugger.prototype.init=function(){var a=this;this.yccInstance.ticker.addFrameListener(function(){a.updateInfo()})},a.Debugger.prototype.showDebugPanel=function(){var a=this.layer;a.uiList.indexOf(this.rect)===-1&&a.addUI(this.rect)},a.Debugger.prototype.updateInfo=function(){var a=this.yccInstance.layerList,b=a.indexOf(this.layer);b+1!==a.length&&(a.splice(b,1),a.push(this.layer)),this.rect.rect.height=20*this.fields.length,this.fields.forEach(function(a){a.ui.content=a.name+" "+a.cb()})},a.Debugger.prototype.addField=function(b,c){var d=this.fields.length,e=new a.UI.SingleLineText({content:"usedJSHeapSize "+c(),fontSize:"12px",rect:new a.Math.Rect(0,20*d,100,20),color:"green"});this.fields.push({name:b,cb:c,ui:e}),this.rect.addChild(e)},a.Debugger.prototype.addToLayer=function(a){a.uiList.indexOf(this.rect)===-1&&a.addUI(this.rect)},a.Debugger.prototype.updateField=function(a,b){for(var c=0;c<this.fields.length;c++)if(this.fields[c].name===a)return this.fields[c].cb=null,void(this.fields[c].cb=b)}}(window.Ycc),function(a){function b(){this.currentTime=0,this.source=null,this.running=!1}a.Loader=function(){this.yccClass=a.Loader,this.ajax=new a.Ajax},a.Loader.prototype.loadResParallel=function(b,c,d,e,f){function g(g,h,i){return function(){e.push(g),"undefined"!=typeof g.name&&(f[g.name]=g.res),a.utils.isFn(d)&&d(g,i,h),b.length===e.length&&c(e,f)}}e=e||[],f=f||{};for(var h=0;h<b.length;h++){var i=b[h],j="load",k="error";i.type=i.type||"image","image"===i.type&&(i.res=new Image,i.res.src=i.url),"audio"===i.type&&(j="loadedmetadata",i.res=new Audio,i.res.src=i.url,i.res.preload="load"),i.res.addEventListener(j,g(i,h,!0)),i.res.addEventListener(k,g(i,h,!1))}},a.Loader.prototype.loadResOneByOne=function(c,d,e,f,g){function h(){clearTimeout(o),f.push(l),"undefined"!=typeof l.name&&(g[l.name]=l.res),a.utils.isFn(e)&&e(l,null,k),j.loadResOneByOne(c,d,e,f,g)}function i(b){clearTimeout(o),f.push(l),"undefined"!=typeof l.name&&(g[l.name]=l.res),a.utils.isFn(e)&&e(l,b,k),j.loadResOneByOne(c,d,e,f,g)}if(f=f||[],g=g||{},c.length===f.length)return void d(f,g);var j=this,k=f.length,l=c[k],m="load",n="error";l.type=l.type||"image";var o=setTimeout(function(){l.res.removeEventListener(m,h),l.res.removeEventListener(n,h),i({message:"获取资源超时！"})},l.timeout||1e4);if("image"===l.type)l.res=new Image,l.res.src=l.url,l.res.addEventListener(m,h),l.res.addEventListener(n,i);else if("audio"===l.type){if(l.res=new b,!l.res.context)return void i({message:"浏览器不支持AudioContext！"});j.ajax.get(l.url,function(a){return function(b){a.res.context.decodeAudioData(b,function(b){a.res.buf=b,h()},i)}}(l),i,"arraybuffer")}},a.Loader.prototype.getResByName=function(a,b){for(var c=0;c<b.length;c++)if(b[c].name===a)return b[c];return null},b.prototype.context=(window.AudioContext||window.webkitAudioContext)&&new(window.AudioContext||window.webkitAudioContext),b.prototype.play=function(){var a=this.context;if(a){this.running=!0;var b=a.createBufferSource();b.buffer=this.buf,b.connect(a.destination),b.start(this.currentTime),this.source=b}},b.prototype.pause=function(){var a=this.context;a&&(this.running=!1,this.source.stop())}}(window.Ycc),function(a){a.Ajax=function(){this.yccClass=a.Ajax},a.Ajax.prototype.get=function(a){var b,c,d=this,e="",f="json";1===arguments.length?(e="",b=a.successCb,c=a.errorCb,f="json"):(e=arguments[0],b=arguments[1],c=arguments[2],f=arguments[3]);var g=new XMLHttpRequest;g.open("GET",e,!0),g.responseType=f,g.onload=function(){b.call(d,g.response)},g.onerror=function(a){c.call(d,a)},g.send()}}(window.Ycc),function(a){a.Event=function(b){this.yccClass=a.Event,this.type=b?b:"",this.x=0,this.y=0,this.originEvent=null,this.stop=!1,this.target=null,a.utils.isObj(b)&&a.utils.extend(this,b)}}(window.Ycc),function(a){a.Listener=function(){this.yccClass=a.Listener,this.listeners={},this.stopType={},this.disableType={},this.stopAllEvent=!1,this.onclick=null,this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,this.ondragstart=null,this.ondragging=null,this.ondragend=null,this.onmouseover=null,this.onmouseout=null,this.ontouchstart=null,this.ontouchmove=null,this.ontouchend=null,this.ontap=null},a.Listener.release=function(b){var c=null;b.yccClass=null;for(c in b.listeners)b.listeners.hasOwnProperty(c)&&(b.listeners[c].length=0,delete b.listeners[c]);a.utils.releaseObject(b.stopType),a.utils.releaseObject(b.disableType),b.stopAllEvent=!0,b.onclick=null,b.onmousedown=null,b.onmouseup=null,b.onmousemove=null,b.ondragstart=null,b.ondragging=null,b.ondragend=null,b.onmouseover=null,b.onmouseout=null,b.ontouchstart=null,b.ontouchmove=null,b.ontouchend=null,b.ontap=null},a.Listener.prototype.addListener=function(a,b){var c=this.listeners[a];c||(this.listeners[a]=[]),this.listeners[a].indexOf(b)===-1&&this.listeners[a].push(b)},a.Listener.prototype.stop=function(a){this.stopType[a]=!0},a.Listener.prototype.triggerListener=function(b,c){if(!this.stopAllEvent&&!this.disableType[b]){this.stopType[b]||a.utils.isFn(this["on"+b])&&this["on"+b].apply(this,Array.prototype.slice.call(arguments,1));var d=this.listeners&&this.listeners[b];if(d&&a.utils.isArray(d))for(var e=0;e<d.length;e++)this.stopType[b]||d[e].apply(this,Array.prototype.slice.call(arguments,1))}},a.Listener.prototype.removeListener=function(b,c){var d=this.listeners[b];if(d&&a.utils.isArray(d))for(var e=0;e<d.length;e++)if(d[e]===c)return void d.splice(e,1)},a.Listener.prototype.disableEvent=function(a){this.disableType[a]=!0},a.Listener.prototype.resumeEvent=function(a){this.disableType[a]=!1}}(window.Ycc),function(a){var b=function(){var a=0;return function(){this.id=a++,this.startTouchEvent=null,this.endTouchEvent=null,this.moveTouchEventList=[],this.startTime=Date.now(),this.endTime=0}}();a.TouchLifeTracer=function(c){a.Listener.call(this),this.target=c.target,this._lifeList=[],this.currentLifeList=[],this.targetTouches=[],this.touches=[],this.changedTouches=[],this.onlifestart=null,this.onlifechange=null,this.onlifeend=null,this.addLife=function(a){this._lifeList.push(a)},this.findCurrentLifeByTouchID=function(a){for(var b=0;b<this.currentLifeList.length;b++){var c=this.currentLifeList[b];if(c.startTouchEvent.identifier===a)return c}},this.deleteCurrentLifeByTouchID=function(a){for(var b=0;b<this.currentLifeList.length;b++){var c=this.currentLifeList[b];if(c.startTouchEvent.identifier===a)return this.currentLifeList.splice(b,1),!0}return!1},this.init=function(){var a=this;this.target.addEventListener("touchstart",function(c){c.preventDefault(),a.syncTouches(c);var d=new b;d.startTouchEvent=c.changedTouches[0],a.addLife(d),a.currentLifeList.push(d),a.triggerListener("lifestart",d)}),this.target.addEventListener("touchmove",function(b){b.preventDefault(),a.syncTouches(b);for(var c=b.changedTouches,d=0;d<c.length;d++){var e=c[d],f=a.findCurrentLifeByTouchID(e.identifier);f.moveTouchEventList.push(e),a.triggerListener("lifechange",f)}}),this.target.addEventListener("touchend",function(b){b.preventDefault(),a.syncTouches(b);var c=b.changedTouches[0],d=a.findCurrentLifeByTouchID(c.identifier);d.endTouchEvent=c,d.endTime=Date.now(),a.deleteCurrentLifeByTouchID(c.identifier),a.triggerListener("lifeend",d)})},this.init()},a.utils.mergeObject(a.TouchLifeTracer.prototype,a.Listener.prototype),a.TouchLifeTracer.prototype.syncTouches=function(a){this.touches=[],this.changedTouches=[],this.targetTouches=[];var b=0,c=[];for(c=a.touches,b=0;b<c.length;b++)this.touches.push(c[b]);for(c=a.changedTouches,b=0;b<a.changedTouches.length;b++)this.changedTouches.push(c[b]);for(c=a.targetTouches,b=0;b<a.targetTouches.length;b++)this.targetTouches.push(c[b])}}(window.Ycc),function(a){a.Gesture=function(b){a.Listener.call(this),this.yccClass=a.Gesture,this.option=b,this._longTapTimeout=null,this._init()},a.Gesture.prototype=new a.Listener,a.Gesture.prototype._init=function(){a.utils.isMobile()?(console.log("mobile gesture init..."),this._initForMobile()):(console.log("pc gesture init..."),this._initForPC())},a.Gesture.prototype._initForMobile=function(){var b,c,d=this,e=new a.TouchLifeTracer({target:this.option.target}),f={tap:!1,swipe:!1};e.onlifestart=function(a){return d.triggerListener("tap",d._createEventData(a.startTouchEvent,"tap")),d.triggerListener("log","tap triggered"),d.triggerListener("dragstart",d._createEventData(a.startTouchEvent,"dragstart")),e.currentLifeList.length>1?(d.triggerListener("log","multi touch start ..."),d.triggerListener("multistart",e.currentLifeList),f.tap=!1,f.swipe=!1,clearTimeout(this._longTapTimeout),b=e.currentLifeList[0],c=e.currentLifeList[1],this):(f.tap=!1,f.swipe=!1,void(this._longTapTimeout=setTimeout(function(){d.triggerListener("longtap",d._createEventData(a.startTouchEvent,"longtap"))},750)))},e.onlifechange=function(g){if(g.moveTouchEventList.forEach(function(a){d.triggerListener("dragging",d._createEventData(a,"dragging"))}),e.currentLifeList.length>1){f.tap=!0,f.swipe=!0,d.triggerListener("log","multi touch move ..."),d.triggerListener("multichange",b,c);var h=d.getZoomRateAndRotateAngle(b,c);return a.utils.isNum(h.rate)&&(d.triggerListener("zoom",h.rate),d.triggerListener("log","zoom triggered",h.rate)),a.utils.isNum(h.angle)&&(d.triggerListener("rotate",h.angle),d.triggerListener("log","rotate triggered",h.angle)),this}if(g.moveTouchEventList.length>0){var i=g.startTouchEvent,j=Array.prototype.slice.call(g.moveTouchEventList,-1)[0];(Math.abs(j.pageX-i.pageX)>10||Math.abs(j.pageY-i.pageY)>10)&&(f.tap=!0,clearTimeout(this._longTapTimeout))}},e.onlifeend=function(a){if(d.triggerListener("dragend",d._createEventData(a.endTouchEvent,"dragend")),1===e.currentLifeList.length)return d.triggerListener("multiend",b,c);if(0===e.currentLifeList.length){if(!f.tap&&a.endTime-a.startTime<300)return clearTimeout(this._longTapTimeout),b&&a.endTime-b.endTime<300&&Math.abs(b.endTouchEvent.pageX-a.endTouchEvent.pageX)<10&&Math.abs(b.endTouchEvent.pageY-a.endTouchEvent.pageY)<10?(d.triggerListener("doubletap",d._createEventData(a.endTouchEvent,"doubletap")),d.triggerListener("log","doubletap triggered"),b=null,this):(b=a,this);if(!f.swipe&&a.endTime-a.startTime<300){console.log("swipe");var g=a.startTouchEvent,h=Array.prototype.slice.call(a.moveTouchEventList,-1)[0];if(Math.abs(h.pageX-g.pageX)>30||Math.abs(h.pageY-g.pageY)>30){var i="swipe"+d._getSwipeDirection(g.pageX,g.pageY,h.pageX,h.pageY);d.triggerListener("log",i),d.triggerListener(i,d._createEventData(a.endTouchEvent,i))}return this}}}},a.Gesture.prototype._initForPC=function(){var a=this,b=null,c=null,d=!1,e=null,f=-1,g=0;this.option.target.addEventListener("mousedown",function(c){c.identifier=++g,b=a._createEventData(c),f=setTimeout(function(){console.log("longtap",Date.now(),"..."),a.triggerListener("log","long tap ..."),a.triggerListener("longtap",a._createEventData(b,"longtap"))},750)}),this.option.target.addEventListener("mousemove",function(e){if(b){if(b&&e.clientX===b.clientX&&e.clientY===b.clientY)return;if(c&&e.clientX===b.clientX&&e.clientY===b.clientY)return;clearTimeout(f),d||(a.triggerListener("dragstart",a._createEventData(b,"dragstart")),d=!0),e.identifier=g,a.triggerListener("dragging",a._createEventData(e,"dragging"))}else clearTimeout(f)}),this.option.target.addEventListener("mouseup",function(h){if(h.identifier=g,c=a._createEventData(h),d){if(clearTimeout(f),a.triggerListener("dragend",a._createEventData(h,"dragend")),d&&c.createTime-b.createTime<300&&(Math.abs(c.pageX-b.pageX)>30||Math.abs(c.pageY-b.pageY)>30)){var i="swipe"+a._getSwipeDirection(b.pageX,b.pageY,c.pageX,c.pageY);console.log("swipe",i),a.triggerListener("log",i),a.triggerListener(i,a._createEventData(b,i))}return d=!1,b=null,null}if(!d&&b&&c.createTime-b.createTime<300){clearTimeout(f);var j=a._createEventData(b,"tap");return a.triggerListener("tap",j),a.triggerListener("log","tap triggered"),e&&j.createTime-e.createTime<300&&Math.abs(e.pageX-j.pageX)<10&&Math.abs(e.pageY-j.pageY)<10?(a.triggerListener("doubletap",a._createEventData(j,"doubletap")),a.triggerListener("log","doubletap triggered"),preLife=null,this):(e=j,b=null,this)}})},a.Gesture.prototype._createEventData=function(b,c){var d={type:"",target:null,identifier:-1,clientX:0,clientY:0,pageX:0,pageY:0,screenX:0,screenY:0,force:1,createTime:Date.now()};return d=a.utils.extend(d,b),d.type=c,d},a.Gesture.prototype._getSwipeDirection=function(a,b,c,d){return Math.abs(a-c)>=Math.abs(b-d)?a-c>0?"left":"right":b-d>0?"up":"down"},a.Gesture.prototype.getZoomRateAndRotateAngle=function(b,c){this.triggerListener("log","preLife"),this.triggerListener("log",b),this.triggerListener("log","curLife"),this.triggerListener("log",c);var d=b.startTouchEvent.pageX,e=b.startTouchEvent.pageY,f=c.startTouchEvent.pageX,g=c.startTouchEvent.pageY,h=b.moveTouchEventList.length>0?b.moveTouchEventList[b.moveTouchEventList.length-1]:b.startTouchEvent,i=c.moveTouchEventList.length>0?c.moveTouchEventList[c.moveTouchEventList.length-1]:c.startTouchEvent,j=h.pageX,k=h.pageY,l=i.pageX,m=i.pageY,n=new a.Math.Vector(f-d,g-e),o=new a.Math.Vector(l-j,m-k),p=Math.acos(o.dot(n)/(o.getLength()*n.getLength()))/Math.PI*180;return{rate:o.getLength()/n.getLength(),angle:p*(o.cross(n).z>0?-1:1)}}}(window.Ycc),function(a){var b=0;a.Layer=function(c,d){a.Listener.call(this),d=d||{},this.yccClass=a.Layer,this.uiList=[],this.uiCountRecursion=0,this.yccInstance=c,this.canvasDom=null,this.ctx=null,this.id=b++,this.type="ui",this.textValue="",this.name=d.name?d.name:"图层_"+this.type+"_"+this.id,this.x=0,this.y=0,this.width=c.getStageWidth(),this.height=c.getStageHeight(),this.show=!0,this.enableEventManager=!1,this.enableFrameEvent=!1,this.onFrameComing=function(){},a.utils.extend(this,d),this.init()},a.Layer.prototype=new a.Listener,a.Layer.prototype.constructor=a.Layer,a.Layer.release=function(b){a.Listener.release(b),b.yccClass=null,b.uiList=null,b.yccInstance=null,b.show=!1,b.enableEventManager=!1,b.enableFrameEvent=!1,b.onFrameComing=null},a.Layer.prototype.init=function(){var a=this,b=this.yccInstance.canvasDom;this.ctx=b.getContext("2d"),this.canvasDom=b,a._setCtxProps()},a.Layer.prototype._initEvent=function(){function b(b){if(!b.stop&&!(e&&b.x===e.x&&b.y===e.y||f&&b.x===f.x&&b.y===f.y)){if(g=!0,e){if(!h){var c=new a.Event({type:"dragstart",x:e.x,y:e.y,mouseDownYccEvent:e});d.triggerListener(c.type,c),e.target&&(c.target=e.target,c.target.triggerListener(c.type,c))}h=!0;var i=new a.Event({type:"dragging",x:b.x,y:b.y,mouseDownYccEvent:e});return d.triggerListener(i.type,i),e.target&&(i.target=e.target,i.target.triggerListener(i.type,i)),null}for(var j=d.uiList.length-1;j>=0;j--){var k=d.uiList[j],l=new a.Math.Dot(b.x-k.belongTo.x,b.y-k.belongTo.y);if(l.isInRect(k.rect)){b.stop=!0,b.mouseDownYccEvent=e,b.mouseUpYccEvent=f,b.target=k,k.triggerListener(b.type,b);break}}}}function c(b){if(!b.stop)for(var c=d.uiList.length-1;c>=0;c--){var g=d.uiList[c],h=new a.Math.Dot(b.x,b.y);if(g.rect&&h.isInRect(g.getAbsolutePosition())&&b.stop===!1){b.stop=!0,b.mouseDownYccEvent=e,b.mouseUpYccEvent=f,b.target=g,b.targetDeltaPosition=new a.Math.Dot(b.x-g.getAbsolutePosition().x,b.y-g.getAbsolutePosition().y),g.triggerListener(b.type,b);break}}}var d=this,e=null,f=null,g=!1,h=!1;this.addListener("click",function(a){g||c(a)}),this.addListener("mousedown",function(a){g=!1,h=!1,e=a,c(a)}),this.addListener("mouseup",function(b){if(h){var g=new a.Event({type:"dragend",x:b.x,y:b.y,mouseDownYccEvent:e});d.triggerListener("dragend",g),e&&e.target&&(d.target=e.target,d.target.triggerListener("dragend",g))}b.mouseDownYccEvent=e=null,f=b,c(b)}),this.addListener("mousemove",b)},a.Layer.prototype._setCtxProps=function(b){var c=this,d={fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontSize:"16px",fontFamily:"微软雅黑",font:"16px 微软雅黑",textBaseline:"hanging",fillStyle:"red",strokeStyle:"blue"};d=a.utils.extend(d,b),d.font=[d.fontStyle,d.fontVariant,d.fontWeight,d.fontSize,d.fontFamily].join(" ");for(var e in d)d.hasOwnProperty(e)&&(c.ctx[e]=d[e])},a.Layer.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},a.Layer.prototype.removeAllUI=function(){this.uiList.forEach(function(b){a.UI.release(b)}),this.uiList.length=0},a.Layer.prototype.removeSelf=function(){this.removeAllUI(),this.yccInstance.layerManager.deleteLayer(this),a.Layer.release(this)},a.Layer.prototype.renderToStage=function(){this.show&&this.yccInstance.ctx.drawImage(this.ctx.canvas,0,0,this.width,this.height)},a.Layer.prototype.addUI=function(a,b){var c=this;if(a.itor().each(function(a){a.init(c)}),!b)return this.uiList.push(a);var d=this.uiList.indexOf(b);return d===-1?this.uiList.push(a):void this.uiList.splice(d,0,a)},a.Layer.prototype.removeUI=function(b){if(!b)return!1;var c=this.uiList.indexOf(b);return c!==-1&&(a.UI.release(b),this.uiList[c]=null,this.uiList.splice(c,1),!0)},a.Layer.prototype.render=function(){
for(var a=0;a<this.uiList.length;a++)this.uiList[a].show&&this.uiList[a].render()},a.Layer.prototype.reRender=function(){var a=this;a.uiCountRecursion=0;for(var b=0;b<this.uiList.length;b++)this.uiList[b].show&&this.uiList[b].itor().depthDown(function(b,c){a.uiCountRecursion++,b.show&&b.__render()})},a.Layer.prototype.getUIFromPointer=function(b,c){c=!a.utils.isBoolean(c)||c;for(var d=this,e=null,f=d.uiList.length-1;f>=0;f--){var g=d.uiList[f];c&&!g.show||g.itor().rightChildFirst(function(a){if(b.isInRect(a.getAbsolutePosition()))return e=a,!0})}return e},a.Layer.prototype.transformToAbsolute=function(b){var c=null;if(a.utils.isArray(b)){c=[];for(var d=0;d<b.length;d++){var e=new a.Math.Dot(0,0),f=b[d];e.x=this.x+f.x,e.y=this.y+f.y,c.push(e)}return c}return c=new a.Math.Dot(0,0),c.x=this.x+b.x,c.y=this.y+b.y,c},a.Layer.prototype.transformToLocal=function(b){var c=null;if(a.utils.isArray(b)){c=[];for(var d=0;d<b.length;d++){var e=new a.Math.Dot(0,0),f=b[d];e.x=f.x-this.x,e.y=f.y-this.y,c.push(e)}return c}return c=new a.Math.Dot(0,0),c.x=b.x-this.x,c.y=b.y-this.y,c}}(window.Ycc),function(a){a.LayerManager=function(a){this.yccInstance=a,this.renderTime=0,this.renderUiCount=0},a.LayerManager.prototype.init=function(){},a.LayerManager.prototype.newLayer=function(b){var c=new a.Layer(this.yccInstance,b);return this.yccInstance.layerList.push(c),c},a.LayerManager.prototype.deleteLayer=function(a){for(var b=this.yccInstance.layerList,c=0;c<b.length;c++)if(b[c].id===a.id)return this.yccInstance.layerList.splice(c,1),a;return a},a.LayerManager.prototype.deleteAllLayer=function(){for(var b=0;b<this.yccInstance.layerList.length;b++){var c=this.yccInstance.layerList[b];c.removeAllUI(),a.Layer.release(c),c=null}this.yccInstance.layerList=[]},a.LayerManager.prototype.reRenderAllLayerToStage=function(){var a=Date.now();this.renderUiCount=0,this.yccInstance.clearStage();for(var b=0;b<this.yccInstance.layerList.length;b++){var c=this.yccInstance.layerList[b];c.show&&(c.reRender(),this.renderUiCount+=c.uiCountRecursion)}this.renderTime=Date.now()-a},a.LayerManager.prototype.enableEventManagerOnly=function(a){if(!a)return!1;for(var b=0;b<this.yccInstance.layerList.length;b++)this.yccInstance.layerList[b].enableEventManager=!1;return a.enableEventManager=!0,this},a.LayerManager.prototype.enableEventManagerAll=function(a){for(var b=0;b<this.yccInstance.layerList.length;b++)this.yccInstance.layerList[b].enableEventManager=a;return this},a.LayerManager.prototype.renderAllLayerByJsonArray=function(b){if(!a.utils.isArray(b))return console.error("jsonArray is not an Array!",b);for(var c=this,d=0;d<b.length;d++){var e=b[d];if(!a.utils.isObj(e))return console.error("item in jsonArray should be an Object!",e);for(var f=c.newLayer(e.option),g=0;g<e.ui.length;g++){var h=e.ui[g];f.addUI(new a.UI[h.type](h.option))}f.render()}}}(window.Ycc),function(a){var b=function(a){this.imageData=a,this.createTime=new Date,this.id=this.createTime.getTime()};a.PhotoManager=function(a){this.yccInstance=a,this.ctx=a.ctx,this._photos=[]},a.PhotoManager.prototype.takePhoto=function(){return this._photos.push(new b(this.ctx.getImageData(0,0,this.yccInstance.getStageWidth(),this.yccInstance.getStageHeight()))),this},a.PhotoManager.prototype.getHistoryPhotos=function(){return this._photos},a.PhotoManager.prototype.showPhoto=function(a){return this.ctx.putImageData(a.imageData,0,0),a},a.PhotoManager.prototype.showLastPhoto=function(){var a=this._photos.length,b=!1;return a>=1&&(b=this._photos[a-1],this.showPhoto(b)),b},a.PhotoManager.prototype.delPhotoById=function(a){for(var b=this._photos.slice(0),c=0;c<b.length;c++)if(b[c].id===a)return b.splice(c+1,1),this._photos=b,b[c];return!1}}(window.Ycc),function(a){if(!a||!a.utils)return console.error("Error: Ycc.ui needs module `Ycc` and `Ycc.utils`!");a.utils.isObj,a.utils.isArray,a.utils.isString,a.utils.isNum,a.utils.extend;a.UI=function(b){this.yccClass=a.UI,this._photos=[],this.ctx=b.getContext("2d"),this.ctxWidth=b.width,this.ctxHeight=b.height},a.UI.prototype.text=function(a,b,c){return this.ctx.save(),c?this.ctx.fillText(b,a[0],a[1]):this.ctx.strokeText(b,a[0],a[1]),this.ctx.restore(),this},a.UI.prototype.line=function(a,b){return this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]),this.ctx.lineTo(b[0],b[1]),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},a.UI.prototype.rect=function(a,b,c){return this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(a[0],a[1],b[0]-a[0],b[1]-a[1]),this.ctx.closePath(),c?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.ellipse=function(a,b,c,d,e){this.ctx.save();var f=b>c?b:c,g=b/f,h=c/f;return this.ctx.translate(a[0],a[1]),this.ctx.rotate(parseInt(d)*Math.PI/180),this.ctx.translate(-a[0],-a[1]),this.ctx.scale(g,h),this.ctx.beginPath(),this.ctx.arc(a[0]/g,a[1]/h,f,0,2*Math.PI,!1),this.ctx.closePath(),e?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.circleArc=function(a,b,c,d,e){return this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a[0],a[1],b,c/180*Math.PI,d/180*Math.PI,e),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},a.UI.prototype.sector=function(a,b,c,d,e,f){return this.ctx.save(),this.ctx.beginPath(),this.ctx.lineTo(a[0],a[1]),this.ctx.arc(a[0],a[1],b,c*Math.PI/180,d*Math.PI/180,f),this.ctx.lineTo(a[0],a[1]),this.ctx.closePath(),e?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.foldLine=function(a){if(a.length<2)return console.error("Error: 参数错误！");this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a[0][0],a[0][1]);for(var b=0;b<a.length;b++)this.ctx.lineTo(a[b][0],a[b][1]);return this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.circle=function(a,b,c){return this.ellipse(a,b,b,0,c),this},a.UI.prototype.image=function(a,b){var c=this;return b=b||[0,0],c.ctx.save(),c.ctx.beginPath(),c.ctx.drawImage(a,b[0],b[1]),c.ctx.closePath(),c.ctx.restore(),this},a.UI.prototype._getMaxLenContent=function(a,b){var c=a,d=0;if(this.ctx.measureText(a).width<=b)return a;for(var e=0;e<a.length;e++)if(c=a.slice(0,e),d=this.ctx.measureText(c).width,d>b)return a.slice(0,e-1)},a.UI.prototype.scale=function(a,b){return this.ctx.scale(a,b),this},a.UI.prototype.clear=function(){var a={fillStyle:"#fff"};return this.ctx.fillStyle=a.fillStyle,this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,this.ctxWidth,this.ctxHeight),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this}}(window.Ycc),function(a){var b=0;a.UI.Base=function(c){a.Listener.call(this),a.Tree.call(this),this.yccClass=a.UI.Base,this.id=b++,this.name="",this.ctx=null,this.rect=new a.Math.Rect,this.anchorX=0,this.anchorY=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.rectBgColor="transparent",this.rectBgAlpha=1,this.show=!0,this.lineWidth=1,this.fillStyle="black",this.strokeStyle="black",this.belongTo=null,this.userData=null,this.baseUI=null,this.beforeInit=null,this.afterInit=null,this.oncomputestart=null,this.oncomputeend=null,this.onrenderstart=null,this.onrenderend=null,this.extend(c)},a.utils.mergeObject(a.UI.Base.prototype,a.Listener.prototype),a.utils.mergeObject(a.UI.Base.prototype,a.Tree.prototype),a.UI.Base.prototype.init=function(b){a.utils.isFn(this.beforeInit)&&this.beforeInit(),this.belongTo=b,this.ctx=b.ctx,this.computeUIProps(),a.utils.isFn(this.afterInit)&&this.afterInit()},a.UI.Base.prototype.computeUIProps=function(){},a.UI.Base.prototype.renderRectBgColor=function(){var a=this.getAbsolutePosition();this.ctx.save(),this.ctx.globalAlpha=this.rectBgAlpha,this.ctx.fillStyle=this.rectBgColor,this.ctx.beginPath(),this.ctx.rect(a.x,a.y,a.width,a.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()},a.UI.Base.prototype.removeSelf=function(){this.belongTo.removeUI(this)},a.UI.Base.prototype.addChild=function(a){return this.belongTo&&a.init(this.belongTo),this.addChildTree(a),this},a.UI.Base.prototype.removeChild=function(b){return this.removeChildTree(b),a.UI.release(b),this},a.UI.Base.prototype.scaleAndRotate=function(){this.ctx.scale(this.scaleX,this.scaleY);var a=this.getAbsolutePosition();this.ctx.translate(this.anchorX+a.x,this.anchorY+a.y),this.ctx.rotate(this.rotation*Math.PI/180),this.ctx.translate(-this.anchorX-a.x,-this.anchorY-a.y)},a.UI.release=function(b){b.itor().leftChildFirst(function(b){console.log("release "+(b.yccClass?b.yccClass.name:""),b),b.yccClass!==a.UI.Image&&b.yccClass!==a.UI.ImageFrameAnimation||(b.res=null),a.Tree.release(b),a.Listener.release(b),b.yccInstance=null,b.yccClass=null,b.ctx=null,b.belongTo=null,b.userData=null,b.baseUI=null,b.beforeInit=null,b.afterInit=null,b.oncomputestart=null,b.oncomputeend=null,b.onrenderstart=null,b.onrenderend=null})},a.UI.Base.prototype.render=function(a){},a.UI.Base.prototype._renderContainer=function(){var a=this.rect;this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#ff0000",this.ctx.rect(a.x,a.y,a.width,a.height),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()},a.UI.Base.prototype.__render=function(b){this.triggerListener("computestart",new a.Event("computestart")),this.computeUIProps(),this.triggerListener("computeend",new a.Event("computeend")),this.renderRectBgColor(),this.belongTo.yccInstance.config.debug.drawContainer&&this._renderContainer(),this.triggerListener("renderstart",new a.Event("renderstart")),this.render(b),this.triggerListener("renderend",new a.Event("renderend"))},a.UI.Base.prototype.getMaxContentInWidth=function(a,b){var c=a,d=0;if(this.ctx.measureText(a).width<=b)return a;for(var e=0;e<a.length;e++)if(c=a.slice(0,e+1),d=this.ctx.measureText(c).width,d>b)return a.slice(0,e)},a.UI.Base.prototype.extend=function(a){a=a||{};for(var b in this)"undefined"!=typeof a[b]&&(this[b]=a[b]);return this},a.UI.Base.prototype.clone=function(){var a=new this.yccClass;return a.extend(this),a},a.UI.Base.prototype.getAbsolutePosition=function(){var b=new a.Math.Rect,c=this.getParent();if(b.width=this.rect.width,b.height=this.rect.height,c){var d=c.getAbsolutePosition();b.x=this.rect.x+d.x,b.y=this.rect.y+d.y}else b.x=this.rect.x+this.belongTo.x,b.y=this.rect.y+this.belongTo.y;return b},a.UI.Base.prototype.transformToAbsolute=function(b){var c=null,d=this.getAbsolutePosition();if(a.utils.isArray(b)){c=[];for(var e=0;e<b.length;e++){var f=new a.Math.Dot(0,0),g=b[e];f.x=d.x+g.x,f.y=d.y+g.y,c.push(f)}return c}return c=new a.Math.Dot(0,0),c.x=d.x+b.x,c.y=d.y+b.y,c},a.UI.Base.prototype.transformToLocal=function(b){var c=null,d=this.getAbsolutePosition();if(a.utils.isArray(b)){c=[];for(var e=0;e<b.length;e++){var f=new a.Math.Dot(0,0),g=b[e];f.x=g.x-d.x,f.y=g.y-d.y,c.push(f)}return c}return c=new a.Math.Dot(0,0),c.x=b.x-d.x,c.y=b.y-d.y,c}}(window.Ycc),function(a){a.UI.Ellipse=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.Ellipse,this.point=new a.Math.Dot,this.width=20,this.height=10,this.angle=0,this.color="black",this.fill=!1,this.extend(b)},a.utils.mergeObject(a.UI.Ellipse.prototype,a.UI.Base.prototype),a.UI.Ellipse.prototype.constructor=a.UI.Ellipse,a.UI.Ellipse.prototype.computeUIProps=function(){var a=this.point.x,b=this.point.y,c=this.width/2,d=this.height/2,e=this.angle/180*Math.PI,f=Math.sqrt(Math.cos(e)*Math.cos(e)*d*d+Math.sin(e)*Math.sin(e)*c*c)+b,g=-f+2*b,h=Math.sqrt(Math.cos(e)*Math.cos(e)*c*c+Math.sin(e)*Math.sin(e)*d*d)+a,i=-h+2*a;this.rect.x=i,this.rect.y=g,this.rect.width=h-i,this.rect.height=f-g},a.UI.Ellipse.prototype.render=function(){var a=this.width,b=this.angle,c=this.height,d=this.getParent(),e=d?d.transformToAbsolute(this.point):this.point;this.ctx.save();var f=a>c?a:c,g=a/f,h=c/f;this.ctx.translate(e.x,e.y),this.ctx.rotate(parseInt(b)*Math.PI/180),this.ctx.translate(-e.x,-e.y),this.ctx.scale(g,h),this.ctx.beginPath(),this.ctx.arc(e.x/g,e.y/h,f/2,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fillStyle=this.ctx.strokeStyle=this.color,this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.Circle=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.Circle,this.point=null,this.r=10,this.color="black",this.fill=!0,this.extend(b)},a.utils.mergeObject(a.UI.Circle.prototype,a.UI.Base.prototype),a.UI.Circle.prototype.computeUIProps=function(){var b=this.point.x,c=this.point.y,d=this.r;this.rect=new a.Math.Rect(b-d,c-d,2*d,2*d)},a.UI.Circle.prototype.render=function(){var a=this.getParent(),b=a?a.transformToAbsolute(this.point):this.point;this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.arc(b.x,b.y,this.r,0,2*Math.PI),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.Image=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.Image,this.fillMode="none",this.res=null,this.mirror=0,this.scale9GridRect=null,this.scaleRepeatRect=null,this.extend(b)},a.utils.mergeObject(a.UI.Image.prototype,a.UI.Base.prototype),a.UI.Image.prototype.constructor=a.UI.Image,a.UI.Image.prototype.computeUIProps=function(){"auto"===this.fillMode&&(this.rect.width=this.res.width,this.rect.height=this.res.height)},a.UI.Image.prototype._processMirror=function(a){1===this.mirror&&(this.ctx.scale(-1,1),this.ctx.translate(2*-a.x-a.width,0)),2===this.mirror&&(this.ctx.scale(1,-1),this.ctx.translate(0,2*-a.y-a.height)),3===this.mirror&&(this.ctx.scale(-1,-1),this.ctx.translate(2*-a.x-a.width,2*-a.y-a.height))},a.UI.Image.prototype.render=function(){this.ctx.save(),this.scaleAndRotate();var b,c,d,e,f,g,h=this.getAbsolutePosition(),i=this.res;if(this._processMirror(h),"none"===this.fillMode)this.ctx.drawImage(this.res,0,0,h.width,h.height,h.x,h.y,h.width,h.height);else if("scale"===this.fillMode)this.ctx.drawImage(this.res,0,0,i.width,i.height,h.x,h.y,h.width,h.height);else if("auto"===this.fillMode)this.ctx.drawImage(this.res,0,0,i.width,i.height,h.x,h.y,h.width,h.height);else if("repeat"===this.fillMode)for(d=parseInt(h.width/i.width)+1,e=parseInt(h.height/i.height)+1,b=0;b<d;b++)for(c=0;c<e;c++)f=i.width,g=i.height,b===d-1&&(f=h.width-b*i.width),c===e-1&&(g=h.height-c*i.height),this.ctx.drawImage(this.res,0,0,f,g,h.x+i.width*b,h.y+i.height*c,f,g);else if("scaleRepeat"===this.fillMode)for(d=parseInt(h.width/this.scaleRepeatRect.width)+1,e=parseInt(h.height/this.scaleRepeatRect.height)+1,b=0;b<d;b++)for(c=0;c<e;c++)f=this.scaleRepeatRect.width,g=this.scaleRepeatRect.height,b===d-1&&(f=h.width-b*this.scaleRepeatRect.width),c===e-1&&(g=h.height-c*this.scaleRepeatRect.height),this.ctx.drawImage(this.res,0,0,i.width,i.height,h.x+this.scaleRepeatRect.width*b,h.y+this.scaleRepeatRect.height*c,f,g);else if("scale9Grid"===this.fillMode){var j,k,l=this.scale9GridRect,m=[];m[0]={},m[0].src=new a.Math.Rect(0,0,l.x,l.y),m[0].dest=new a.Math.Rect(h.x,h.y,l.x,l.y),m[2]={},m[2].src=new a.Math.Rect(l.x+l.width,0,i.width-l.x-l.width,l.y),m[2].dest=new a.Math.Rect(h.width-m[2].src.width+h.x,h.y,m[2].src.width,m[2].src.height),m[6]={},m[6].src=new a.Math.Rect(0,l.y+l.height,l.x,i.height-l.y-l.height),m[6].dest=new a.Math.Rect(h.x,h.y+h.height-m[6].src.height,m[6].src.width,m[6].src.height),m[8]={},m[8].src=new a.Math.Rect(l.x+l.width,l.y+l.height,i.width-l.x-l.width,i.height-l.y-l.height),m[8].dest=new a.Math.Rect(h.width-m[8].src.width+h.x,h.y+h.height-m[8].src.height,m[8].src.width,m[8].src.height),m[1]={},m[1].src=new a.Math.Rect(l.x,0,l.width,l.y),m[1].dest=new a.Math.Rect(m[0].dest.x+m[0].dest.width,h.y,h.width-m[0].dest.width-m[2].dest.width,l.y),m[3]={},m[3].src=new a.Math.Rect(m[0].src.x,l.y,m[0].src.width,l.height),m[3].dest=new a.Math.Rect(m[0].dest.x,m[0].dest.y+m[0].dest.height,m[0].dest.width,h.height-m[0].dest.height-m[6].dest.height),m[5]={},m[5].src=new a.Math.Rect(m[2].src.x,l.y,m[2].src.width,l.height),m[5].dest=new a.Math.Rect(m[2].dest.x,m[3].dest.y,m[2].dest.width,m[3].dest.height),m[7]={},m[7].src=new a.Math.Rect(m[1].src.x,m[6].src.y,l.width,m[6].src.height),m[7].dest=new a.Math.Rect(m[1].dest.x,m[6].dest.y,m[1].dest.width,m[6].dest.height),m[4]={},m[4].src=new a.Math.Rect(l.x,l.y,l.width,l.height),m[4].dest=new a.Math.Rect(m[1].dest.x,m[5].dest.y,m[1].dest.width,m[5].dest.height);for(var n=0;n<m.length;n++)m[n]&&(j=m[n].src,k=m[n].dest,this.ctx.drawImage(this.res,j.x,j.y,j.width,j.height,k.x,k.y,k.width,k.height))}this.ctx.restore()}}(window.Ycc),function(a){a.UI.ImageFrameAnimation=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.ImageFrameAnimation,this.res=null,this.frameSpace=1,this.firstFrameRect=null,this.startFrameCount=0,this.frameRectCount=1,this.autoplay=!1,this.isRunning=!1,this.mirror=0,this.extend(b),this.isRunning=this.autoplay},a.utils.mergeObject(a.UI.ImageFrameAnimation.prototype,a.UI.Base.prototype),a.UI.ImageFrameAnimation.prototype.constructor=a.UI.ImageFrameAnimation,a.UI.ImageFrameAnimation.prototype.computeUIProps=function(){},a.UI.ImageFrameAnimation.prototype._processMirror=function(a){1===this.mirror&&(this.ctx.scale(-1,1),this.ctx.translate(2*-a.x-a.width,0)),2===this.mirror&&(this.ctx.scale(1,-1),this.ctx.translate(0,2*-a.y-a.height)),3===this.mirror&&(this.ctx.scale(-1,-1),this.ctx.translate(2*-a.x-a.width,2*-a.y-a.height))},a.UI.ImageFrameAnimation.prototype.render=function(){var a=this.getAbsolutePosition(),b=parseInt((this.belongTo.yccInstance.ticker.frameAllCount-this.startFrameCount)/this.frameSpace)%this.frameRectCount+1;(!this.isRunning||b>=this.frameRectCount)&&(b=0),this.ctx.save(),this.scaleAndRotate(),this._processMirror(a),this.ctx.drawImage(this.res,this.firstFrameRect.x+this.firstFrameRect.width*b,this.firstFrameRect.y,this.firstFrameRect.width,this.firstFrameRect.height,a.x,a.y,a.width,a.height),this.ctx.restore()},a.UI.ImageFrameAnimation.prototype.start=function(){this.startFrameCount=this.belongTo.yccInstance.ticker.frameAllCount,this.isRunning=!0},a.UI.ImageFrameAnimation.prototype.stop=function(){this.isRunning=!1}}(window.Ycc),function(a){a.UI.Line=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.Line,this.start=new a.Math.Dot(0,0),this.end=new a.Math.Dot(0,0),this.width=1,this.color="black",this.extend(b)},a.utils.mergeObject(a.UI.Line.prototype,a.UI.Base.prototype),a.UI.Line.prototype.constructor=a.UI.Line,a.UI.Line.prototype.computeUIProps=function(){this.rect.x=this.start.x<this.end.x?this.start.x:this.end.x,this.rect.y=this.start.y<this.end.y?this.start.y:this.end.y,this.rect.width=Math.abs(this.start.x-this.end.x),this.rect.height=Math.abs(this.start.y-this.end.y)},a.UI.Line.prototype.render=function(){var a=this.getParent(),b=a?a.transformToAbsolute(this.start):this.start,c=a?a.transformToAbsolute(this.end):this.end;this.ctx.save(),this.ctx.strokeStyle=this.color,this.ctx.strokeWidth=this.width,this.ctx.beginPath(),this.ctx.moveTo(b.x,b.y),this.ctx.lineTo(c.x,c.y),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.BrokenLine=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.BrokenLine,this.pointList=[],this.width=1,this.color="black",this.extend(b)},a.utils.mergeObject(a.UI.BrokenLine.prototype,a.UI.Base.prototype),a.UI.BrokenLine.prototype.computeUIProps=function(){if(0===this.pointList.length)return this.rect.x=0,this.rect.y=0,this.rect.width=0,this.rect.height=0,null;for(var a=this.pointList[0].x,b=this.pointList[0].y,c=this.pointList[0].x,d=this.pointList[0].y,e=0;e<this.pointList.length;e++){var f=this.pointList[e];f.x<a?a=f.x:f.x>c&&(c=f.x),f.y<b?b=f.y:f.y>d&&(d=f.y)}this.rect.x=a,this.rect.y=b,this.rect.width=c-a,this.rect.height=d-b},a.UI.BrokenLine.prototype.render=function(){if(this.pointList.length<2)return null;var a=this.getParent();this.ctx.save(),this.ctx.strokeStyle=this.color,this.ctx.strokeWidth=this.width,this.ctx.beginPath();var b=a?a.transformToAbsolute(this.pointList):this.pointList;this.ctx.moveTo(b[0].x,b[0].y);for(var c=1;c<b.length;c++)this.ctx.lineTo(b[c].x,b[c].y);this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.MultiLineText=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.MultiLineText,this.displayLines=[],this.content="",this.fontSize="16px",this.lineHeight=24,this.fill=!0,this.color="black",this.wordBreak="break-all",this.overflow="auto",this.extend(b)},a.utils.mergeObject(a.UI.MultiLineText.prototype,a.UI.Base.prototype),a.UI.MultiLineText.prototype.constructor=a.UI.MultiLineText,a.UI.MultiLineText.prototype.computeUIProps=function(){function a(){function a(){function a(d){var e=[],f=b.ctx.measureText(d).width;if(f<=c.rect.width)return e.push(d),e;for(var g=0;g<d.length;g++){var h=d.slice(0,g+1),i=b.ctx.measureText(h).width;if(i>c.rect.width){var j=d.slice(0,g-1);e.push(j);var k=d.slice(g-1);return e=e.concat(a(k))}}}for(var e=[],f=0;f<d.length;f++){var g=d[f],h=a(g);e=e.concat(h)}return e}function e(){function a(d){var e=[],f=b.ctx.measureText(d).width;if(f<=c.rect.width)return e.push(d),e;for(var g=0,h=0;h<d.length;h++){var i=d.slice(0,h+1),j=b.ctx.measureText(i).width,k=d[h];if(" "===k&&(g=h),j>c.rect.width){var l="",m="";return" "===k||0===g?(l=d.slice(0,h),e.push(l),m=d.slice(h),e=e.concat(a(m))):(l=d.slice(0,g),e.push(l),m=d.slice(g),e=e.concat(a(m)))}}}for(var e=[],f=0;f<d.length;f++){var g=d[f],h=a(g);e=e.concat(h)}return e}switch(c.wordBreak){case"no-break":case"break-all":return a();case"break-word":return e();default:return a()}}var b=this,c=this,d=this.content.split(/(?:\r\n|\r|\n)/);this.displayLines=a(),"auto"===c.overflow&&(c.rect.height=c.lineHeight*this.displayLines.length)},a.UI.MultiLineText.prototype.render=function(a){var b=this;if(b.ctx=a||b.ctx,!b.ctx)return void console.error("[Ycc error]:","ctx is null !");var c=this,d=this.getAbsolutePosition();this.ctx.save(),this.ctx.fillStyle=c.color,this.ctx.strokeStyle=c.color;for(var e=0;e<b.displayLines.length;e++){var f=d.x,g=d.y+e*c.lineHeight;if(g+c.lineHeight>d.y+d.height)break;this.belongTo.yccInstance.baseUI.text([f,g],b.displayLines[e],c.fill)}this.ctx.restore()}}(window.Ycc),function(a){a.UI.Rect=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.Rect,this.fill=!0,this.color="black",this.extend(b)},a.utils.mergeObject(a.UI.Rect.prototype,a.UI.Base.prototype),a.UI.Rect.prototype.render=function(){var a=this.getAbsolutePosition();this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.rect(a.x,a.y,a.width,a.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.CropRect=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.CropRect,this.ctrlSize=6,this.enableDragOut=!1,this.fill=!0,this.ctrlRect1=new a.Math.Rect,this.ctrlRect2=new a.Math.Rect,this.ctrlRect3=new a.Math.Rect,this.ctrlRect4=new a.Math.Rect,this.btns=[],this.btnHeight=38,this.btnVerticalPadding=10,this.showName=!0,this.extend(b),this._initUI()},a.utils.mergeObject(a.UI.CropRect.prototype,a.UI.Base.prototype),a.UI.CropRect.prototype.showBtns=function(b){if(this.btns.length>0){for(var c=0;c<this.btns.length;c++)a.utils.isObj(this.btns[c])&&(this.btns[c].show=b);this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}},a.UI.CropRect.prototype.setCtrlBtns=function(b){var c=this;0!==b.length&&b.forEach(function(b){b=a.utils.extend({content:"",rectBgColor:"#666",color:"#fff",onclick:function(){}},b);var d=new a.UI.SingleLineText(b);d.addListener("mouseover",function(){this.color="#ccc",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),d.addListener("mouseout",function(){this.color="#fff",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),c.btns.push(d),c.belongTo.addUI(d)})},a.UI.CropRect.prototype.computeUIProps=function(){this.belongTo._setCtxProps(this);var b=this.rect,c=0,d=0,e=this.rect.x,f=this.rect.y+this.rect.height,g=this.belongTo.yccInstance.getStageWidth(),h=this.belongTo.yccInstance.getStageHeight();if(this.ctrlRect1=new a.Math.Rect(b.x,b.y,this.ctrlSize,this.ctrlSize),this.ctrlRect2=new a.Math.Rect(b.x+b.width-this.ctrlSize,b.y,this.ctrlSize,this.ctrlSize),this.ctrlRect3=new a.Math.Rect(b.x,b.y+b.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),this.ctrlRect4=new a.Math.Rect(b.x+b.width-this.ctrlSize,b.y+b.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),0!==this.btns.length){for(var i=0;i<this.btns.length;i++){var j=this.btns[i];j.overflow="auto",j.xAlign="center",j.rect.width=parseInt(this.ctx.measureText(j.content).width+2*this.btnVerticalPadding),j.rect.height=this.btnHeight,c+=j.rect.width+1}e+c>g&&(e=g-c),f+this.btnHeight>h&&(f=this.rect.y<this.btnHeight?0:this.rect.y-this.btnHeight-2);for(var k=0;k<this.btns.length;k++){var l=this.btns[k];l.rect.x=e+d,l.rect.y=f+2,d+=l.rect.width+1}}},a.UI.CropRect.prototype._initUI=function(){var b=this,c=null,d=null;this.userData=this.userData?this.userData:{},this.addListener("dragstart",function(e){this.userData.ctrlStart=0,this.userData.dragStartPosition=new a.Math.Rect(this.rect),this.userData.dragStartMousePosition=new a.Math.Dot(e);var f=new a.Math.Dot(e);c=f,d=new a.Math.Rect(b.rect);for(var g=1;g<=4;g++)if(f.isInRect(this["ctrlRect"+g]))return this.userData.ctrlStart=g,null}),this.addListener("dragging",function(a){var b,e,f,g,h=this.userData.dragStartPosition,i=this.userData.dragStartMousePosition;if(this.userData.ctrlStart<=4&&this.userData.ctrlStart>=1?(1===this.userData.ctrlStart&&(b=a.x-(i.x-h.x),e=a.y-(i.y-h.y),f=h.width-(a.x-h.x),g=h.height-(a.y-h.y),b<=h.x+h.width-2*this.ctrlSize&&(this.rect.x=b),e<=h.y+h.height-2*this.ctrlSize&&(this.rect.y=e)),2===this.userData.ctrlStart&&(b=h.x,e=a.y-(i.y-h.y),f=a.x-h.x+(h.width+h.x-i.x),g=h.height-(a.y-h.y),this.rect.x=b,e<=h.y+h.height-2*this.ctrlSize&&(this.rect.y=e)),3===this.userData.ctrlStart&&(b=a.x-(i.x-h.x),e=h.y,f=h.width-(a.x-h.x),g=a.y-h.y+(h.height+h.y-i.y),b<=h.x+h.width-2*this.ctrlSize&&(this.rect.x=b),this.rect.y=e),4===this.userData.ctrlStart&&(this.rect.x=h.x,this.rect.y=h.y,this.rect.width=a.x-h.x+(h.x+h.width-i.x),this.rect.height=a.y-h.y+(h.y+h.height-i.y)),f>=2*this.ctrlSize&&(this.rect.width=f),g>=2*this.ctrlSize&&(this.rect.height=g)):(this.rect.x=d.x+a.x-c.x,this.rect.y=d.y+a.y-c.y),this.rect.width<=2*this.ctrlSize&&(this.rect.width=2*this.ctrlSize),this.rect.height<=2*this.ctrlSize&&(this.rect.height=2*this.ctrlSize),!this.enableDragOut){var j=this.belongTo.yccInstance.getStageWidth(),k=this.belongTo.yccInstance.getStageHeight();this.rect.x<=0&&(this.rect.x=0),this.rect.y<=0&&(this.rect.y=0),this.rect.x+this.rect.width>=j&&(this.rect.x=j-this.rect.width),this.rect.y+this.rect.height>=k&&(this.rect.y=k-this.rect.height)}this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),this.addListener("dragend",function(a){b.showBtns(!0)})},a.UI.CropRect.prototype.render=function(){var a=this.rect;this.ctx.save(),this.ctx.fillStyle=this.fillStyle,this.ctx.strokeStyle=this.strokeStyle,this.ctx.beginPath(),this.ctx.rect(a.x,a.y,a.width,a.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.beginPath(),this.ctx.rect(this.ctrlRect1.x,this.ctrlRect1.y,this.ctrlRect1.width,this.ctrlRect1.height),this.ctx.rect(this.ctrlRect2.x,this.ctrlRect2.y,this.ctrlRect2.width,this.ctrlRect2.height),this.ctx.rect(this.ctrlRect3.x,this.ctrlRect3.y,this.ctrlRect3.width,this.ctrlRect3.height),this.ctx.rect(this.ctrlRect4.x,this.ctrlRect4.y,this.ctrlRect4.width,this.ctrlRect4.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="blue",this.ctx.font="normal normal bold 14px Arial",this.ctx.fillText(this.name,a.x+10,a.y+10),this.ctx.closePath(),this.ctx.restore()},a.UI.CropRect.prototype.removeSelf=function(){this.belongTo.removeUI(this),this.btns.forEach(function(a){a.removeSelf()})}}(window.Ycc),function(a){a.UI.SingleLineText=function(b){a.UI.Base.call(this,b),this.yccClass=a.UI.SingleLineText,this.displayContent="",this.content="",this.fontSize="16px",this.fill=!0,this.color="black",this.xAlign="left",this.yAlign="center",this.overflow="auto",this.extend(b)},a.utils.mergeObject(a.UI.SingleLineText.prototype,a.UI.Base.prototype),a.UI.SingleLineText.prototype.constructor=a.UI.SingleLineText,a.UI.SingleLineText.prototype.computeUIProps=function(){var a=this;a.belongTo._setCtxProps(a);var b=this.ctx.measureText(this.content).width;this.displayContent=this.content,b>this.rect.width&&("hidden"===this.overflow?a.displayContent=a.getMaxContentInWidth(this.content,this.rect.width):"auto"===this.overflow&&(this.rect.width=b)),"hidden"===this.overflow?b>this.rect.width&&(a.displayContent=a.getMaxContentInWidth(this.content,this.rect.width)):"auto"===this.overflow&&(b>this.rect.width&&(this.rect.width=b),parseInt(this.fontSize)>this.rect.height&&(this.rect.height=parseInt(this.fontSize)))},a.UI.SingleLineText.prototype.render=function(a){var b=this;if(b.belongTo._setCtxProps(b),b.ctx=a||b.ctx,!b.ctx)return void console.error("[Ycc error]:","ctx is null !");var c,d,e=parseInt(b.fontSize),f=this,g=this.getAbsolutePosition();c=g.x;var h=this.ctx.measureText(this.displayContent).width;return"center"===this.xAlign&&(c+=(g.width-h)/2),"right"===this.xAlign&&(c+=g.width-h),d=g.y,e>g.height?console.warn("[Ycc warning] : ","行高不够，或者文字太大！",f):("center"===f.yAlign&&(d=d+g.height/2-e/2),this.ctx.save(),this.ctx.fillStyle=f.color,this.ctx.strokeStyle=f.color,this.ctx.fillText(b.displayContent,c,d),void this.ctx.restore())}}(window.Ycc);
//# sourceMappingURL=ycc.min.js.map