!function(a){var b=0;a.Layer=function(c,d){a.Listener.call(this),d=d||{},this.yccClass=a.Layer,this.uiList=[],this.yccInstance=c,this.canvasDom=null,this.ctx=null,this.id=b++,this.type="ui",this.textValue="",this.name=d.name?d.name:"图层_"+this.type+"_"+this.id,this.x=0,this.y=0,this.width=c.getStageWidth(),this.height=c.getStageHeight(),this.show=!0,this.enableEventManager=!1,this.enableFrameEvent=!1,this.onFrameComing=function(){},a.utils.extend(this,d),this.init()},a.Layer.prototype=new a.Listener,a.Layer.prototype.constructor=a.Layer,a.Layer.prototype.init=function(){var a=this,b=this.yccInstance.canvasDom;this.ctx=b.getContext("2d"),this.canvasDom=b,a._setCtxProps()},a.Layer.prototype._initEvent=function(){function b(b){if(!b.stop&&!(e&&b.x===e.x&&b.y===e.y||f&&b.x===f.x&&b.y===f.y)){if(g=!0,e){if(!h){var c=new a.Event({type:"dragstart",x:e.x,y:e.y,mouseDownYccEvent:e});d.triggerListener(c.type,c),e.target&&(c.target=e.target,c.target.triggerListener(c.type,c))}h=!0;var i=new a.Event({type:"dragging",x:b.x,y:b.y,mouseDownYccEvent:e});return d.triggerListener(i.type,i),e.target&&(i.target=e.target,i.target.triggerListener(i.type,i)),null}for(var j=d.uiList.length-1;j>=0;j--){var k=d.uiList[j],l=new a.Math.Dot(b.x-k.belongTo.x,b.y-k.belongTo.y);if(l.isInRect(k.rect)){b.stop=!0,b.mouseDownYccEvent=e,b.mouseUpYccEvent=f,b.target=k,k.triggerListener(b.type,b);break}}}}function c(b){if(!b.stop)for(var c=d.uiList.length-1;c>=0;c--){var g=d.uiList[c],h=new a.Math.Dot(b.x,b.y);if(g.rect&&h.isInRect(g.getAbsolutePosition())&&b.stop===!1){b.stop=!0,b.mouseDownYccEvent=e,b.mouseUpYccEvent=f,b.target=g,b.targetDeltaPosition=new a.Math.Dot(b.x-g.getAbsolutePosition().x,b.y-g.getAbsolutePosition().y),g.triggerListener(b.type,b);break}}}var d=this,e=null,f=null,g=!1,h=!1;this.addListener("click",function(a){g||c(a)}),this.addListener("mousedown",function(a){g=!1,h=!1,e=a,c(a)}),this.addListener("mouseup",function(b){if(h){var g=new a.Event({type:"dragend",x:b.x,y:b.y,mouseDownYccEvent:e});d.triggerListener("dragend",g),e&&e.target&&(d.target=e.target,d.target.triggerListener("dragend",g))}b.mouseDownYccEvent=e=null,f=b,c(b)}),this.addListener("mousemove",b)},a.Layer.prototype._setCtxProps=function(b){var c=this,d={fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontSize:"16px",fontFamily:"微软雅黑",font:"16px 微软雅黑",textBaseline:"hanging",fillStyle:"red",strokeStyle:"blue"};d=a.utils.extend(d,b),d.font=[d.fontStyle,d.fontVariant,d.fontWeight,d.fontSize,d.fontFamily].join(" ");for(var e in d)d.hasOwnProperty(e)&&(c.ctx[e]=d[e])},a.Layer.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},a.Layer.prototype.removeAllUI=function(){this.uiList.forEach(function(a){a.itor().each(function(a){a=null})}),this.uiList=[]},a.Layer.prototype.renderToStage=function(){this.show&&this.yccInstance.ctx.drawImage(this.ctx.canvas,0,0,this.width,this.height)},a.Layer.prototype.addUI=function(a,b){var c=this;if(a.itor().each(function(a){a.init(c)}),!b)return this.uiList.push(a);var d=this.uiList.indexOf(b);return d===-1?this.uiList.push(a):void this.uiList.splice(d,0,a)},a.Layer.prototype.removeUI=function(a){var b=this.uiList.indexOf(a);b!==-1&&this.uiList.splice(b,1)},a.Layer.prototype.render=function(){for(var a=0;a<this.uiList.length;a++)this.uiList[a].show&&this.uiList[a].render()},a.Layer.prototype.reRender=function(){for(var a=0;a<this.uiList.length;a++)this.uiList[a].show&&this.uiList[a].itor().depthDown(function(a,b){a.__render()})},a.Layer.prototype.getUIFromPointer=function(a){for(var b=this,c=b.uiList.length-1;c>=0;c--){var d=b.uiList[c];if(a.isInRect(d.getAbsolutePosition()))return d}return null},a.Layer.prototype.transformToAbsolute=function(b){var c=null;if(a.utils.isArray(b)){c=[];for(var d=0;d<b.length;d++){var e=new a.Math.Dot(0,0),f=b[d];e.x=this.x+f.x,e.y=this.y+f.y,c.push(e)}return c}return c=new a.Math.Dot(0,0),c.x=this.x+b.x,c.y=this.y+b.y,c},a.Layer.prototype.transformToLocal=function(b){var c=null;if(a.utils.isArray(b)){c=[];for(var d=0;d<b.length;d++){var e=new a.Math.Dot(0,0),f=b[d];e.x=f.x-this.x,e.y=f.y-this.y,c.push(e)}return c}return c=new a.Math.Dot(0,0),c.x=b.x-this.x,c.y=b.y-this.y,c}}(window.Ycc);
//# sourceMappingURL=Ycc.Layer.class.min.js.map